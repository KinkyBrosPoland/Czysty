const ShoppingListPageTxt={selectProduct:"Zaznacz produkt, który chcesz przenieść/skopiować do innej listy.",startShare:"Włącz udostępnianie tej listy",stopShare:"Wyłącz udostępnianie tej listy",changeQuantity:"Musisz zmienić ilość produktów, aby zaktualizować koszyk",minimumQuantity:"Minimalnie musisz zamówić ",maximumQuantity:"Maksymalnie możesz zamówić: ",successfullyRemoved:"Usunięto z listy",copy:"Skopiowano"};ShoppingListPage=function(t){const e=this;return this.params=t||{},this.vars={selectedProducts:[],typingTimer:"",doneTypingInterval:500},this.numberCheck=(t,e)=>{const s=void 0!==e?parseFloat(t.value)+parseFloat(e):parseFloat(t.value),o=t=>void 0!==e?parseFloat(t)-parseFloat(e):t,{amount:a,unit_sellby:r,unit:l,unit_precision:c,max_q:i,max_s:n,min_q:_,min_s:p}=t.dataset||{};let u=parseFloat(r);const d=parseFloat(c),m=parseFloat(a),h=parseFloat(i),g=parseFloat(n),f=parseFloat(_),v=parseFloat(p);if(parseFloat(t.value)<=0&&void 0!==e)return t.value=parseFloat(t.value)+u,!1;if(parseFloat(t.value)<=0)return t.value=0,!1;if(isNaN(s)||s<=u){if(isNaN(h)&&isNaN(g)&&isNaN(f)&&isNaN(v))return void 0!==e?(t.value=o(s),!0):(t.value=o(u.toFixed(d)),!0);u=u.toFixed(d)}let y=Math.floor(s/u)*u;y=(s/u*u-y).toFixed(d+1)>0?(1*y+u).toFixed(d):y.toFixed(d),y=void 0!==e?parseFloat(s):parseFloat(y);let L=m,S=u,b=-1;return isNaN(h)||(b=parseFloat(t.value),b=h-b,b=b<0?"end":b,L=L>h?h:L),isNaN(g)||(L=L>g?g:L),isNaN(f)||(S=f>S?f:S),isNaN(v)||(S=v>S?v:S),-1!==L&&(S=L>S?S:u),S&&y<S?(Alertek.show_alert(ShoppingListPageTxt.minimumQuantity+" "+Math.ceil(parseFloat(S)/u)*u+" "+l),t.value=o(Math.ceil(parseFloat(S)/u)*u),!0):"end"===b?(Alertek.show_alert(ShoppingListPageTxt.maximumQuantity+" "+Math.floor(parseFloat(h)/u)*u+" "+l),t.value=o(Math.floor(parseFloat(h)/u)*u),!0):(y>L&&-1!==L?(Alertek.show_alert(ShoppingListPageTxt.maximumQuantity+" "+Math.floor(parseFloat(L)/u)*u+" "+l),t.value=o(Math.floor(parseFloat(L)/u)*u)):t.value=o(y),!0)},this.addToBasketMultiproduct=async()=>{const t=new URLSearchParams(new FormData);this.vars.selectedProducts.forEach(((e,s)=>{const o=document.querySelector(`.sl_products__product[data-product_id="${e[0]}"][data-product_size="${e[1]}"]`);if(o&&!o.hasAttribute("data-disabled")&&!o.hasAttribute("data-bundle")){const a=!!document.querySelector(".shopping_list.--list")?o.querySelector(".sl_products__quantity").value:o.getAttribute("data-set_quantity"),r=o.getAttribute("data-additional");t.append(`set_quantity[${s}]`,a),t.append(`product[${s}]`,e[0]),t.append(`size[${s}]`,e[1]),r&&t.append(`additional[${s}]`,r)}})),t.append("getAjax",!0),t.append("mode",1);try{const e=await fetch("/basketchange.php?type=multiproduct",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8",Accept:"application/json"},body:t});await app_shop.graphql.trackingEvents(e);const s=await e.json();return"function"==typeof window.Core?.basketChanged&&window.Core.basketChanged(s),s}catch(t){return!1}},this.updateSelectedProducts=t=>{this.vars.selectedProducts=[];const e=document.querySelector(".shopping_list");if(e.classList.contains("--group")){document.querySelectorAll(".sl_products__select_input:checked").forEach((t=>{const s=t.closest(".sl_products__product"),o=s.getAttribute("data-product_id"),a=s.getAttribute("data-product_size");s.classList.contains("--changed")&&e.classList.add("--changed"),this.vars.selectedProducts.push([o,a])}))}else if(t){const e=t.closest("[data-product_id]").getAttribute("data-product_id"),s=t.closest("[data-product_size]").getAttribute("data-product_size");this.vars.selectedProducts.push([e,s])}},this.updateProductsContent=()=>{this.vars.selectedProducts.forEach((t=>{const e=document.querySelector(`.sl_products__product[data-product_id="${t[0]}"][data-product_size="${t[1]}"]`);e&&e.parentNode.removeChild(e)}))},this.checkFixedFooter=()=>{const t=document.querySelector(".sl_footer"),e=document.querySelector(".sl_footer__wrapper").offsetHeight,s=window.innerHeight;return!(t.getBoundingClientRect().top-s+e<=0)},this.fixedFooter=()=>{const t=document.querySelector(".sl_footer__wrapper");this.checkFixedFooter()?t.classList.add("--fixed"):t.classList.remove("--fixed")},this.checkSelectProduct=()=>0!==document.querySelectorAll(".sl_products__select_input:checked").length||(Alertek.Start(ShoppingListPageTxt.selectProduct),!1),this.initEvents=()=>{"function"==typeof app_shop.fn.addDepositInfo&&app_shop.fn.addDepositInfo(".deposit_price__value");const t=t=>{if("gallery"!==t&&"list"!==t)return;const e=document.querySelector(".sl_settings__view_link.--gallery"),s=document.querySelector(".sl_settings__view_link.--list");if(!e||!s)return;const o=(t,e)=>{const s=t.dataset,o=s.inactiveClass,a=s.activeClass;o&&a&&(e?(t.classList.add(a),t.classList.remove(o)):(t.classList.add(o),t.classList.remove(a)))};o(e,"gallery"===t),o(s,"list"===t)};"list"===localStorage.getItem("shoppingListView")&&(document.querySelector(".shopping_list").classList.add("--list"),t("list")),document.addEventListener("click",(async function(s){if(s.target.closest(".sl_settings__group")){s.preventDefault();const t=document.querySelector(".shopping_list"),o=document.querySelectorAll(".sl_products__select_input"),a=document.querySelectorAll(".sl_products__name"),r=document.querySelector(".sl_footer__all"),l=document.querySelector(".sl_footer__wrapper"),c=document.querySelector(".sl_footer__item.--move.--active"),i=document.querySelector(".sl_products__move.--active");t&&(t.classList.toggle("--group"),t.classList.contains("--group")?(o.forEach((t=>{t.checked=!1})),a.forEach((t=>t.setAttribute("tabindex","-1"))),r.checked=!1,c&&c.classList.remove("--active"),i&&i.classList.remove("--active"),document.addEventListener("scroll",e.fixedFooter,!0),e.checkFixedFooter()&&l.classList.add("--fixed")):(a.forEach((t=>t.removeAttribute("tabindex"))),document.removeEventListener("scroll",e.fixedFooter,!0),e.checkFixedFooter()||l.classList.remove("--fixed")))}if(s.target.closest(".sl_products__select_input")){const t=document.querySelector(".sl_footer__label");t&&(t.previousElementSibling.checked=!1);const e=document.querySelectorAll(".sl_products__select_input"),s=document.querySelectorAll(".sl_products__select_input:checked");e&&s&&e.length===s.length&&(t.previousElementSibling.checked=!0);let o=0;const a=document.querySelector(".sl_footer__link.--buy");s.forEach((t=>{(t.closest("[data-disabled]")||t.closest("[data-bundle]"))&&(o+=1)})),0!==o&&s.length===o?a.classList.add("--disabled"):a.classList.remove("--disabled")}if(s.target.closest(".sl_settings__view_link")){s.preventDefault();const e=s.target.closest(".sl_settings__view_link"),o=document.querySelector(".shopping_list");e.classList.contains("--gallery")?(o.classList.remove("--list"),t("gallery"),localStorage.setItem("shoppingListView","gallery")):e.classList.contains("--list")&&(o.classList.add("--list"),t("list"),localStorage.setItem("shoppingListView","list"))}if(s.target.closest(".sl_products__link.--move, .sl_footer__link.--move")){s.preventDefault();const t=s.target.closest(".sl_products__link.--move, .sl_footer__link.--move"),o=t.parentNode,a=document.querySelectorAll(".sl_products__move, .sl_footer__item.--move");return t.classList.contains("sl_footer__link")&&!e.checkSelectProduct()||(a.forEach((t=>{t.classList.remove("--active")})),o.classList.add("--active"),o.querySelector(".sl_products__option.--move")?.focus(),o.querySelector(".sl_footer__option.--move")?.focus()),!1}if(s.target.closest(".sl_products__option.--close, .sl_footer__option.--close")){s.preventDefault();s.target.closest(".sl_products__option.--close, .sl_footer__option.--close").closest(".--active").classList.remove("--active")}if(s.target.closest(".sl_products__option:not(.--close), .sl_footer__option:not(.--close)")){s.preventDefault();const t=s.target.closest(".sl_products__option:not(.--close), .sl_footer__option:not(.--close)"),o=document.querySelector(".sl_move"),a=document.querySelector(".sl_products__move.--active"),r=document.querySelector(".sl_footer__item.--move.--active");return o&&(o.querySelectorAll(".--success").forEach((t=>{t.classList.remove("--success")})),o.classList.add("--active"),t.classList.contains("--move")?o.classList.add("--move-now"):o.classList.add("--copy-now"),a&&a.classList.remove("--active"),r&&r.classList.remove("--active"),Modal({element:o,classList:"--sl-move --medium --mobile",afterClose:()=>{o.classList.remove("--active","--move-now","--copy-now")}})),e.updateSelectedProducts(t),!1}if(s.target.closest(".sl_move__button")&&!s.target.closest(".sl_move__button.--loading")){const t=s.target.closest(".sl_move__button"),o=t.closest(".shopping_list__block").querySelector(".sl_move__input:checked"),a=document.querySelector(".shopping_list[data-list_id]").getAttribute("data-list_id"),r=o.closest("[data-list_id]").getAttribute("data-list_id"),l=t.closest(".--copy-now")?o.closest(".sl_move__list"):o.closest(".sl_move__item"),c=t.classList.contains("--mobile");c&&t.closest(".--move-now")&&app_shop.fn.shoppingList.status(t,"loading"),app_shop.fn.shoppingList.status(l,"loading");const i=()=>{app_shop.fn.shoppingList.queryCombo({fetchDataQuery:app_shop.fn.shoppingList.deleteProductQuery(a,e.vars.selectedProducts),afterSuccess:()=>{e.updateProductsContent(),document.querySelector(".sl_products__product")?app_shop.fn.shoppingList.updateListCount({idList:a,afterSuccess:()=>{c&&app_shop.fn.shoppingList.status(t,"success"),app_shop.fn.shoppingList.status(l,"success"),setTimeout((function(){const t=document.querySelector(".sl_move.--active");t&&t.classList.remove("--active","--move-now","--copy-now"),window.closeModal(),document.querySelector(".sl_products__name")?.focus()}),1e3),e.checkFixedFooter()||document.querySelector(".sl_footer__wrapper").classList.remove("--fixed")},afterError:()=>{c&&app_shop.fn.shoppingList.status(t,"error"),app_shop.fn.shoppingList.status(l,"error")}}):window.location.reload()},afterError:()=>{c&&app_shop.fn.shoppingList.status(t,"error"),app_shop.fn.shoppingList.status(l,"error")}})};app_shop.fn.shoppingList.queryCombo({fetchDataQuery:app_shop.fn.shoppingList.addProductQuery(r,e.vars.selectedProducts),afterSuccess:()=>{t.closest(".--move-now")?(i(),app_shop.fn.shoppingList.updateListCount({idList:r})):app_shop.fn.shoppingList.updateListCount({idList:r,afterSuccess:()=>{app_shop.fn.shoppingList.status(l,"success",!0)},afterError:()=>{app_shop.fn.shoppingList.status(l,"error")}})},afterError:()=>{c&&t.closest(".--move-now")&&app_shop.fn.shoppingList.status(t,"error"),app_shop.fn.shoppingList.status(l,"error")}})}if(s.target.closest(".sl_header__mobile, .sl_m_manage__close, .sl_d_manage__close, .slm_lists__manage")){s.preventDefault();const t=document.querySelector(".sl_manage");return t&&t.classList.toggle("--active"),Modal({element:t,classList:"--sl-manage --medium --mobile",afterClose:()=>{t.classList.remove("--active")}}),!1}if(s.target.closest(".sl_change_name__button")){s.preventDefault();const t=s.target.closest(".sl_change_name__button"),e=t.closest(".sl_change_name").querySelector(".sl_change_name__input"),o=t.closest("[data-list_id]").getAttribute("data-list_id");return e.checkValidity()?(app_shop.fn.shoppingList.queryCombo({statusElement:t.closest(".sl_change_name").parentNode,fetchDataQuery:app_shop.fn.shoppingList.updateListQuery({idList:o,nameList:e.value}),afterSuccess:()=>{t.closest(".sl_d_manage__list")?(t.closest(".sl_d_manage__list").classList.remove("--active"),t.closest(".sl_d_manage__list").querySelector(".sl_d_manage__list_sub")?.focus()):t.closest(".sl_m_manage__list")&&(t.closest(".sl_m_manage__list").classList.remove("--active"),t.closest(".sl_m_manage__list").querySelector(".sl_m_manage__list_sub")?.focus()),app_shop.fn.shoppingList.updateListName(o,e.value),e.value=""}}),!1):(e.reportValidity(),!1)}if(s.target.closest(".sl_products__link.--remove, .sl_footer__link.--remove")){s.preventDefault();const t=s.target.closest(".sl_products__link.--remove, .sl_footer__link.--remove"),o=document.querySelector(".shopping_list[data-list_id]").getAttribute("data-list_id"),a=t.classList.contains("sl_footer__link"),r=document.querySelectorAll(".sl_products__select_input:checked"),l=t.closest(".sl_products__product");if(a&&!e.checkSelectProduct())return!1;e.updateSelectedProducts(t),a?r.forEach((t=>{app_shop.fn.shoppingList.status(t.closest(".sl_products__product"),"loading")})):app_shop.fn.shoppingList.status(l,"loading"),app_shop.fn.shoppingList.queryCombo({fetchDataQuery:app_shop.fn.shoppingList.deleteProductQuery(o,e.vars.selectedProducts),afterSuccess:()=>{a?r.forEach((t=>{t.closest(".sl_products__product").parentNode.removeChild(t.closest(".sl_products__product"))})):l.parentNode.removeChild(l),e.checkFixedFooter()||document.querySelector(".sl_footer__wrapper").classList.remove("--fixed"),document.querySelector(".sl_products__product")?(app_shop.fn.shoppingList.updateListCount({idList:o}),Alertek.Success(ShoppingListPageTxt.successfullyRemoved)):window.location.reload()},afterError:()=>{a?r.forEach((t=>{app_shop.fn.shoppingList.status(t.closest(".sl_products__product"),"error")})):app_shop.fn.shoppingList.status(l,"error")}})}if(s.target.closest(".sl_m_manage__edit.--remove, .sl_d_manage__edit.--remove, .sl_m_manage__link.--remove")){s.preventDefault();const t=s.target.closest(".sl_m_manage__edit.--remove, .sl_d_manage__edit.--remove, .sl_m_manage__link.--remove").parentNode;t.classList.toggle("--sure"),t.querySelector(".sl_remove__link.--yes")?.focus()}if(s.target.closest(".sl_remove__link.--yes")){s.preventDefault();const t=s.target.closest(".sl_remove__link.--yes"),e=t.closest("[data-list_id]"),o=document.querySelector(".shopping_list").getAttribute("data-list_id"),a=e.getAttribute("data-list_id");return app_shop.fn.shoppingList.queryCombo({statusElement:e.classList.contains("shopping_list")?t.closest(".sl_m_manage__option"):e,fetchDataQuery:app_shop.fn.shoppingList.deleteListQuery(a),afterSuccess:()=>{a===o?window.location.href="/shoppinglist.php":(t?.closest(".sl_manage__sub")?.querySelector(".sl_create__link")?.focus(),app_shop.fn.shoppingList.updateListDelete(a))}}),!1}if(s.target.closest(".sl_remove__link.--no")){s.preventDefault();const t=s.target.closest(".sl_remove__link.--no").closest(".--sure");if(!t)return;t.classList.remove("--sure"),t.querySelector(".sl_d_manage__edit.--remove")?.focus(),t.querySelector(".sl_m_manage__edit.--remove")?.focus()}if(s.target.closest(".sl_m_manage__link.--share, .sl_header__share")){s.preventDefault();const t=document.querySelector(".sl_share"),e=document.querySelector(".sl_share__option.--copy.--active"),o=document.querySelector(".sl_manage.--active");if(navigator.share&&app_shop.vars.view<3){const t=document.querySelector(".sl_header__headline span").textContent,e=document.querySelector(".sl_share__copy_input").value;navigator.share({title:t,url:e}).catch((t=>{}))}else t&&t.classList.add("--active"),e&&e.classList.remove("--active"),o&&o.classList.remove("--active"),Modal({element:t,classList:"--sl-share --medium --mobile",afterShow:()=>{t.classList.add("--active")},afterClose:()=>{t.classList.remove("--active")}});return!1}if(s.target.closest(".sl_share__link.--copy, .sl_share__copy_input")){s.preventDefault();const t=s.target.closest(".sl_share__link.--copy, .sl_share__copy_input"),e=document.querySelector(".sl_share__copy_input"),o=t.closest(".sl_share__option");if(!e)return;try{await navigator.clipboard.writeText(e.value),o&&o.classList.add("--active"),Alertek.SrOnly?.(ShoppingListPageTxt.copy)}catch(t){o&&o.classList.remove("--active")}}if(s.target.closest(".sl_m_manage__link.--stop, .sl_share__link.--stop, .sl_m_manage__link.--start, .sl_share__link.--start")){s.preventDefault();const t=s.target.closest(".sl_m_manage__link.--stop, .sl_share__link.--stop, .sl_m_manage__link.--start, .sl_share__link.--start"),e=document.querySelector(".shopping_list[data-list_id]").getAttribute("data-list_id");return app_shop.fn.shoppingList.queryCombo({statusElement:t.parentNode,fetchDataQuery:app_shop.fn.shoppingList.updateListQuery({idList:e,publicList:!t.classList.contains("--stop")}),afterSuccess:()=>{t.classList.contains("--stop")?(t.classList.remove("--stop"),t.classList.add("--start"),t.textContent=ShoppingListPageTxt.startShare):(t.classList.remove("--start"),t.classList.add("--stop"),t.textContent=ShoppingListPageTxt.stopShare),app_shop.fn.shoppingList.updateListShare(e)}}),!1}if(s.target.closest(".sl_m_manage__edit.--change-name, .sl_d_manage__edit.--change-name, .sl_m_manage__link.--change-name")){s.preventDefault();const t=s.target.closest(".sl_m_manage__edit.--change-name, .sl_d_manage__edit.--change-name, .sl_m_manage__link.--change-name").parentNode;t.classList.toggle("--active"),t.querySelector("input").focus()}if(s.target.closest(".sl_products__buy, .sl_footer__link.--buy")){s.preventDefault();const t=s.target.closest(".sl_products__buy, .sl_footer__link.--buy"),o=t.closest("[data-disabled]"),a=t.closest(".sl_products__product"),r=!!document.querySelector(".shopping_list.--list"),l=!!document.querySelector(".shopping_list.--group");if(o||t.classList.contains("--disabled")||t.classList.contains("sl_footer__link")&&!e.checkSelectProduct())return!1;if(e.updateSelectedProducts(t),r&&(l&&!document.querySelector(".shopping_list.--changed ")||a&&!a.classList.contains("--changed")))return Alertek.Start(ShoppingListPageTxt.changeQuantity),!1;t.classList.contains("sl_footer__link")?app_shop.fn.shoppingList.status(t.closest(".sl_footer__wrapper"),"loading"):app_shop.fn.shoppingList.status(t.closest(".sl_products__product"),"loading");const c=await e.addToBasketMultiproduct();c?(fetch("/return.php"),t.classList.contains("sl_footer__link")?app_shop.fn.shoppingList.status(t.closest(".sl_footer__wrapper"),"success"):app_shop.fn.shoppingList.status(t.closest(".sl_products__product"),"success"),document.querySelector(".topBasket.--hide")&&document.querySelector(".topBasket.--hide").classList.remove("--hide"),"function"==typeof menu_basket_cache?menu_basket_cache():"function"==typeof app_shop.fn.menu_basket_cache&&app_shop.fn.menu_basket_cache(),document.querySelector(".shopping_list").classList.remove("--changed"),e.vars.selectedProducts.forEach((t=>{const s=document.querySelector(`.sl_products__product[data-product_id="${t[0]}"][data-product_size="${t[1]}"]`);if(s&&!s.hasAttribute("data-disabled")&&!s.hasAttribute("data-bundle")){const o=+s.getAttribute("data-sellby");s.classList.remove("--changed");const a=c.basket.products.filter((e=>e.id===t[0]&&e.size===t[1]));a.length?(s.setAttribute("data-set_quantity",a[0].count+o),s.querySelector(".sl_products__quantity").value=a[0].count,s.setAttribute("data-additional",a[0].md5_additional),e.numberCheck(s.querySelector(".sl_products__quantity"))):(s.setAttribute("data-set_quantity",o),s.querySelector(".sl_products__quantity").value=0)}}))):t.classList.contains("sl_footer__link")?app_shop.fn.shoppingList.status(t.closest(".sl_footer__wrapper"),"error"):app_shop.fn.shoppingList.status(t.closest(".sl_products__product"),"error")}const o=document.querySelector(".sl_footer__item.--move.--active");o&&!o.querySelector(".sl_footer__move_options").contains(s.target)&&o.classList.remove("--active");const a=document.querySelector(".sl_products__move.--active");return a&&!a.querySelector(".sl_products__move_options").contains(s.target)&&a.classList.remove("--active"),!1})),document.addEventListener("change",(t=>{if(t.target.closest(".sl_footer__all")){const e=t.target.closest(".sl_footer__all").checked;document.querySelectorAll(".sl_products__select_input").forEach((t=>{t.checked=!!e}))}})),document.addEventListener("focusin",(t=>{const e=document.querySelector(".sl_footer__item.--move.--active"),s=document.querySelector(".sl_products__move.--active");if(!e&&!s)return;const{target:o}=t;e&&!o?.closest(".sl_footer__item.--move")&&e.classList.remove("--active"),s&&!o?.closest(".sl_products__move")&&s.classList.remove("--active")}));document.querySelectorAll(".sl_products__quantity").forEach((t=>{t.addEventListener("keyup",(function(){clearTimeout(e.vars.typingTimer),e.vars.typingTimer=setTimeout((()=>{if(""!==this.value){this.setAttribute("data-prev",this.value);const t=this.closest(".sl_products__product");e.numberCheck(this),t.classList.add("--changed")}}),e.vars.doneTypingInterval)})),t.addEventListener("blur",(function(){""===this.value&&(this.value=this.getAttribute("data-prev"))}))}));document.querySelectorAll(".sl_products__number_down, .sl_products__number_up").forEach((t=>{t.addEventListener("click",(function(t){t.preventDefault();const s=this.closest(".sl_products__number_wrapper").querySelector(".sl_products__quantity"),o=this.closest(".sl_products__product"),a=s.getAttribute("data-unit_sellby"),r=!!this.classList.contains("sl_products__number_up");return s.value=r?parseFloat(s.value,10)+parseFloat(a):parseFloat(s.value,10)-parseFloat(a),e.numberCheck(s),o.classList.add("--changed"),!1}))})),document.querySelectorAll(".sl_products__quantity").forEach((t=>{e.numberCheck(t)}))},this.initEvents()},app_shop.run((function(){app_shop.fn.shoppingListPage=new ShoppingListPage,app_shop.fn.shoppingListPageSelects=new SelectToDropdown({selector:".sl_settings__select",afterClickDropdownCallback:t=>{t.closest("form").submit()}})}),"all",".shopping_list"),app_shop.run((function(){app_shop.fn.setHeight({selectors:[".sl_products__item.--name",".sl_products__item.--prices"],container:".sl_products"})}),[1,2,3,4],".shopping_list");
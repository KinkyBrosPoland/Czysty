app_shop.vars.opinions_empty_input="Proszę wypełnić to pole.",app_shop.vars.opinions_not_email="Podano niepoprawny adres email.",app_shop.vars.rate_opinion="Przyjmujemy tylko jedno zgłoszenie per opinia.";class Opinions{constructor(e={}){this.selector=e?.opinionsWrapper||document.querySelector("#opinions_section"),this.form=e?.form||document.querySelector("#shop_opinion_form")}setOpinionRate(e){const t=e.closest(".opinions-form__rating"),o=t?.querySelector(".opinions-form__rate"),i=t?.querySelector(".opinion_star_input"),n=Array.from(t?.querySelectorAll(".opinions__star"));return n.forEach((e=>e.classList.remove("--active"))),n?.reduce(((t=!1,o)=>(t||o.classList.add("--active"),o===e&&(t=!0),t)),!1),i?.setAttribute("value",e.getAttribute("rel")),!!o&&(o.innerText=e.getAttribute("title"),!0)}opinionFilter(e){const t=document.querySelector(".opinions__more");t&&(t.style.display="none");(document.querySelector("#opinions_filter_confirmed:checked")?document.querySelectorAll('.opinions__list .opinion[data-confirmed="true"]'):document.querySelectorAll(".opinions__list .opinion")).forEach((t=>{t.getAttribute("data-opinion_rate")===e.id||e.classList.contains("--active")?t.setAttribute("data-hide",!1):t.setAttribute("data-hide",!0)})),e.classList.toggle("--active"),document.querySelectorAll(`.opinions__rating:not([id="${e.id}"])`).forEach((e=>{e.classList.remove("--active")})),app_shop.vars.view>2&&document.getElementById("opinions_section").scrollIntoView({behavior:"smooth"}),document.querySelector('.opinion[data-hide="false"]')?document.getElementById("no_opinions_of_type").classList.add("d-none"):document.getElementById("no_opinions_of_type").classList.remove("d-none")}async opinionRate(e){if(e?.closest(".opinion__rating")?.classList.contains("--disable"))return Alertek.Start(app_shop.vars.rate_opinion),!1;e?.classList.add("--loading");const t=e?.parentNode?.querySelector("input[name=opinionId]")?.getAttribute("value"),o=e.querySelector("input[name=opinionState]")?.getAttribute("value"),i=e?.parentNode.querySelector("input[name=iai-recaptcha-token]")?.getAttribute("value"),n=new FormData;n.set("id",t),n.set("operation",o),i&&n.set("iai-recaptcha-token",i);try{const t=await fetch("/ajax/opinions.php?action=rate",{method:"POST",body:n}),o=await t.json();e?.closest(".opinion__rating")?.classList.add("--disable"),o?.errors.length&&Alertek.Start(o.errors[0].faultString),o?.errors&&Alertek.Start(o.errors?.faultString),o?.result&&e.querySelector(".opinion__ratecount")&&(e.classList.contains("--yes")&&(e.querySelector(".opinion__ratecount").innerText=o?.result?.score_positive||""),e.classList.contains("--no")&&(e.querySelector(".opinion__ratecount").innerText=o?.result?.score_negative||"")),e?.classList.remove("--loading")}catch(t){return e?.classList.remove("--loading"),!1}}moreOpinions(){document.querySelectorAll('#opinions_section .opinions__list [data-hide="true"]').forEach((e=>{e?.setAttribute("data-hide","false")}));const e=document.querySelector(".opinions__more");e&&(e.style.display="none"),document.querySelector(".opinions__list")?.classList.add("--show")}showPhoto(e){const t=e.getAttribute("href"),o=e.querySelector("img")?.getAttribute("title"),i=new Image;i.src=t,i.onload=function(){Modal({html:`<div id="ui-dialogimg"><img alt="${o}" src="${t}" /></div>`})}}filterConfirmedOpinions(e){const t=document.querySelector(".opinions__more");t&&(t.style.display="none");const o=document.querySelector(".opinions__rating.--active");(o?document.querySelectorAll(`.opinion[data-opinion_rate="${o.id}"]`):document.querySelectorAll(".opinion")).forEach((t=>{e.checked&&"false"===t.getAttribute("data-confirmed")?(t.setAttribute("data-hide",!0),app_shop.vars.view>2&&document.getElementById("opinions_section").scrollIntoView({behavior:"smooth"})):t.setAttribute("data-hide",!1)})),document.querySelector('.opinion[data-hide="false"]')?document.getElementById("no_opinions_of_type").classList.add("d-none"):document.getElementById("no_opinions_of_type").classList.remove("d-none")}setEvents(){const e=this.selector;e&&(document.addEventListener("click",(e=>{const{target:t}=e;if(t.closest(".opinions-form .opinions__star"))return e.preventDefault(),this.setOpinionRate(t.closest(".opinions__star")),!1})),e.addEventListener("click",(t=>{const{target:o}=t;return o.closest(".opinions__rating")?(t.preventDefault(),this.opinionFilter(o?.closest(".opinions__rating")),!1):o.closest(".opinion__rating a")?(t.preventDefault(),this.opinionRate(o.closest(".opinion__rating a")),!1):o.closest(".opinions__more_txt")?(t.preventDefault(),this.moreOpinions(o.closest(".opinions__more_txt")),!1):o.closest("#opinions_section .opinion__photo a")?(t.preventDefault(),this.showPhoto(o.closest("#opinions_section .opinion__photo a")),!1):!o.closest("#show_opinion_form")||(t.preventDefault(),Modal({element:e.querySelector(".opinions-form"),classList:"--add-opinion"}),!1)})),e.addEventListener("change",(e=>{const{target:t}=e;return!t.closest("#opinions_filter_confirmed")||(this.filterConfirmedOpinions(t.closest("#opinions_filter_confirmed")),!1)})))}init(){this.setEvents()}}app_shop.run((function(){app_shop.fn.opinions=new Opinions,app_shop.fn.opinions.init()}),"all","#opinions_section",!0);
(async()=>{const e=()=>document.querySelector("#projector_photos");if(!e())return void app_shop.vars.utils.debug("Gallery Init","PROJECTOR",'element "#projector_photos" nie istnieje');const t=()=>e()?.querySelector("#photos_slider");if(!t())return void app_shop.vars.utils.debug("Gallery Init","PROJECTOR",'element "#photos_slider" nie istnieje');const{Slider:l,SliderThumbnails:a,getGalleryConfiguration:i}=await appModules.load("Slider");if(!l||!a||!i)return!1;const r="object"==typeof projectorGalleryCustomSettings?projectorGalleryCustomSettings:{},{sliderConfig:n={galleryCallbacks:{}}}=app_shop?.vars??{};n.galleryCallbacks={galleryConfigInit:r?.galleryConfigInit??(async e=>({options:e})),thumbnails:{beforeInit:r?.thumbnails?.beforeInit??(async(e,t)=>({result:!0,options:{}})),afterInit:r?.thumbnails?.afterInit??(async e=>{}),beforeSetup:r?.thumbnails?.beforeSetup??(async(e,t)=>({result:!0,options:{}})),afterSetup:r?.thumbnails?.afterSetup??(async e=>{})},gallery:{beforeInit:r?.gallery?.beforeInit??(async(e,t)=>({result:!0,options:{}})),afterInit:r?.gallery?.afterInit??(async e=>{}),beforeSetup:r?.gallery?.beforeSetup??(async(e,t)=>({result:!0,options:{}})),afterSetup:r?.gallery?.afterSetup??((e,t)=>{})},galleryModal:{beforeInit:r?.galleryModal?.beforeInit??(async(e,t)=>({result:!0,options:{}})),afterInit:r?.galleryModal?.afterInit??(async e=>{}),thumbnails:{beforeInit:r?.galleryModal?.thumbnails?.beforeInit??(async(e,t)=>({result:!0,options:{}})),afterInit:r?.galleryModal?.thumbnails?.afterInit??(async e=>{}),beforeSetup:r?.galleryModal?.thumbnails?.beforeSetup??(async(e,t)=>({result:!0,options:{}})),afterSetup:r?.galleryModal?.thumbnails?.afterSetup??((e,t)=>{})},gallery:{beforeInit:r?.galleryModal?.gallery?.beforeInit??(async(e,t)=>({result:!0,options:{}})),afterInit:r?.galleryModal?.gallery?.afterInit??(async e=>{}),beforeSetup:r?.galleryModal?.gallery?.beforeSetup??(async(e,t)=>({result:!0,options:{}})),afterSetup:r?.galleryModal?.gallery?.afterSetup??(async e=>{})}}};class s extends l{constructor({beforeInit:e=n.galleryCallbacks.gallery.beforeInit,afterInit:t=n.galleryCallbacks.gallery.afterInit,beforeSetup:l=n.galleryCallbacks.gallery.beforeSetup,afterSetup:a=n.galleryCallbacks.gallery.afterSetup}={}){super({beforeInit:e,afterInit:t,beforeSetup:l,afterSetup:a})}async init({thumbnails:e,prefix:t="#photos_slider",options:l={}}={}){const a=await super.init({options:{slidesPerView:1,on:{init:this.onSliderInit.bind(this),slideChange:this.slideChangeTransitionEnd.bind(this),slideChangeTransitionEnd:this.slideChangeTransitionEnd.bind(this)},...l}});return this.prefix=t,e&&this.setThumbnails(e),a}onSliderInit(){document.querySelector(`${this.prefix}.photos__slider[data-skeleton]`)?.removeAttribute("data-skeleton")}setTabindex(){document.querySelectorAll(`${this.prefix} .photos__figure:not(.--nav)`).forEach((e=>e.removeAttribute("tabindex"))),document.querySelector(`${this.prefix} .photos__figure:not(.--nav).swiper-slide-active`)?.setAttribute("tabindex","0")}slideChangeTransitionEnd(){this.setTabindex();const e=document.querySelector(`${this.prefix} .photos__figure.--video.swiper-slide-active video[data-src]`);if(e){const t=e.getAttribute("data-src");if(!t)return void app_shop.vars.utils.debug("ProjectorGallery","slideChangeTransitionEnd","Atrybut data-src nie istnieje w elemencie: ",e);e.setAttribute("src",t),e.removeAttribute("data-src")}const t=document.querySelector(`${this.prefix} .photos__figure.--video:not(.swiper-slide-active) video[src]`);t&&t.pause();const l=document.querySelector(`${this.prefix} .photos__figure.--video.swiper-slide-active video[src]`);l&&l.play()}}class o{constructor({afterClose:e=()=>{},modalOptions:t={},extend:l=!0}={}){if(!this.globalModalExists())return void app_shop.vars.utils.debug("GalleryModal","constructor","klasa Modal nie istnieje w globalnym scope!");this.prefix="#galleryModal",this.thumbnails=new a({beforeInit:n.galleryCallbacks.galleryModal.thumbnails.beforeInit,afterInit:n.galleryCallbacks.galleryModal.thumbnails.afterInit,beforeSetup:n.galleryCallbacks.galleryModal.thumbnails.beforeSetup,afterSetup:n.galleryCallbacks.galleryModal.thumbnails.afterSetup}),this.slider=new s({beforeInit:n.galleryCallbacks.galleryModal.gallery.beforeInit,afterInit:n.galleryCallbacks.galleryModal.gallery.afterInit,beforeSetup:n.galleryCallbacks.galleryModal.gallery.beforeSetup,afterSetup:n.galleryCallbacks.galleryModal.gallery.afterSetup});const i=l?{notInit:!0,classList:"gallery_modal",restoreViewport:!0,afterClose:()=>{"function"==typeof e&&e(),this.thumbnails?.destroy?.(),this.slider?.destroy?.()},allowedElementsForTabIndex:'a, button, input, textarea, [tabindex="0"]',...t}:t;this.galleryModal=new Modal(i)}globalModalExists(){return"function"==typeof Modal}wrapSwiperSlidesZoom(e){e?.querySelectorAll(".swiper-slide:not(.--video)")?.forEach((e=>{const t=document.createElement("div");t.classList.add("swiper-zoom-container");const l=e.innerHTML;t.innerHTML=l,e.innerHTML=t.outerHTML}))}createGalleryModalWrapper({sliderClone:e,thumbnailsClone:t}){const l=document.querySelector("#GalleryModalTemplate")?.content?.cloneNode(!0),a=l?.querySelector(".gallery_modal__sliders");return a?(t&&(a.appendChild(t),a.setAttribute("data-thumbnails",!0),a.setAttribute("data-thumbnails-enable",!0)),a.appendChild(e),l):null}replaceHighResImages(e){e?.querySelectorAll(".swiper-slide")?.forEach((e=>{const t=e.querySelector("picture source[srcset][data-img_high_res_webp]"),l=t?.getAttribute("data-img_high_res_webp");l&&t&&t.setAttribute("srcset",l);const a=e.querySelector("img[src][data-img_high_res]"),i=a?.getAttribute("data-img_high_res");i&&a&&a.setAttribute("src",i)}))}async initSliderOptions(){if(!await this.slider.init({prefix:"#modal.gallery_modal #photos_slider",options:{uniqueNavElements:!1,pagination:{el:"#galleryModal .galleryPagination .swiper-pagination"},navigation:{nextEl:app_shop.vars.view<3?"#galleryModal .galleryNavigation .swiper-button-next":"#galleryModal > .galleryNavigation .swiper-button-next",prevEl:app_shop.vars.view<3?"#galleryModal .galleryNavigation .swiper-button-prev":"#galleryModal > .galleryNavigation .swiper-button-prev"},zoom:!0,autoHeight:!1}}))return app_shop.vars.utils.debug("GalleryModal","(async) initSliderOptions","Nie udało się zainicjalizować slidera."),!1;const{Zoom:e}=this.slider.swiperModule[this.slider.settings.defaultModule];e&&this.slider.extendModules([e]);return!!await this.thumbnails.init({options:{direction:app_shop.vars.view<3?"horizontal":"vertical",slidesPerView:"auto",spaceBetween:"10px",navigation:{nextEl:"#galleryModal #photos_nav .swiper-button-next",prevEl:"#galleryModal #photos_nav .swiper-button-prev"}}})||(app_shop.vars.utils.debug("GalleryModal","(async) initSliderOptions","Nie udało się zainicjalizować slidera miniaturek."),!1)}watchCounter(e){const t=document.querySelector(`${this.prefix} .gallery_modal__counter`);t&&e.watchEvent("slideChange",(e=>{const l=`<b>${e.realIndex+1}</b> / ${e.slides.length}`;t.innerHTML=l}))}attachOneClickZoom(e){const t=document.querySelector(e.prefix);if(!t)return;let l=null,a=!1;const i=e=>({x:e.clientX||e.touches?.[0]?.clientX,y:e.clientY||e.touches?.[0]?.clientY});t.addEventListener("pointerdown",(e=>{e.target.closest(".swiper-slide:not(.--video)")&&!a&&(l=i(e))})),t.addEventListener("pointerup",(t=>{const r=t.target.closest(".swiper-slide:not(.--video)");if(!r||a||!l)return;const n=e.slider.zoom,s=r.querySelector(".swiper-zoom-container"),o=s.querySelector("picture")||s.querySelector("img"),u=i(t),d=app_shop.fn.isTouchEnabled()?Math.abs(u.x-l.x)>5||Math.abs(u.y-l.y)>5:u.x!==l.x||u.y!==l.y;if(d||n.scale&&1!==n.scale)d||n.out();else{const e=r.getBoundingClientRect(),t=o.getBoundingClientRect(),l=(e.width-t.width)/2,a=(e.height-t.height)/2;n.in();const i=(e.width/2-(u.x-e.left))*n.scale,d=(e.height/2-(u.y-e.top))*n.scale,p=e.width-l*n.scale,c=e.height-a*n.scale,h=Math.max(-p,Math.min(p,i)),g=Math.max(-c,Math.min(c,d));s.style.transform=`translate3d(${h}px, ${g}px, 0px)`,o.style.transform=`translate3d(0px,0px,0px) scale(${n.scale})`}l=null,a=!0,setTimeout((()=>{a=!1}),300)}))}attachGallerySliderEvents(e){return this.watchCounter(e),this.attachOneClickZoom(e),this}async init({sliderClone:e,thumbnailsClone:t,slideIndex:l=0}){const a=this.createGalleryModalWrapper({sliderClone:e,thumbnailsClone:t});if(!a)return app_shop.vars.utils.debug("GalleryModal","(async) init",'Metoda "createGalleryModalWrapper" zwróciła wynik: ',a),!1;if(!await this.initSliderOptions())return app_shop.vars.utils.debug("GalleryModal","(async) init","Nie udało się zainicjalizować sliderów."),!1;const i=a.querySelector("#photos_slider"),r=a.querySelector("#photos_nav_list");return this.slider.options?.zoom&&this.wrapSwiperSlidesZoom(a),this.replaceHighResImages(a),this.galleryModal.params.element=a,this.galleryModal.init(),r&&(await this.thumbnails.setupSlider({element:r}),this.slider.setThumbnails(this.thumbnails),n.galleryCallbacks.galleryModal?.thumbnails?.afterSetup?.(this.thumbnails)),this.attachGallerySliderEvents(this.slider),await this.slider.setupSlider({element:i}),n.galleryCallbacks.galleryModal?.gallery?.afterSetup?.(this.slider),this.slider.setSlide(l),this.galleryModal.assignTabIndexes(),!0}}async function u({ev:e,sliderElementClone:t,thumbnailsElementClone:l,gallerySettings:a}){if(e.target instanceof HTMLElement&&(e.target?.closest("#projector_photos .photos__figure:not(.--nav)")||e.target?.closest("#projector_photos .photos__figure.--nav.--more"))){const i=e.target.closest(".photos__figure");if(!i)return void app_shop.vars.utils.debug("initGalleryModal","PROJECTOR","target nie pasuje do selektora .photos__figure: ",i);const{result:r,options:s={}}=await(n.galleryCallbacks.galleryModal.beforeInit?.({},a))??{};if(!r)return void app_shop.vars.utils.debug("initGalleryModal","PROJECTOR","parametr result z callbacka galleryModal.beforeInit zwrócił: ",r);const u=i.classList.contains("--more")?0:Number(i.getAttribute("data-slide-index")),d=t?.cloneNode(!0),p=l?.cloneNode(!0);if(!d)return void app_shop.vars.utils.debug("initGalleryModal","PROJECTOR","klon slidera nie istnieje: ",d);const c=new o(s),h=await c.init({sliderClone:d,thumbnailsClone:p,slideIndex:u});if(!h)return void app_shop.vars.utils.debug("initGalleryModal","PROJECTOR","nie udało się zainicjalizować modala galerii: ",h);await(n.galleryCallbacks.galleryModal.afterInit?.(c,a))}}async function d(){const l=e(),r=t();if(!l)return void app_shop.vars.utils.debug("createGalleryConfiguration","PROJECTOR",'element "#projector_photos" nie istnieje');if(!r)return void app_shop.vars.utils.debug("createGalleryConfiguration","PROJECTOR",'element "#photos_slider" nie istnieje');const o=l.querySelector("#photos_nav"),d=r.cloneNode(!0),p=o?.cloneNode(!0),c=i(l),{options:h={}}=n.galleryCallbacks.galleryConfigInit(c)??{},g={...c,...h},y=Number(r.getAttribute("data-photos-count"));if(!Number.isNaN(y)&&y>1){const{thumbnails:e=null}=await async function({gallerySettings:e,thumbnailsElement:t}){const{thumbnailsDirection:l,thumbnailsCount:i,thumbnailsEnabled:r}=e;if(!r)return app_shop.vars.utils.debug("initThumbnailsSlider","(async)","Miniaturki zostały wyłączone w konfiguracji"),{thumbnails:null};const s=t?.querySelector("#photos_nav_list");if(!s)return app_shop.vars.utils.debug("initThumbnailsSlider","(async)","Wskazany kontener dla miniaturek nie istnieje"),{thumbnails:null};const o=new a({beforeInit:n.galleryCallbacks.thumbnails.beforeInit,afterInit:n.galleryCallbacks.thumbnails.afterInit,beforeSetup:n.galleryCallbacks.thumbnails.beforeSetup,afterSetup:n.galleryCallbacks.thumbnails.afterSetup});return await o.init({options:{direction:app_shop.vars.view<3?"horizontal":l,slidesPerView:i,navigation:{nextEl:"#photos_nav .swiper-button-next",prevEl:"#photos_nav .swiper-button-prev"}}})?(await o.setupSlider({element:s}),{thumbnails:o}):(app_shop.vars.utils.debug("initThumbnailsSlider","(async)","Nie udało się zainicjalizować slidera miniaturek."),{thumbnails:null})}({gallerySettings:g,thumbnailsElement:o});await async function({thumbnails:e,gallerySettings:t,sliderElement:l}){const a=l?.querySelectorAll(".swiper-slide"),{enableFadeEffect:i,centeredSlides:r,enableFreeMode:n,sliderEnabled:o}=t,u=new s;return await u.init({thumbnails:e,options:{autoHeight:!r,navigation:{nextEl:"#photos_slider .swiper-button-next",prevEl:"#photos_slider .swiper-button-prev"}}})?(i&&u.enableFadeEffect(),n&&u.enableFreeMode(),a.length>1&&o&&(await u.setupSlider({element:l}),u.setTabindex()),{slider:u}):(app_shop.vars.utils.debug("initGallerySlider","(async)","Nie można zainicjalizować slidera."),null)}({thumbnails:e,gallerySettings:g,sliderElement:r})}await async function({photosContainer:e,sliderElementClone:t,thumbnailsElementClone:l,gallerySettings:a}){e.addEventListener("click",(async e=>{await u({ev:e,gallerySettings:a,sliderElementClone:t,thumbnailsElementClone:l})})),e.addEventListener("keydown",(async e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),await u({ev:e,gallerySettings:a,sliderElementClone:t,thumbnailsElementClone:l}))}))}({photosContainer:l,gallerySettings:g,sliderElementClone:d,thumbnailsElementClone:p})}app_shop.fn.createGalleryConfiguration=d,await d()})();
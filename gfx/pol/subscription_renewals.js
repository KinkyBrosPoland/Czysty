class SubscrRenewals extends Subscr{constructor(t={}){super(t),this.defaultCard={icon:"/gfx/standards/payment_group_card.svg",alt:"Default card icon",number:"**** ****"},this.orderStatus={t:this.txt["wysłane"],a:this.txt.realizowane,n:this.txt["przyjęte"],w:this.txt["oczekuje na wpłatę"],d:this.txt["oczekuje na dostawę"],o:this.txt.realizowane,wp:this.txt["oczekuje na termin pakowania"],b:this.txt.pakowane,br:this.txt.spakowane,p:this.txt["gotowe do wysłania / odbioru"],wr:this.txt["oczekuje na termin odbioru"],wd:this.txt["oczekuje na termin wysłania"],k:this.txt.anulowane,i:this.txt.odrzucone,s:this.txt.anulowane,z:this.txt.zwrot,r:this.txt.reklamacja,h:this.txt.wstrzymane,j:this.txt["połączone"],l:this.txt.zgubione,u:this.txt["niepotwierdzone - oczekuje na akceptację klienta"]},this.icons={simple_transfer:"/gfx/standards/payment_group_simple_transfer.svg",card:"/gfx/standards/payment_group_card.svg",transfer:"/gfx/standards/payment_group_transfer.svg",installment:"/gfx/standards/payment_group_installment.svg",others:"/gfx/standards/payment_group_others.svg",tradeCredit:"/gfx/standards/payment_group_trade_credit.svg",dvp:"/gfx/standards/payment_group_dvp.svg"},this.names={simple_transfer:this.txt["Przelew zwykły"],card:this.txt["Karta płatnicza"],transfer:this.txt["Przelew online"],installment:this.txt["Płatność ratalna"],others:this.txt["Bony, karty podarunkowe"],tradeCredit:this.txt["Faktura na termin"],dvp:this.txt.Pobranie}}async fetchOrders(t=0){const{subscriptionOrders:e}=await super.getData({name:"orders",state:{page:t}})||{};return e}getPaymentIcon(t){if(t.methodAsGroup)return{src:t.icon_svg||t.icon,alt:t.name};if(153===t.id)return{src:this.icons.tradeCredit,alt:this.names.tradeCredit};const e=t.paymentChannel.id;return this.icons[e]?{src:this.icons[e],alt:this.names[e]}:{src:t.icon_svg||t.icon,alt:t.name}}getPaymentName(t){const e=t.paymentChannel.id;return"card"===e?this.defaultCard.number:t.methodAsGroup?t.name:153===t.id?this.names.tradeCredit:this.names[e]?this.names[e]:t.name}setId(t,e){const s=e.querySelector(`.${this.prefix}_renewal__id`);if(!s)return;const{resultCount:r,currentPage:n,limitPerPage:a}=this.vars.pagination,i=r-n*a-t;s.textContent=`${i}.`}setLink(t,e){const s=e.querySelector(`.${this.prefix}_renewal__order_link`);if(!s)return;const{link:r,orderNumber:n}=t;s.innerHTML=`<span class="sr-only">${this.txt["Zamówienie nr"]}</span>${n}`,s.href=r}setDate(t,e){const s=e.querySelector(`.${this.prefix}_renewal__order_date`);if(!s)return;const{orderDate:r}=t;s.textContent=r?.split(" ")?.[0]||r}setStatus(t,e){const s=e.querySelector(`.${this.prefix}_renewal__status`);if(!s)return;const{status:r}=t;s.textContent=this.orderStatus[r]||this.txt.realizowane}setPrice(t,e){const s=e.querySelector(`.${this.prefix}_renewal__price`);if(!s)return;const{worthOrderCurrency:{formatted:r}={}}=t;s.textContent=r}setCard(t,e){const s=e.querySelector(`.${this.prefix}_renewal__card_icon img`);if(!s)return;const r=e.querySelector(`.${this.prefix}_renewal__card_number`);if(!r)return;const{payment:{paymentMethod:n}={}}=t,{src:a,alt:i}=this.getPaymentIcon(n);s.src=a,s.alt=i;const o=this.getPaymentName(n);r.textContent=o}setDocuments(t,e){const s=e.querySelector(`.${this.prefix}_renewal__documents`);if(!s)return;const{documents:r=[]}=t;r?.length?r.forEach((t=>{const e=document.createElement("a");e.classList.add(`${this.prefix}_renewal__document`,t.type),e.textContent=t.name,e.href=t.link,e.setAttribute("target","_blank"),s.append(e)})):s.remove()}getOrder(t,e){const s=document.getElementById(`${this.prefix}_renewal_template`)?.content.cloneNode(!0);return!(!s||!s.firstChild)&&(this.setId(e,s),this.setLink(t,s),this.setDate(t,s),this.setStatus(t,s),this.setPrice(t,s),this.setCard(t,s),this.setDocuments(t,s),s.firstChild)}initOrders(){const t=this.renewalsElement.querySelector(`.${this.prefix}_renewals__items`);t&&this.vars.orders.forEach(((e,s)=>{const r=this.getOrder(e,s);r&&t.append(r)}))}initPagination(){const t=this.renewalsElement.querySelector(`.${this.prefix}_renewals__more`);if(!t)return;const{resultPage:e=1,currentPage:s=0}=this.vars.pagination||{};s+1===e&&t.remove()}async onClickMore(){const t=Date.now();this.renewalsElement.classList.add("--loading");const{currentPage:e=0}=this.vars.pagination||{},{results:s,subscriptionOrders:r}=await this.fetchOrders(e+1)||{};s&&r?(this.vars.pagination=s||{},this.vars.orders=r||[],this.initOrders(),this.initPagination(),setTimeout((()=>{this.renewalsElement.classList.remove("--loading")}),super.getDelayTime(t))):setTimeout((()=>{this.renewalsElement.classList.remove("--loading")}),super.getDelayTime(t))}initEvents(){this.renewalsElement.addEventListener("click",(t=>{const{target:e}=t;e.closest(`.${this.prefix}_renewals__more_link`)&&(t.preventDefault(),this.onClickMore())}))}async generate(){const t=document.getElementById(`${this.prefix}_renewals_template`)?.content.cloneNode(!0);if(!t||!t.firstChild)return;const e=this.renewalsElement;if(this.renewalsElement=t.firstChild,this.vars.orders=this.vars.ordersData?.subscriptionOrders||[],!this.vars.orders.length)return e?.remove(),void document.querySelector(this.vars.move.moveSelector)?.remove();this.vars.pagination=this.vars.ordersData?.results||{},this.initOrders(),this.initPagination(),this.initEvents(),e&&document.body.contains(e)?e.replaceWith(this.renewalsElement):super.move({element:this.renewalsElement,...this.vars.move})}async init(t={}){this.vars={afterReady:t.afterReady||(()=>{}),move:t.move||this.vars?.move||{},ordersData:t.ordersData||this.vars?.ordersData||{}},await this.generate(),this.vars.afterReady(this.renewalsElement)}}app_shop.fn.subscrRenewals=new SubscrRenewals;
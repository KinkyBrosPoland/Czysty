class SubscrRebates extends Subscr{constructor(e={}){super(e),this.changeLiteralRenewals=[this.txt["odnowień"],this.txt.odnowienie,this.txt.odnowienia]}getCurrentRebate(){return this.vars.rebatesThresholds.find((e=>e.numberFrom<=this.vars.ordersCount&&e.numberTo>=this.vars.ordersCount))}getNextRebate(){return this.vars.rebatesThresholds.find((e=>e.numberFrom>this.vars.ordersCount))}getNextRebates(){return this.vars.rebatesThresholds.filter((e=>e.numberFrom>this.vars.ordersCount))}initSteps(){const e=this.rebatesElement.querySelector(`.${this.prefix}_rebates__steps`);if(!e)return;const t=this.getNextRebates()||[];if(t.shift(),!t.length)return void e.remove();const r=this.rebatesElement.querySelector(`.${this.prefix}_rebates__steps_wrapper`);r&&t.forEach((e=>{const t=document.getElementById(`${this.prefix}_rebates_steps_template`)?.content.cloneNode(!0);if(!t||!t.firstChild)return;const s="percentage"===e.type?`${e.value}%`:super.formatPrice(e.value);t.firstChild.textContent=`${s} ${this.txt["od %s odnowienia"].format(e.numberFrom)}`,r.append(t)}))}initProgress(){const e=this.rebatesElement.querySelector(`.${this.prefix}_rebates__progress_renewal`);if(!e)return;const t=this.rebatesElement.querySelector(`.${this.prefix}_rebates__progress_discount`);if(!t)return;const r=this.rebatesElement.querySelector(`.${this.prefix}_rebates__progress_bar`);if(!r)return;const s=this.getCurrentRebate(),i=this.getNextRebate(),n=i.numberFrom-this.vars.ordersCount,a=super.changeLiteral(n,{numerals:this.changeLiteralRenewals});e.textContent=this.txt["Brakuje Ci jeszcze %s do rabatu"].format(a);const o="percentage"===i.type?`${i.value}%`:super.formatPrice(i.value);t.textContent=o;const h=(this.vars.ordersCount-(s?.numberFrom||0)+1)/(i.numberFrom-(s?.numberFrom||0)+1);r.setAttribute("style",`--free-percent: ${h}`)}initInfo(){const e=this.rebatesElement.querySelector(`.${this.prefix}_rebates__info`);if(!e)return;const t=this.getNextRebate(),r="percentage"===t.type?`${t.value}%`:super.formatPrice(t.value);e.textContent=this.txt["Od %s dostawy w ramach tej subskrypcji rabat wyniesie -%s"].format(t.numberFrom,r)}initCurrent(){const e=this.rebatesElement.querySelector(`.${this.prefix}_rebates__current`);if(!e)return;const t=this.getCurrentRebate();if(!t)return void e.remove();const r="percentage"===t.type?`${t.value}%`:super.formatPrice(t.value);e.textContent=this.txt["Twój rabat to %s"].format(r)}async generate(){const e=document.getElementById(`${this.prefix}_rebates_template`)?.content.cloneNode(!0);if(!e||!e.firstChild)return;const t=this.rebatesElement;if(!this.getNextRebate()||this.vars.status===this.statuses.finished)return t?.remove(),void document.querySelector(this.vars.move.moveSelector)?.remove();this.rebatesElement=e.firstChild,this.initCurrent(),this.initInfo(),this.initProgress(),this.initSteps(),t&&document.body.contains(t)?t.replaceWith(this.rebatesElement):super.move({element:this.rebatesElement,...this.vars.move})}async init(e={}){this.vars={afterReady:e.afterReady||(()=>{}),move:e.move||this.vars?.move||{},status:e.status||this.vars?.status||this.statuses.active,ordersCount:e.ordersCount||this.vars?.ordersCount||1,rebatesThresholds:e.rebatesThresholds||this.vars?.rebatesThresholds||[]},await this.generate(),this.vars.afterReady(this.rebatesElement)}}app_shop.fn.subscrRebates=new SubscrRebates;
class RebateCodeCOP extends COPModules{constructor(e={}){super(e)}rebateSuccess(){const e=this.rebateCodeElement.querySelector(`.${this.prefix}_rebate_code__input`);if(!e)return;const t=this.rebateCodeElement.querySelector(`.${this.prefix}_rebate_code__text`);t&&(this.rebateCodeElement.classList.remove("--active"),this.rebateCodeElement.classList.add("--filled"),this.rebateCodeElement.setAttribute("data-rebate-code",e.value),t.textContent=e.value,this.removeErrorFromInput(e),document.activeElement.blur(),app_shop.vars.lastFocusedElement=".cop_rebate_code__link.--edit",this.callbacks.afterAdd?.())}removeRebateSuccess(){const e=this.rebateCodeElement.querySelector(`.${this.prefix}_rebate_code__input`),t=this.rebateCodeElement.querySelector(`.${this.prefix}_rebate_code__save`);if(!e||!t)return;const s=this.rebateCodeElement.querySelector(`.${this.prefix}_rebate_code__text`);s&&(this.rebateCodeElement.classList.remove("--active","--filled"),e.disabled=!0,t.disabled=!0,e.value="",this.rebateCodeElement.removeAttribute("data-rebate-code"),app_shop.vars.lastFocusedElement=".cop_rebate_code__add",setTimeout((()=>{s.textContent=""}),200),this.callbacks.afterRemove?.())}addErrorToInput(e,t){const s=e.closest(".f-feedback")||e.parentNode;s.classList.remove("--success");const o=s.querySelector(".f-message");s.classList.add("--error"),o.textContent=t||`${this.txt["Proszę wypełnić to pole"]}.`}removeErrorFromInput(e){const t=e.closest(".f-feedback")||e.parentNode;t.classList.remove("--error");t.querySelector(".f-message").textContent=""}onClickShowInput(){const e=this.rebateCodeElement.querySelector(`.${this.prefix}_rebate_code__input`),t=this.rebateCodeElement.querySelector(`.${this.prefix}_rebate_code__save`);if(!e||!t)return;this.removeErrorFromInput(e),this.rebateCodeElement.classList.remove("--filled"),this.rebateCodeElement.classList.add("--active"),this.rebateCodeElement.querySelector(".cop_rebate_code__field")?.removeAttribute?.("aria-hidden"),e.disabled=!1,t.disabled=!1;const s=e.value.length;e.setSelectionRange(s,s),setTimeout((()=>{e.focus()}),200)}async onClickSaveCode(){const e=this.rebateCodeElement.querySelector(`.${this.prefix}_rebate_code__input`);if(!e)return;const{value:t}=e;if(""===t)return void this.addErrorToInput(e);if(e.closest(".f-feedback.--error"))return;this.removeErrorFromInput(e),this.rebateCodeElement.classList.add("--loading");const s=await this.fetchData({data:this.queries.ACTIVATE_REBATE_CODE(t),linkParameter:"?mutation=activateRebateCode"});this.rebateCodeElement.classList.remove("--loading");const{status:o}=s?.data?.activateRebateCode;if("success"===o)return void this.rebateSuccess();const{message:r}=s?.data?.activateRebateCode?.error;this.addErrorToInput(e,r)}async onClickRemoveCode(e){this.rebateCodeElement.classList.add("--loading");const t=await this.fetchData({data:this.queries.DEACTIVATE_REBATE_CODE(),linkParameter:"?mutation=deactivateRebateCode"});this.rebateCodeElement.classList.remove("--loading");const{status:s}=t?.data?.deactivateRebateCode;this.removeRebateSuccess()}onKeydown(e){13===(e.which||e.keyCode||0)&&e.preventDefault()}onKeyup(e){const t=e.which||e.keyCode||0,{target:s}=e,{value:o}=s;""!==o?(this.removeErrorFromInput(s),13===t&&this.onClickSaveCode(s)):this.addErrorToInput(s)}initEvents(){this.rebateCodeElement.addEventListener("click",(e=>{const{target:t}=e;(t.closest(`.${this.prefix}_rebate_code__add`)||t.closest(`.${this.prefix}_rebate_code__link.--edit`))&&(e.preventDefault(),this.onClickShowInput()),t.closest(`.${this.prefix}_rebate_code__save`)&&(e.preventDefault(),this.onClickSaveCode()),t.closest(`.${this.prefix}_rebate_code__link.--remove`)&&(e.preventDefault(),this.onClickRemoveCode(t))}));const e=this.rebateCodeElement.querySelector("#rebate_code_input");e&&(e.addEventListener("keydown",this.onKeydown.bind(this)),e.addEventListener("keyup",this.onKeyup.bind(this))),document.addEventListener("click",(e=>{const{target:t}=e;t.closest(`.${this.prefix}_rebate_code`)||this.rebateCodeElement&&(this.rebateCodeElement.classList.remove("--active"),this.rebateCodeElement.querySelector(".cop_rebate_code__field")?.setAttribute?.("aria-hidden","true"),this.rebateCodeElement.getAttribute("data-rebate-code")&&this.rebateCodeElement.classList.add("--filled"))}))}generate(){const e=document.getElementById(`${this.prefix}_rebate_code_template`)?.content.cloneNode(!0);if(!e||!e.firstChild)return;const t=this.rebateCodeElement;this.rebateCodeElement=e.firstChild,this.initEvents(),t&&document.body.contains(t)?t.replaceWith(this.rebateCodeElement):this.move({element:this.rebateCodeElement,...this.vars.move})}init(e={}){this.type=e.type||app_shop.vars.copModulesType||"order1",this.vars={afterReady:e.afterReady||(()=>{}),move:e.move||!1},this.callbacks={afterAdd:e.afterAddCallback,afterRemove:e.afterRemoveCallback},this.generate(),this.vars.afterReady(this.rebateCodeElement)}}try{app_shop.fn.copModulesRebateCode=new RebateCodeCOP,app_shop.vars.copModulesClasses.push((()=>{app_shop.fn.copModulesRebateCode=new RebateCodeCOP}))}catch(e){window?.errorLog?.(e)}
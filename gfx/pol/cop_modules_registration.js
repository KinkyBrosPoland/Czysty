class RegistrationCOP extends COPModules{constructor(t={}){super(t)}setLogin(t){const e=document.querySelector("#register_client_checkbox");if(!e)return!1;e.checked=!0,this.onChangeRegister(e),this.updateLoginInput(t)}afterLogin(t){if(t?.data?.client?.login&&t?.data?.client?.isUserOnce&&this.setLogin(t?.data?.client?.login),t?.data?.client?.isUserOnce)return!1;this.registrationElement?.remove(),this.clientExistsElement?.remove()}disableInputs(t){const e=t.querySelectorAll("input, select, a"),i=t.classList.contains("--hidden");e.forEach((t=>{if(i)return t.disabled=!0,void t.setAttribute("tabindex","-1");t.disabled=!1,t.removeAttribute("tabindex")}))}isRegisterActivated(){const t=this.registrationElement?.querySelector?.(`.${this.prefix}_register`);return!!t&&!t.classList.contains("--hidden")}updateLoginInput(t){this.isRegisterActivated()&&this.checkClientExists();const e=this.registrationElement?.querySelector?.('input[name="client_login"]');e&&""===e.value&&(e.value=t,e.classList.add("focused"))}showClientExistsModal(t){const e=this.clientExistsElement.querySelector(`.${this.prefix}_client_exists__email`);e&&(e.textContent=t);const i=this.clientExistsElement.querySelector(`.${this.prefix}_client_exists__action.--recover`);i&&(i.href=`${i.getAttribute("data-link")}${t}`),this.clientExistsModal.init()}async checkClientExists(){const t=document.getElementById("client_email");if(!t)return;const{value:e}=t;if(""===e)return;await this.validate.clientExists(e)&&this.showClientExistsModal(e)}initTitle(){const t=this.registrationElement.querySelector(`.${this.prefix}__title`);t&&("oscop"!==this.type&&"order1"!==this.type||t.remove())}initSwitch(){const t=this.registrationElement.querySelector(`.${this.prefix}_registration__item.--register-switch`);t&&"oscop"!==this.type&&"order1"!==this.type&&t.remove()}initRegister(){const t=this.registrationElement.querySelector(`.${this.prefix}_register`);t&&("oscop"!==this.type&&"order1"!==this.type||(t.classList.add("--hidden"),t.setAttribute("aria-hidden",!0),this.disableInputs(t)))}initClientExists(){const t=document.getElementById(`${this.prefix}_client_exists_template`)?.content.cloneNode(!0);t&&t.firstChild&&(this.clientExistsElement=t.firstChild,this.clientExistsModal=new Modal({element:this.clientExistsElement,classList:"--client-exists",notInit:!0}))}onClickShowPass(t){const e=t.closest(`.${this.prefix}_register__item`);if(!e)return;const i=e.querySelector("input");if(i){if(t.classList.contains("--hide"))return i.type="password",t.textContent=this.txt["Pokaż hasło"],void t.classList.remove("--hide");i.type="text",t.textContent=this.txt["Ukryj hasło"],t.classList.add("--hide")}}onChangeRegister(t){const{checked:e}=t,i=this.registrationElement.querySelector(`.${this.prefix}_register`);i&&(i.classList.toggle("--hidden",!e),e?i.removeAttribute("aria-hidden"):i.setAttribute("aria-hidden","true"),this.disableInputs(i),e&&this.checkClientExists())}onChangePassword(t){const{value:e}=t,i=this.registrationElement.querySelector(`.${this.prefix}_register__item.--password`);i&&(i.classList.toggle("--hidden","y"===e),this.disableInputs(i))}onClickShowSignin(){"client-new"!==this.type?(this.clientExistsModal.closeModal(),this.callbacks.showSignin()):window.location.href="/signin.php"}initEvents(){this.registrationElement.addEventListener("click",(t=>{const{target:e}=t;e.closest(`.${this.prefix}_register__show_pass`)&&(t.preventDefault(),this.onClickShowPass(e.closest(`.${this.prefix}_register__show_pass`)))})),this.registrationElement.addEventListener("change",(t=>{const{target:e}=t;e.closest("#register_client_checkbox")?this.onChangeRegister(e):(e.closest("#client_generate_password1")||e.closest("#client_generate_password2"))&&this.onChangePassword(e)})),this.clientExistsElement&&this.clientExistsElement.addEventListener("click",(t=>{const{target:e}=t;if(e.closest(`.${this.prefix}_client_exists__action.--signin`))return t.preventDefault(),void this.onClickShowSignin()}))}generate(){const t=document.getElementById(`${this.prefix}_registration_template`)?.content.cloneNode(!0);if(!t||!t.firstChild)return;const e=this.registrationElement;if(this.registrationElement=e||t.firstChild,this.initTitle(),this.initSwitch(),this.initRegister(),this.initClientExists(),this.initEvents(),super.addFocus(this.registrationElement),super.addFocusEvents(this.registrationElement),e&&document.body.contains(e))return e.replaceWith(this.registrationElement),void this.validate.reInit();super.move({element:this.registrationElement,...this.vars.move}),this.validate.reInit()}init(t={}){this.type=t.type||app_shop.vars.copModulesType||"oscop",this.vars={afterReady:t.afterReady||(()=>{}),move:t.move||this.vars?.move||{}},this.callbacks={showSignin:t.showSigninCallback||(()=>{})},this.generate(),this.vars.afterReady(this.registrationElement)}}app_shop.fn.copModulesRegistration=new RegistrationCOP;
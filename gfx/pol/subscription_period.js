class SubscrPeriod extends Subscr{constructor(e={}){super(e)}async saveChangePeriod(e){if(!e)return;this.changePeriodElement.closest(".modal")?.classList.add("--loading"),this.periodElement?.classList.add("--loading");const t=this.getChangePeriodInputQuery(e);await super.fetchData({data:this.queries.UPDATE_SUBSCRIPTION(t),linkParameter:"?mutation=subscriptionChangePeriod"}),this.vars.modal.closeModal(),this.callbacks.afterChangePeriod?.()}getChangePeriodInputQuery(e){return`subscriptionEditModel: {\n      subscriptionId: ${this.vars.subscrId},\n      daysInPeriod: ${e},\n    }`}getChangePeriodDayElement(e){const t=document.getElementById(`${this.prefix}_change_period_day_template`)?.content.cloneNode(!0);return!(!t||!t.firstChild)&&(t.firstChild.textContent=`${e} ${this.txt.dni}`,t.firstChild.dataset.day=e,e===this.vars.period&&t.firstChild.classList.add("--active"),t.firstChild)}getChangePeriodModalElement(){const e=document.getElementById(`${this.prefix}_change_period_template`)?.content.cloneNode(!0);if(!e||!e.firstChild)return!1;this.changePeriodElement=e.firstChild;const t=this.changePeriodElement.querySelector(`.${this.prefix}_change_period__days`);return!!t&&(this.vars.possibleDaysInPeriod.forEach((e=>{const i=this.getChangePeriodDayElement(e);i&&t.append(i)})),this.changePeriodElement)}initPeriod(){const e=this.periodElement.querySelector(`.${this.prefix}_period__value`);e&&(e.textContent=`${this.vars.period} ${this.txt.dni}`)}initPossibleDaysInPeriod(){this.vars.possibleDaysInPeriod?.length>1||this.periodElement.querySelector(`.${this.prefix}_period__edit`)?.remove()}initLink(){if(this.vars.status!==this.statuses.finished)return;const e=this.periodElement.querySelector(`.${this.prefix}_period__edit`);e&&e.remove()}onClickChangeDay(e){this.changePeriodElement.querySelector(`.${this.prefix}_change_period__day.--active`)?.classList.remove("--active"),e.classList.add("--active")}onClickEditPeriod(){const e=this.changePeriodElement.querySelector(`.${this.prefix}_change_period__day.--active`);if(!e)return;const{day:t}=e.dataset;+t!==+this.vars.period?this.saveChangePeriod(t):this.vars.modal.closeModal()}onClickChangePeriod(){const e=this.getChangePeriodModalElement();e&&(this.vars.modal=new Modal({element:e,classList:"--subscr --change-period --mobile"}),this.initChangePeriodEvents())}initChangePeriodEvents(){this.changePeriodElement.addEventListener("click",(e=>{const{target:t}=e;t.closest(`.${this.prefix}_change_period__button.--return`)?this.vars.modal.closeModal():t.closest(`.${this.prefix}_change_period__button.--edit`)?this.onClickEditPeriod():t.closest(`.${this.prefix}_change_period__day`)&&this.onClickChangeDay(t.closest(`.${this.prefix}_change_period__day`))}))}initEvents(){this.periodElement.addEventListener("click",(e=>{const{target:t}=e;t.closest(`.${this.prefix}_period__edit`)&&(e.preventDefault(),this.onClickChangePeriod())}))}async generate(){const e=document.getElementById(`${this.prefix}_period_template`)?.content.cloneNode(!0);if(!e||!e.firstChild)return;const t=this.periodElement;this.periodElement=e.firstChild,this.initLink(),this.initPeriod(),this.initPossibleDaysInPeriod(),this.initEvents(),t&&document.body.contains(t)?t.replaceWith(this.periodElement):super.move({element:this.periodElement,...this.vars.move})}async init(e={}){this.vars={afterReady:e.afterReady||(()=>{}),move:e.move||this.vars?.move||{},period:e.period||this.vars?.period||null,status:e.status||this.vars?.status||this.statuses.active,subscrId:e.subscrId||this.vars?.subscrId||null,possibleDaysInPeriod:e.possibleDaysInPeriod||this.vars?.possibleDaysInPeriod||[]},this.callbacks={afterChangePeriod:e.afterChangePeriodCallback||this.callbacks?.afterChangePeriod},await this.generate(),this.vars.afterReady(this.periodElement)}}app_shop.fn.subscrPeriod=new SubscrPeriod;
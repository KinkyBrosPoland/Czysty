app_shop.txt.txt_65642_1="Generowanie banera nie powiodło się",app_shop.txt.affiliateGeneratorProductsOk="Istnieją produkty spełniające powyższe kryteria",app_shop.txt.affiliateGeneratorProductsNone="Brak produktów spełniających powyższe kryteria",app_shop.txt.affiliateGeneratorAjaxError="Wystąpił nieoczekiwany błąd. Proszę spróbować ponownie.",app_shop.txt.affiliateGeneratorCopied="Skopiowano kod bannera",app_shop.fn.colorPicker=(e,t)=>{let a=!1;const r=e=>{let t=Number(e).toString(16);return t.length<2&&(t=`0${t}`),t},o=(e,t,a)=>`#${r(e)}${r(t)}${r(a)}`,n=(e,t)=>(e.addColorStop(0,"black"),t&&e.addColorStop(.5,t),e.addColorStop(1,"white"),e),c=(e,t,a,r)=>{const c=r.getImageData(e.layerX,e.layerY,1,1).data;a.clearRect(0,0,t.width,t.height);let i=a.createLinearGradient(0,t.height,0,0);i=n(i,o(...c)),a.fillStyle=i,a.fillRect(0,0,t.width,t.height)},i=()=>{a=!0},d=()=>{a=!1},l=(e,t,a,r)=>{const o=e.querySelector(t),c=o.getContext("2d"),i=c.createLinearGradient(0,o.height,0,0);return a?(e=>{e.addColorStop(0,"red"),e.addColorStop(.1667,"yellow"),e.addColorStop(.3334,"lime"),e.addColorStop(.5001,"aqua"),e.addColorStop(.6668,"blue"),e.addColorStop(.8335,"magenta"),e.addColorStop(1,"red")})(i):n(i,r),c.fillStyle=i,c.fillRect(0,0,o.width,o.height),{canvas:o,ctx:c,gradient:i}},s=(e,t,a)=>{e.forEach((e=>{t.forEach((t=>{e.addEventListener(t,a)}))}))};e.forEach(((e,r)=>{const p=e.querySelector("input"),u=p.nextElementSibling,f=document.createElement("span");f.className="f-control-feedback --colorPicker",f.style.background=p.value,u.insertAdjacentElement("afterend",f);const m=document.createElement("div");if(m.innerHTML='<div class="color">\n                          <canvas class="color__variety"></canvas>\n                          <canvas class="color__range"></canvas>\n                          <canvas class="color__gray"></canvas>\n                        </div>',u.insertAdjacentElement("afterend",m.firstChild),!e.querySelector(".f-feedback")){const t=document.createElement("div");for(t.className="f-feedback";e.firstChild;)t.appendChild(e.firstChild);e.appendChild(t)}const{variety:v,varietyCtx:h}=(e=>{const{canvas:t,ctx:r}=l(e,".color__range",!0),{canvas:n,ctx:p}=l(e,".color__gray",!1),{canvas:u,ctx:f}=l(e,".color__variety",!1,e.querySelector("input").value);return t.addEventListener("mousemove",(e=>{a&&c(e,u,f,r)})),n.addEventListener("mousemove",(e=>{a&&c(e,u,f,p)})),u.addEventListener("mousemove",(t=>{if(a){const a=f.getImageData(t.layerX,t.layerY,1,1).data;e.querySelector("input").value=o(...a),e.querySelector(".f-control-feedback.--colorPicker").style.background=o(...a)}})),s([t,n,u],["mousedown"],i),s([t,n,u],["mouseup","mouseleave"],d),t.addEventListener("click",(e=>c(e,u,f,r))),n.addEventListener("click",(e=>c(e,u,f,p))),u.addEventListener("click",(t=>{const r=f.getImageData(t.layerX,t.layerY,1,1).data;e.querySelector("input").value=o(...r),e.querySelector(".f-control-feedback.--colorPicker").style.background=o(...r),a=!1})),{variety:u,varietyCtx:f}})(e);e.id=`${t}${r}`,e.classList.add("colorPicker"),f.addEventListener("click",(()=>{e.querySelector(".color").classList.toggle("d-flex")})),p.addEventListener("click",(()=>{e.querySelector(".color").classList.toggle("d-flex")}));const g=()=>{if(!(e=>{if("string"!=typeof e)return!1;if("#"!==e[0])return!1;if(4===e.length||7===e.length){let t,a,r;if(4===e.length?(t=`${e[1]}${e[1]}`,a=`${e[2]}${e[2]}`,r=`${e[3]}${e[3]}`):(t=`${e[1]}${e[2]}`,a=`${e[3]}${e[4]}`,r=`${e[5]}${e[6]}`),!Number.isNaN(parseInt(t,16))&&!Number.isNaN(parseInt(a,16))&&!Number.isNaN(parseInt(r,16)))return!0}return!1})(p.value))return;h.clearRect(0,0,v.width,v.height);let e=h.createLinearGradient(0,v.height,0,0);e=n(e,p.value),h.fillStyle=e,h.fillRect(0,0,v.width,v.height),f.style.background=p.value};p.addEventListener("change",g),p.addEventListener("input",g),p.addEventListener("blur",g)})),document.addEventListener("click",(e=>{document.querySelectorAll(".colorPicker").forEach((t=>!!t.querySelector(".color").classList.contains("d-flex")&&((!e||"click"!==e.type||t===e||!t.contains(e.target))&&(t.querySelector(".color").classList.remove("d-flex"),!0))))}))},app_shop.fn.generateCode=async(e,t)=>{if(!e)return;const a=document.querySelector("form.affiliate.--generator");if(!a)return;app_shop.fn.ajaxLoadSite(1);const r=new FormData(a);try{const o=await fetch("/ajax/affiliate-generator.php?source_code_type="+(a.classList.contains("--js")?"JS":"PHP"),{method:"POST",body:r}),n=await o.text();if(app_shop.fn.ajaxLoadSite(0),t){const a=t(n);return void(e.innerHTML=a)}e.innerHTML=n}catch(e){Alertek.Error(app_shop.txt.txt_65642_1),app_shop.fn.ajaxLoadSite(0)}},app_shop.fn.removeFeedback=e=>{e.classList.remove("--success"),e.classList.remove("--error")};const productsLink=document.querySelector('.affiliate.--generator input[name="link"]');productsLink&&productsLink.addEventListener("click",(()=>{productsLink.value="",app_shop.fn.removeFeedback(productsLink.parentElement)}));const borderRadio=document.querySelectorAll('input[name="border_radio"]');borderRadio&&borderRadio.forEach((e=>{e.addEventListener("click",(()=>{"tak"===e.value?(document.getElementById("border_color").classList.remove("d-none"),document.getElementById("border_width").classList.remove("d-none")):(document.getElementById("border_color").classList.add("d-none"),document.getElementById("border_width").classList.add("d-none"))}))}));const backgroundRadio=document.querySelectorAll('input[name="background_radio"]');backgroundRadio&&backgroundRadio.forEach((e=>{e.addEventListener("click",(()=>{"tak"===e.value?document.getElementById("background").classList.remove("d-none"):document.getElementById("background").classList.add("d-none")}))}));const checkButton=document.querySelector(".affiliate__button.--check");checkButton&&checkButton.addEventListener("click",(async e=>{e.preventDefault();const t=document.querySelector("form.affiliate.--generator");if(!t)return;app_shop.fn.ajaxLoadSite(1);const a=new FormData;a.append("link",productsLink.value);try{const e=await fetch(`/ajax/affiliate-generator.php?${t.classList.contains("--js")?"JS":"PHP"}&spr=t`,{method:"POST",body:a}),r=await e.text();if(app_shop.fn.ajaxLoadSite(0),app_shop.fn.removeFeedback(productsLink.parentElement),'"exist"'===r)return Alertek.Success(app_shop.txt.affiliateGeneratorProductsOk),void productsLink.parentElement.classList.add("--success");Alertek.Error(app_shop.txt.affiliateGeneratorProductsNone),productsLink.parentElement.classList.add("--error")}catch(e){Alertek.Error(app_shop.txt.affiliateGeneratorAjaxError),app_shop.fn.ajaxLoadSite(0)}}));const previewButton=document.querySelector(".affiliate__button.--preview");previewButton&&previewButton.addEventListener("click",(e=>{e.preventDefault(),app_shop.fn.generateCode(document.querySelector(".affiliate__preview"))}));const generateButton=document.querySelector(".affiliate__button.--generate");generateButton&&generateButton.addEventListener("click",(e=>{e.preventDefault(),app_shop.fn.generateCode(document.querySelector('.affiliate textarea[name="output"]'),(e=>e.replace(/\\/g,"")))}));const generatedCode=document.querySelector('.affiliate textarea[name="output"]');async function copyGeneratedCodeToClipboard(e){try{await navigator.clipboard.writeText(e),Alertek.Success(app_shop.txt.affiliateGeneratorCopied)}catch(e){}}generatedCode&&(generatedCode.addEventListener("click",(async e=>{""!==generatedCode.value&&(e.preventDefault(),await copyGeneratedCodeToClipboard(generatedCode.value))})),generatedCode.addEventListener("keydown",(async e=>{"Enter"===e.key&&""!==generatedCode.value&&(e.preventDefault(),await copyGeneratedCodeToClipboard(generatedCode.value))}))),app_shop.run((function(){app_shop.fn.colorPicker(document.querySelectorAll(".affiliate .f-group.--color"),"colorPicker_")}),"all",".affiliate .f-group.--color"),app_shop.run((function(){app_shop.fn.selectAffiliate=new SelectToDropdown({selector:".affiliate:not(.--code) .f-select:not(.f-dropdown)"})}),"all",".affiliate:not(.--code) .f-select");
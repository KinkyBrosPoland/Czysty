class VerificationCOP extends COPModules{constructor(e={}){super(e)}async changePhoneNumberSendData(e){try{const t=await fetch("/ajax/client-new.php?editClient=true&oneclick=paypal",{method:"POST",body:e});return await t.json()}catch(e){return!1}}updateLabelItem(e,t){const i=t.querySelector(`.${this.prefix}_verification__label`);if(i)switch(e){case"billing":i.innerHTML=this.txt["Dane zamawiającego"];break;case"delivery":i.innerHTML=this.txt["Adres dostawy"];break;case"pickup":i.innerHTML=this.txt["Punkt odbioru"];break;case"payer":i.innerHTML=this.txt["Dane na fakturze"]}}updateDataItem(e,t,i,n){const a=t.querySelector(`.${this.prefix}_verification__data_item.--${i}`);a&&(e||n?e&&(a.innerHTML=e):a.remove())}updateNoPhone(e,t){const i=document.getElementById(`${this.prefix}_verification_no_phone_template`)?.content.cloneNode(!0);if(!i||!i.firstChild)return;const n=t.querySelector(`.${this.prefix}_verification__data_item.--no-phone`);n&&(e?(super.addFocus(i.firstChild),super.addFocusEvents(i.firstChild),n.replaceWith(i.firstChild)):n.remove())}updateEdit(e,t){const i=t.querySelector(`.${this.prefix}_verification__edit`);if(i)return e?void(i.href=e):(i.classList.add("--pickup"),i.href="#changePickupPoint",void(i.innerHTML=this.txt["Zmień punkt odbioru"]))}updateItem(e){const t=document.getElementById(`${this.prefix}_verification_item_template`)?.content.cloneNode(!0);if(!t||!t.firstChild)return!1;const{[`${e}Firm`]:i,[`${e}Name`]:n,[`${e}Stock`]:a,[`${e}Street`]:r,[`${e}City`]:s,[`${e}Nip`]:o,[`${e}Email`]:c,[`${e}Phone`]:p,[`${e}NoPhone`]:l,[`${e}Edit`]:u}=this.verificationElement.dataset;return t.firstChild.classList.add(`--${e}`),this.updateLabelItem(e,t),this.updateDataItem(i,t,"firm"),this.updateDataItem(n,t,"name"),this.updateDataItem(a,t,"stock","pickup"===e),this.updateDataItem(r,t,"street","pickup"===e),this.updateDataItem(s,t,"city","pickup"===e),this.updateDataItem(o,t,"nip"),this.updateDataItem(c,t,"email"),this.updateDataItem(p,t,"phone"),this.updateNoPhone(l,t),this.updateEdit(u,t),t}updateItems(){const e=this.verificationElement.querySelector(`.${this.prefix}_verification__block`);if(!e)return;const t=this.updateItem("billing");t&&e.append(t);const i=this.updateItem("delivery");i&&e.append(i);const n=this.updateItem("pickup");if(n&&(this.verificationElement.classList.toggle("--pickup",this.verificationElement.dataset.pickupEnabled),e.append(n)),!this.verificationElement.dataset.payerEnabled)return;const a=this.updateItem("payer");a&&e.append(a)}updatePickupInfo(e){if(!this.verificationElement)return;const t=this.verificationElement.querySelector(`.${this.prefix}_verification__item.--pickup`);if(!t)return;const i=t.querySelector(`.${this.prefix}_verification__data_item.--stock`);if(!i)return;const n=t.querySelector(`.${this.prefix}_verification__data_item.--street`);if(!n)return;const a=t.querySelector(`.${this.prefix}_verification__data_item.--city`);if(!a)return;const{name:r="",address:{buildingAndHouseNumber:s="",street:o="",postcode:c="",city:p=""},elementCallback:l}=e||{};i.textContent=r,n.textContent=s?`${o} ${s}`:o,a.textContent=`${c} ${p}`,this.deliveryElement=l}afterChangeDelivery(e){if(!e)return;if(!e.querySelector('input[name="shipping"]'))return;if(!this.verificationElement)return;const t=e.classList.contains("--pickup");if(this.verificationElement.classList.remove("--pickup"),!t)return;const i=e.querySelector('input[name="pickup_point"]'),n=e.querySelector('input[name="stock"]');if(!i?.value&&!n?.value)return;this.verificationElement.classList.add("--pickup");const a=e.querySelector('input[name="pickup_point_street"]'),r=e.querySelector('input[name="pickup_point_zipcode"]'),s=e.querySelector('input[name="pickup_point_city"]'),o=e.querySelector('input[name="pickup_point_name"]');this.updatePickupInfo({id:i?.value||n.value,name:o?.value,address:{street:a?.value,zipcode:r?.value,city:s?.value,buildingAndHouseNumber:""},elementCallback:e})}afterChangePickup(e){if(!this.verificationElement)return;const{elementCallback:t}=e||{};if(!t)return;t.querySelector('input[name="shipping"]')&&(this.verificationElement.classList.add("--pickup"),this.updatePickupInfo(e))}async onClickChangePhoneNumber(e){const t=e.closest(`.${this.prefix}_verification__data_item.--no-phone`);if(!t)return;const i=t.querySelector("#order2TelInput");if(!i||""===i.value)return;const n=t.querySelector(`.${this.prefix}_verification__phone_value`),{firstname:a,lastname:r,firm:s,nip:o,city:c,street:p,zipcode:l,region:u}=t.dataset;e.classList.add("--loading");const d=new FormData;d.append("client_phone",i.value),d.append("client_firstname",a),d.append("client_lastname",r),s&&d.append("client_firm",s),o&&d.append("client_nip",o),d.append("client_city",c),d.append("client_street",p),d.append("client_zipcode",l),d.append("client_region",u);const h=await this.changePhoneNumberSendData(d),{validationErrors:f=[]}=h||{},m=f.find((e=>21===e.code));if(m)return e.classList.remove("--loading"),void app_shop.fn.copModulesSummary?.validate?.setValidityState?.(i,m.description);n.textContent=i.value,t.classList.add("--completed"),i.disabled=!0}initEvents(){this.verificationElement.addEventListener("click",(e=>{const{target:t}=e;if(t.closest(`.${this.prefix}_verification__phone_confirm`))return e.preventDefault(),void this.onClickChangePhoneNumber(t.closest(`.${this.prefix}_verification__phone_confirm`));t.closest(`.${this.prefix}_verification__edit.--pickup`)&&(e.preventDefault(),app_shop.fn.copModulesDeliveries?.onClickOpenPickup?.(this.deliveryElement))}))}generate(){const e=document.getElementById(`${this.prefix}_verification_template`)?.content.cloneNode(!0);if(!e||!e.firstChild)return;const t=this.verificationElement;this.verificationElement=e.firstChild,this.updateItems(),this.initEvents(),t&&document.body.contains(t)?t.replaceWith(this.verificationElement):this.move({element:this.verificationElement,...this.vars.move})}init(e={}){this.type=e.type||app_shop.vars.copModulesType||"order1",this.vars={afterReady:e.afterReady||(()=>{}),move:e.move||this.vars?.move||{}},this.generate(),this.vars.afterReady(this.verificationElement)}}try{app_shop.fn.copModulesVerification=new VerificationCOP}catch(e){window?.errorLog?.(e)}
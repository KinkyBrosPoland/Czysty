class SetPrefixOnPhoneInput{constructor(e={}){this.phonePrefix="+48",this.ariaLabelTxt=e?.ariaLabelTxt||""}setPrefix(){const e=document.querySelector(`${this.prefixName}__select`),t=document.querySelector(`${this.prefixName}__input`);if(!t||!e)return!1;const i={typingTimer:""},a=e=>{const i=e.querySelector(".f-dropdown-item");t.value=i.getAttribute("data-value"),t.setAttribute("data-prev",t.value)},n=e=>{const i=e.querySelector(".f-dropdown-item.--selected");t.value=i.getAttribute("data-value"),t.setAttribute("data-prev",t.value),e.querySelector(".f-dropdown-toggle").setAttribute("aria-describedby",this.ariaLabelTxt),this.tabindex&&e.querySelector(".f-dropdown-toggle").setAttribute("tabindex","-1")},r=e=>!!document.querySelector(`.f-dropdown-item[data-value="${e}"]`);e&&this?.phonePrefix&&(e.value=this.phonePrefix),this.prefixSelect=new SelectToDropdown({disableMobileView:!1,selector:`${this.prefixName}__select`,generateDropdownCallback:n||!1,afterClickDropdownCallback:a||!1}),t&&(t.addEventListener("focus",(function(){this.value=""})),t.addEventListener("keyup",(function(){clearTimeout(i.typingTimer),i.typingTimer=setTimeout((()=>{""!==this.value&&r(this.value)&&this.setAttribute("data-prev",this.value)}),500)})),t.addEventListener("blur",(function(){this.value=this.value.replaceAll(" ",""),""===this.value&&(this.value=this.getAttribute("data-prev")),r(this.value)||(this.value=this.getAttribute("data-prev"))})))}checkPrefixExist(e){const t=document.querySelector(`${this.prefixName}__wrapper`).querySelectorAll(`${this.prefixName}__wrapper select option`);return Array.prototype.slice.call(t).reduce(((t,i)=>(-1!==e.indexOf(i.innerText)&&(t=i.innerText),t)),!1)}removePrefix(e){const t=document.querySelector(this.phoneInput);if(!t)return!1;const i=this.checkPrefixExist(t.value);if(i)return t.value=t.value.replace(i,"").trimStart(),this.phonePrefix=i,document.querySelector(this.prefixSelect.params.selector).querySelectorAll(".f-dropdown-li").forEach((e=>{e.querySelector("a").getAttribute("data-value")===i&&e.querySelector("a").click()})),!0;const a=document.querySelector(`${this.prefixName}__input`);return!(a&&t.value&&e)||(a.value="",!1)}initEvents(){document.addEventListener("input",(e=>{const{target:t}=e;t.closest(this.phoneInput)&&this.removePrefix()})),document.addEventListener("change",(e=>{const{target:t}=e;t.closest(this.phoneInput)&&this.removePrefix()}))}init(e={}){this.prefixName=e?.prefixName||".client_prefix",this.phoneInput=e?.phoneInput||"#client_phone",this.tabindex=e?.tabindex||!1,this.prefixSelect||(this.setPrefix(),this.initEvents()),this.removePrefix(!0)}}class ContactCOP extends COPModules{constructor(e={}){super(e)}afterLogin(e){const{client:t}=e?.data;if(!t)return;const{email:i,phone:a}=t,n=this.contactElement.querySelector('input[name="client_email"]');n&&""!==i&&(n.value=i,n.classList.add("focused"));const r=this.contactElement.querySelector('input[name="client_phone"]');r&&""!==a&&(r.value=a,r.classList.add("focused")),document.querySelector(".cop_contact__wholesaler")?.remove(),this.phonePrefix.removePrefix(!0),this.validate.removeAllValidityState(this.contactElement),this.validate.validateForm(this.contactElement)}onChangeEmail(e){const t=e.value;this.callbacks.afterChangeEmail(t)}initEvents(){this.contactElement.addEventListener("change",(e=>{const{target:t}=e;t.closest("#client_email")&&this.onChangeEmail(t.closest("#client_email"))}))}generate(){const e=document.getElementById(`${this.prefix}_contact_template`)?.content.cloneNode(!0);if(!e||!e.firstChild)return;const t=this.contactElement;if(this.contactElement=t||e.firstChild,this.initEvents(),super.addFocus(this.contactElement),super.addFocusEvents(this.contactElement),t&&document.body.contains(t))return t.replaceWith(this.contactElement),void this.validate.reInit();super.move({element:this.contactElement,...this.vars.move}),this.validate.reInit()}init(e={}){this.type=e.type||app_shop.vars.copModulesType||"oscop",this.vars={afterReady:e.afterReady||(()=>{}),move:e.move||this.vars?.move||{}},this.callbacks={afterChangeEmail:e.afterChangeEmailCallback||(()=>{})},this.generate(),this.vars.afterReady(this.contactElement),this.phonePrefix=new SetPrefixOnPhoneInput({ariaLabelTxt:this.txt?.["podaj prefix numeru telefonu"]}),this.phonePrefix.init()}}app_shop.fn.copModulesContact=new ContactCOP,app_shop.vars.copModulesClasses.push((()=>{app_shop.fn.copModulesContact=new ContactCOP}));
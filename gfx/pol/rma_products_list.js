const rmaTxt={chooseProducts:"Wybierz towary",complain:"Reklamuj",product:" towar",products:" towary",noDetailsOnComplain:"ProszÄ™ o podanie opisu usterki i powodu reklamacji",noFileSelected:"Nie wybrano pliku",mobile_complain:"Reklamuj towar",cancel_complain:"Zrezygnuj z reklamacji",chooseRmaProducts:"Wybierz produkty do reklamacji"},RmaProductList=function(t){this.params=t,this.vars={productsToComplain:0,dropdowns:null};const e=this;return this.generateDropdowns=()=>{this.vars.dropdowns=new SelectToDropdown({selector:".productslist_quantity .f-select",generateDropdownCallback:t=>{t.nextSibling.classList.remove("d-none")},afterClickDropdownCallback:t=>{"more"!=t.querySelector(".--selected").dataset.value?(t.closest(".productslist_item").querySelector(".productslist_product_action input").checked=!0,t.closest(".productslist_quantity").querySelector(".productslist_quantity__more_input").value=parseFloat(t.closest(".productslist_quantity").querySelector("select").value),this.countProductsToComplain()):(t.closest(".productslist_quantity").querySelector(".productslist_quantity__more_input").value="",t.closest(".productslist_quantity").querySelector(".productslist_quantity__more_input").focus())},disableMobileView:!0})},this.validateNumber=t=>{const e=parseFloat(t.dataset.max),o=parseFloat(t.attributes.step.value);let r=t.value%o!==0?t.value-t.value%o+o:t.value;return r=r>e||r<0?r<0?t.dataset.prev:e:r,t.dataset.prev=r,t.value=r,r},this.inputHandler=()=>{document.querySelectorAll(".productslist_quantity__more_input").forEach((t=>{let o=null;t.addEventListener("keyup",(()=>{clearTimeout(o),o=setTimeout((function(){e.validateNumber(t),t.closest(".productslist_item").querySelector(".productslist_product_action input").checked=t.value>0,e.countProductsToComplain()}),750)})),t.addEventListener("blur",(()=>{t.value=t.dataset.prev}))}))},this.countProductsToComplain=()=>{this.vars.productsToComplain=0,document.querySelectorAll("input.productslist_quantity__more_input").forEach((t=>{this.vars.productsToComplain=parseFloat(this.vars.productsToComplain)+parseFloat(t.value)})),this.changeNextButton(this.vars.productsToComplain)},this.changeNextButton=t=>{t>0?(document.querySelector("#return_go_next").innerHTML=`${rmaTxt.complain} (${t}) ${1==t?rmaTxt.product:rmaTxt.products}`,document.querySelector("#return_go_next").removeAttribute("data-disabled")):(document.querySelector("#return_go_next").innerHTML=rmaTxt.chooseProducts,document.querySelector("#return_go_next").setAttribute("data-disabled",!0))},this.validateForm=()=>{let t=!0;return null==document.querySelector(".productslist_product_action input:checked")?(Alertek.show_alert(rmaTxt.chooseRmaProducts),t=!0,document.querySelector(".productslist_quantity__more_input")?.focus(),!1):(t=!1,document.querySelectorAll(".productslist_item").forEach((e=>{null!==e.querySelector(".productslist_product_action input:checked")&&0==e.querySelector(".productslist_product_comment textarea").textLength&&(null==e.querySelector(".productslist_product_comment .help-block")&&e.querySelector(".productslist_product_comment").insertAdjacentHTML("beforeend",`<span class="help-block validate_message text-danger">${rmaTxt.noDetailsOnComplain}</span>`),e.querySelector(".productslist_product_comment").classList.add("has-error"),t=!0)})),t&&document.querySelector(".productslist_product_comment textarea + .help-block")&&document.querySelector(".productslist_product_comment textarea + .help-block").previousElementSibling.focus(),!t)},this.submitFormHandler=()=>{document.querySelector("#return_go_next").addEventListener("click",(t=>{if(t.preventDefault(),!e.validateForm())return;const o=window.location.pathname+window.location.search;localStorage.setItem("linkToProductsCurrentRMA",o),document.querySelector(".returns_productslist").submit()}))},this.attachmentsShowHandler=()=>{document.querySelectorAll('.productslist_product_attachments a[href="#addComment"]').forEach((t=>{t.addEventListener("click",(e=>{e.preventDefault(),t.classList.add("d-none"),t.closest(".productslist_product_attachments").querySelector(".rma__attachment").classList.remove("d-none"),t.closest(".productslist_product_attachments").querySelector(".rma__attachment input")?.focus()}))}))},this.addMoreFilesEvent=()=>{document.querySelectorAll(".addMoreFiles").forEach((function(t){t.addEventListener("click",(t=>{t.preventDefault();const o=t.target.closest(".rma__attachment"),r=o.querySelector(".prodl_comment_foto").lastElementChild.attributes.for.value+"_clone",l=o.querySelector(".prodl_comment_foto").lastElementChild.cloneNode(!0);l.attributes.for.value=r,l.querySelector("input").id=r,l.querySelector("input").dataset.events=!1,l.querySelector("input").value="",l.querySelector(".prodl_comment_foto__imageName").innerHTML=rmaTxt.noFileSelected,o.querySelector(".prodl_comment_foto").lastElementChild.after(l),l.focus(),e.fakeFileInput()}))}))},this.fakeFileInput=()=>{document.querySelectorAll('input[data-events="false"]').forEach((t=>{t.addEventListener("change",(e=>{const o=e.target.files[0].name;t.closest("label").querySelector(".prodl_comment_foto__imageName").innerHTML=o})),t.dataset.events=!0}))},this.mobileToggleComplainHandler=()=>{document.querySelectorAll(".rma__toggleComplain").forEach((t=>{const e=t.closest(".productslist_item");t.addEventListener("click",(o=>{o.preventDefault(),e.classList.toggle("--opened"),e.classList.contains("--opened")?(t.querySelector("span").innerHTML=rmaTxt.cancel_complain,e.querySelector('.f-dropdown-item[data-index="1"]').click()):(t.querySelector("span").innerHTML=`<i class="icon-plus"></i> ${rmaTxt.mobile_complain}`,e.querySelector('.f-dropdown-item[data-index="0"]').click())}))}))},this.showWarrantyInfo=()=>{app_shop.vars.view>2&&document.querySelectorAll(".productslist_warranty_info__show").forEach((t=>{t.addEventListener("click",(e=>{Modal({html:t.nextSibling.innerHTML,classList:"productslist_warranty_info__modal"})}))}))},this.init=()=>{this.generateDropdowns(),this.countProductsToComplain(),this.submitFormHandler(),this.attachmentsShowHandler(),this.fakeFileInput(),this.addMoreFilesEvent(),this.mobileToggleComplainHandler(),this.showWarrantyInfo(),this.inputHandler()},this.init()};app_shop.run((()=>{app_shop.fn.rmaProductList=new RmaProductList}),"all",".return_productslist.rma");
class ProductsCOP extends COPModules{constructor(t={}){super(t),this.changeLiteralProducts=[this.txt["produktów"],this.txt.produkt,this.txt.produkty],this.changeLiteralDays=[this.txt.dni,this.txt["dzień"],this.txt.dni]}getShippingTime(t){const e=t?this.vars.shippingTimeLater:this.vars.shippingTime,{days:i,hours:s,minutes:r}=e?.shippingTime?.time||{};if(t)return!!i&&super.changeLiteral(i,{numerals:this.changeLiteralDays});const{today:o,weekDay:n,weekAmount:c}=e?.shippingTime||{};if(o)return this.locale.onWeekdays[0];if(c>0){const{day:t,month:e}=this.calculateDate({days:i,hours:s,minutes:r});return`${this.locale.onWeekdays[n]}, ${t}.${e}`}return this.locale.onWeekdays[n]}getGroupByID(t){return!!t&&this.vars.basketGroups.find((e=>e.id===t))}getProductSizeByID(t,e){return null!=e&&t?.data?.sizes?.filter((t=>t?.id?.toString()===e?.toString()))?.[0]}addVisibilityClasses(t){t.forEach(((e,i)=>{i+1===this.vars.numberOfVisibleProducts&&e.classList.add("--last-visible"),i+1===t.length&&e.classList.add("--last"),i+1>this.vars.numberOfVisibleProducts&&(e.classList.add("--hide"),e.setAttribute("aria-hidden","true"),e.querySelectorAll("a").forEach((t=>t.setAttribute("tabindex","-1"))))}))}visibility(t){if(!this.vars.division){const e=t.querySelectorAll(`.${this.prefix}_product`);return void this.addVisibilityClasses(e)}const e=t.querySelectorAll(`.${this.prefix}_product.--now`);this.addVisibilityClasses(e);const i=t.querySelectorAll(`.${this.prefix}_product.--later`);this.addVisibilityClasses(i)}setProductIcon(t,e){const i=e.querySelector(`.${this.prefix}_product__icon`),s=e.querySelector(`.${this.prefix}_product__icon img`);if(!i||!s)return;const{link:r,name:o,icon:n}=t?.data||{};i.href=r,s.alt=o,s.src=n}setProductName(t,e){const i=e.querySelector(`.${this.prefix}_product__name`);if(!i)return;const{link:s,name:r}=t?.data||{};i.href=s,i.textContent=r}setProductTrait(t){const{element:e,trait:i,traitLabel:s,type:r}=t;if(!e)return;if(!i)return void e.parentNode.removeChild(e);if("size"===r&&"uniw"===i)return void e.parentNode.removeChild(e);const o=e.querySelector(`.${this.prefix}_product__trait_value`);if(!o)return void e.parentNode.removeChild(e);o.textContent=i;const n=e.querySelector(`.${this.prefix}_product__trait_label`);s&&n&&(n.textContent=`${s}: `)}setProductTraits(t,e){const i=e.querySelector(`.${this.prefix}_product__trait.--barcode`);this.setProductTrait({element:i,trait:t?.data?.code});const s=e.querySelector(`.${this.prefix}_product__trait.--version`);this.setProductTrait({element:s,trait:t?.data?.versionName,traitLabel:t?.data?.group?.name});const r=e.querySelector(`.${this.prefix}_product__trait.--size`),{id:o,name:n}=this.getProductSizeByID(t,t?.size)||{};this.setProductTrait({element:r,trait:"uniw"===o?o:n,type:"size"});const c=this.getGroupByID(t?.basketGroupId),a=e.querySelector(`.${this.prefix}_product__trait.--subscription-period`);this.setProductTrait({element:a,trait:c?.subscription?.daysInPeriod?`${c?.subscription?.daysInPeriod} ${this.txt.dni}`:""});const d=e.querySelector(`.${this.prefix}_product__trait.--subscription-next`);this.setProductTrait({element:d,trait:c?.subscription?.nextOrder?.formatted?super.getFormattedDate(c?.subscription?.nextOrder?.formatted):""});const l=e.querySelector(`.${this.prefix}_product__traits`);l&&!l.hasChildNodes()&&l.parentNode.removeChild(l)}setProductComment(t,e){const i=e.querySelector(`.${this.prefix}_product__comment`);if(!i)return;const{comment:s}=t||{};s&&""!==s?i.textContent=s:i.remove()}setProductPrice(t,e){const i=e.querySelector(`.${this.prefix}_product__price strong`);if(!i)return;const{forPoints:s,worthPoints:{value:r}}=t||{};if(s)return void(i.textContent=`${r} ${this.txt.pkt}.`);const{worth:{gross:{value:o,formatted:n}}}=t||{};i.textContent=0!==o?n:`${this.txt.Gratis}!`}setProductUnit(t,e){const i=e.querySelector(`.${this.prefix}_product__price span`);if(!i)return;const{quantity:s,data:r}=t||{},{unit:{singular:o,plural:n}={}}=r||{},c=s>1?`${s} ${n}`:o;i.textContent=` / ${c}`}setProductBadge(t,e){const i=e.querySelector(`.${this.prefix}_product__badge`);if(!i)return;const s=this.getGroupByID(t?.basketGroupId);if(!s)return void i.remove();const{types:r=[]}=s||{};r.find((t=>"subscription"===t))?(i.textContent=this.txt.Subskrypcja,i.classList.add("--subscription")):i.remove()}getProduct(t){const e=document.getElementById(`${this.prefix}_product_template`)?.content.cloneNode(!0);return e?(e.firstChild.classList.add(t.availableNow?"--now":"--later"),this.setProductIcon(t,e),this.setProductName(t,e),this.setProductTraits(t,e),this.setProductComment(t,e),this.setProductPrice(t,e),this.setProductUnit(t,e),this.setProductBadge(t,e),e):document.createElement("div")}quantity(){const t=this.productsElement.querySelector(`.${this.prefix}__title_desc`);if(!t)return;const e=this.vars.products.reduce(((t,e)=>t+(0!==e.data?.unit?.precision?1:+e.quantity)),0),i=super.changeLiteral(e,{numerals:this.changeLiteralProducts});t.textContent=`(${i})`}division(){const t=this.productsElement.querySelector(`.${this.prefix}_products__division`);if(!t)return;if(!this.vars.division)return void t.parentNode.removeChild(t);this.productsElement.classList.add("--division","--now");const e=this.getShippingTime(),i=this.getShippingTime(!0),s=t.querySelector(`.${this.prefix}_products__division_item.--now .${this.prefix}_products__division_time`),r=t.querySelector(`.${this.prefix}_products__division_item.--later .${this.prefix}_products__division_time`);s&&r&&(s.textContent=e?` (${this.txt["Wysyłka"]} ${e})`:"",r.textContent=i?` (${this.txt["Wysyłka za"]} ${i})`:"")}products(){const t=this.productsElement.querySelector(`.${this.prefix}_products__products`);t&&(this.vars.products.forEach((e=>{const i=this.getProduct(e);t.appendChild(i)})),this.visibility(t))}changeMoreLiteral(t){const{moreLinkElement:e,division:i,hide:s}=t||{};e&&(i?"now"!==i?"later"===i&&(e.textContent=s?`- ${this.txt["Zwiń listę"]} (${this.txt["przesyłka 2 z 2"]})`:`+ ${this.txt["Pokaż pozostałe produkty"]} (${this.txt["przesyłka 2 z 2"]})`):e.textContent=s?`- ${this.txt["Zwiń listę"]} (${this.txt["przesyłka 1 z 2"]})`:`+ ${this.txt["Pokaż pozostałe produkty"]} (${this.txt["przesyłka 1 z 2"]})`:e.textContent=s?`- ${this.txt["Zwiń listę"]}`:`+ ${this.txt["Pokaż pozostałe produkty"]}`)}more(){const t=this.productsElement.querySelector(`.${this.prefix}_products__more`);if(!t)return;const e=this.productsElement.querySelector(`.${this.prefix}_products__more_link`);if(!e)return;const i=this.vars.division?this.vars.products.filter((t=>t.availableNow)).length:this.vars.products.length;if(!this.vars.division&&i<=this.vars.numberOfVisibleProducts)return this.productsElement.classList.add("--more-hide"),void t.parentNode.removeChild(t);if(!this.vars.division)return void this.changeMoreLiteral({moreLinkElement:e});const s=this.vars.products.filter((t=>!t.availableNow)).length;if(i<=this.vars.numberOfVisibleProducts&&s<=this.vars.numberOfVisibleProducts)return this.productsElement.classList.add("--more-hide"),void t.parentNode.removeChild(t);this.changeMoreLiteral({moreLinkElement:e,division:"now"}),i<=this.vars.numberOfVisibleProducts&&this.productsElement.classList.add("--more-hide-now"),s<=this.vars.numberOfVisibleProducts&&this.productsElement.classList.add("--more-hide-later")}setWcagAttributes(t){t.setAttribute("aria-hidden","true"),t.querySelectorAll("a").forEach((t=>t.setAttribute("tabindex","-1")))}removeWcagAttributes(t){t.removeAttribute("aria-hidden"),t.querySelectorAll("a").forEach((t=>t.removeAttribute("tabindex")))}onClickShowHideProducts(){const t=this.productsElement.querySelector(`.${this.prefix}_products__more_link`),e=this.productsElement.querySelectorAll(".--hide");return this.productsElement.classList.contains("--more")||this.productsElement.classList.contains("--now-more")||this.productsElement.classList.contains("--later-more")?e.forEach((t=>this.setWcagAttributes(t))):e.forEach((t=>this.removeWcagAttributes(t))),this.productsElement.classList.contains("--now")||this.productsElement.classList.contains("--later")?this.productsElement.classList.contains("--now")?(this.productsElement.classList.toggle("--now-more"),this.changeMoreLiteral({moreLinkElement:t,division:"now",hide:this.productsElement.classList.contains("--now-more")}),void this.scrollToElement({element:this.productsElement,forceScroll:!0})):(this.productsElement.classList.toggle("--later-more"),this.changeMoreLiteral({moreLinkElement:t,division:"later",hide:this.productsElement.classList.contains("--later-more")}),void this.scrollToElement({element:this.productsElement})):(this.productsElement.classList.toggle("--more"),this.changeMoreLiteral({moreLinkElement:t,hide:this.productsElement.classList.contains("--more")}),void this.scrollToElement({element:this.productsElement,forceScroll:!0}))}onClickChangeDivision(t){const e=t.closest(`.${this.prefix}_products__division_item`);if(e.classList.contains("--now")&&this.productsElement.classList.contains("--now"))return;if(e.classList.contains("--later")&&this.productsElement.classList.contains("--later"))return;const i=this.productsElement.querySelector(`.${this.prefix}_products__more_link`);if(e.classList.contains("--now"))return this.productsElement.classList.remove("--later"),this.productsElement.classList.add("--now"),this.changeMoreLiteral({moreLinkElement:i,division:"now",hide:this.productsElement.classList.contains("--now-more")}),void("function"==typeof this.callbacks.changeDivisionDelivery&&this.callbacks.changeDivisionDelivery({division:"now"}));this.productsElement.classList.remove("--now"),this.productsElement.classList.add("--later"),this.changeMoreLiteral({moreLinkElement:i,division:"later",hide:this.productsElement.classList.contains("--later-more")}),"function"==typeof this.callbacks.changeDivisionDelivery&&this.callbacks.changeDivisionDelivery({division:"later"})}initEvents(){this.productsElement.addEventListener("click",(t=>{const{target:e}=t;return e.closest(`.${this.prefix}_products__more_link`)?(t.preventDefault(),this.onClickShowHideProducts(),!1):(e.closest(`.${this.prefix}_products__division_item`)&&(t.preventDefault(),this.onClickChangeDivision(e.closest(`.${this.prefix}_products__division_item`))),!0)}))}generate(){const t=document.getElementById(`${this.prefix}_products_template`)?.content.cloneNode(!0);if(!t||!t.firstChild)return;const e=this.productsElement;this.productsElement=t.firstChild,this.quantity(),this.division(),this.products(),this.more(),this.initEvents(),e&&document.body.contains(e)?e.replaceWith(this.productsElement):super.move({element:this.productsElement,...this.vars.move})}init(t={}){this.type=t.type||app_shop.vars.copModulesType||"order1",this.vars={numberOfVisibleProducts:t.numberOfVisibleProducts??2,products:t.basket?.products||this.vars?.products||[],basketGroups:t.basket?.basketGroups||this.vars?.basketGroups||[],shippingTime:t.shipping?.shippingTime||this.vars?.shippingTime||null,shippingTimeLater:t.shipping?.shippingTimeLater||this.vars?.shippingTimeLater||null,division:t.shipping?.settings?.orderDivisionEnabled??this.vars?.division??!1,divisionOff:t.divisionOff??this.vars?.divisionOff??!1,afterReady:t.afterReady||this.vars?.afterReady||(()=>{}),move:t.move||this.vars?.move||{}},this.vars.divisionOff&&(this.vars.division=!1),this.callbacks={changeDivisionDelivery:t.changeDivisionDeliveryCallback||this.callbacks?.changeDivisionDelivery},this.generate(),this.vars.afterReady(this.productsElement)}}try{app_shop.fn.copModulesProducts=new ProductsCOP,app_shop.vars.copModulesClasses.push((()=>{app_shop.fn.copModulesProducts=new ProductsCOP}))}catch(t){window?.errorLog?.(t)}
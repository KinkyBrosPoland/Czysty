const filtersActionsCall=()=>{document.querySelectorAll(".filters__options .--show-hidden").forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault();const t=e.target.closest(".--show-hidden"),{id:r}=t.dataset,o=document.querySelector(`#${r}_content`);o?.classList.toggle("--shown"),t.classList.toggle("--shown")}))}));document.querySelectorAll(".filters__toggler:not(.--not-expandable)").forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault();const t=e.target.closest(".filters__toggler:not(.--not-expandable)");t.classList.toggle("--not-expanded"),t.setAttribute("aria-expanded",t.classList.contains("--not-expanded")?"false":"true")}))}));function e(e){const t=e.parentNode;e.value=e.value.replace(/[^0-9]/g,"");const r=function(e,t){const r=document.createElement("canvas").getContext("2d");return r.font=t,r.measureText(e).width}(e.value,"14px Arial");r>t.offsetWidth-30?e.style.width=t.offsetWidth-30+"px":e.style.width=`${r+10}px`}document.querySelectorAll(".filters__item .f-control[type=checkbox]").forEach((e=>{e.addEventListener("change",(e=>{const t=e.target.closest(".filters__content:not(.--group)");if(!t)return;const r=t.nextElementSibling;if(!r)return;const o=r.querySelector(".--submit.d-none");o&&o.classList.remove("d-none")}))}));document.querySelectorAll("#PriceRangeFrom, #PriceRangeTo").forEach((t=>{t.addEventListener("input",(t=>{e(t.target)})),e(t)}));document.querySelectorAll("#filter_xpress_expand input").forEach((e=>{e.addEventListener("change",(e=>{const{checked:t}=e.target;if(!t)return;const{localized:r}=e.target.dataset;if(!r||"true"===r)return;const o=document.querySelector("#xpress_modal");o&&(app_shop.vars.xpressClicked=e.target.id,Modal({element:o,classList:"--xpress"}))}))}));document.querySelector(".filters__form").addEventListener("submit",(function(e){if(document.querySelector(".filters__price")){const t=document.querySelector("#PriceRangeFrom"),r=document.querySelector("#PriceRangeTo");if(parseFloat(t?.value)>parseFloat(r?.value))return e.preventDefault(),void document.querySelector(".filters__price").classList.add("has-error");document.querySelector(".filters__price").classList.remove("has-error")}}))},Filters=function(e){this.params=e,this.setInputValue=e=>{const{id:t}=e.dataset,r=[...document.querySelectorAll(`input[data-id="${t}"]:checked`)].map((e=>e.value)).join(",");document.querySelector(`#${t}_input`).value=r},this.setLabeLsQuantity=async()=>{const e=await fetch(`/search.php?${this.serialize()}&getProductXML=true&xmlType=filtering`),t=await e.text();[...(new DOMParser).parseFromString(t,"text/xml").querySelectorAll("filter")].forEach((e=>{const{type:t}=e.attributes;let r=e.id.replace(/\[(.*?)\]/g,"$1"),o=document.querySelector(`#${r}_expand`);if("dual"===t.value&&(r="filter_dual",o=document.querySelector("#filter_dual_expand")),o&&"filter_text"!==r){const t=e.querySelectorAll("item");t.length&&[...t].forEach((e=>{const{value:t,quantity:n}=e.attributes,s='label[for="'+r+"_"+t.value+'"] .--quantity',i=o.querySelector(s);i&&(n?(i.classList.remove("d-none"),i.innerHTML=n.value):(i.classList.add("d-none"),i.innerHTML=0))}))}}))},this.getPriceRange=(e="#PriceRangeFrom",t="#PriceRangeTo")=>{const r=document.querySelector(e),o=document.querySelector(t);return`${r.value}-${o.value}`},this.serialize=(e=".__serialize")=>[...this.filtersForm.querySelectorAll(e)].filter((e=>"checkbox"===e.type?e.checked:e.value)).map((e=>`${e.name}=${e.value}`)).join("&"),this.setVisibleExpand=()=>{const e=document.querySelectorAll(".--not-expanded");if(!e.length)return app_shop.fn.cookie.set("filterHidden","",355),!1;const t=[...e].map((e=>e.nextSibling.id));app_shop.fn.cookie.set("filterHidden",t,355)},this.getVisibleExpand=()=>{const e=app_shop.fn.cookie.get("filterHidden");e&&e.split(",").forEach((e=>{const t=document.querySelector(`.filters__expand#${e}`);if(null!==t){const e=t.previousSibling;e.classList.add("--not-expanded"),e.setAttribute("aria-expanded","false")}}))},this.start=()=>{this.filtersForm.querySelectorAll('input[type="checkbox"]').forEach((e=>{e.addEventListener("change",(e=>{const{target:t}=e,{id:r}=t.dataset;r&&this.setInputValue(t),this.getQuantity&&this.setLabeLsQuantity()}))}));document.querySelectorAll("#PriceRangeFrom, #PriceRangeTo").forEach((e=>{e.addEventListener("change",(e=>{const t=document.querySelector("#filter_price_input");t&&(t.value=this.getPriceRange())}))})),this.actionsCall&&this.actionsCall();document.querySelectorAll(".filters__toggler:not(.--not-expandable)").forEach((e=>{e.addEventListener("click",(()=>{this.setVisibleExpand()}))})),this.getVisibleExpand()},this.init=()=>{this.filtersForm=document.querySelector(".filters__form"),this.filtersForm&&(this.actionsCall=filtersActionsCall||null,this.getQuantity=!0,this.start())}};app_shop.run((()=>{app_shop.vars.filtersRef=new Filters,app_shop.vars.filtersRef.init()}),"all","#Filters",!0);const xpressText={geolocationError:"Wystąpił błąd poczas sprawdzania kodu pocztowego. Proszę spróbować ponownie",zipcodeError:"Nie można pobrać kodu pocztowego"};app_shop.fn.xpressCouriersInit=()=>{const e=document.querySelector("#xpress_modal");if(!e)return;const t=new FormValidation({form:e});t.init();const r=()=>{const e=document.querySelector(".modal");e&&e.classList.add("--loading")},o=()=>{const e=document.querySelector(".modal");e&&e.classList.remove("--loading")},n=()=>{const e=document.querySelector("#xpress_error_modal");e&&Modal({element:e,classList:"--xpress-error"})};if(!navigator.geolocation){const e=document.querySelector(".xpress__geolocation");if(!e)return;e.remove()}e.addEventListener("click",(e=>{const{target:s}=e;s.closest(".xpress_submit")&&(e.preventDefault(),(async()=>{const e=document.querySelector("#xpress_zipcode_input");if(!e)return;if(r(),!await t.validateForm())return void o();const{value:s}=e;if(!(await fetch(`/ajax/client-new.php?setClientSamedayLocation=1&zipcode=${s}`,{method:"POST"})).ok)return void n();const i=await fetch("/search.php?&getProductXML=true&xmlType=filtering");if(!i.ok)return void n();const a=await i.text(),l=(new DOMParser).parseFromString(a,"text/xml"),c=l.querySelector("sameday")||l.querySelector("nextday");if(!c)return void n();const d=c.getAttribute("client_localized"),u=c.getAttribute("service_available_for_current_location");if("false"===d||"false"===u)return void n();const p=document.querySelector("#Filters form");p&&p.submit()})()),s.closest(".xpress__get_geo")&&(e.preventDefault(),navigator.geolocation&&(r(),navigator.geolocation.getCurrentPosition((async e=>{const{latitude:r,longitude:n}=e.coords||{},s=`https://nominatim.openstreetmap.org/reverse?format=json&lat=${r}&lon=${n}`,i=await fetch(s),a=await i.json(),{address:{postcode:l}={}}=a||{};if(!l)return o(),void Alertek.show_alert(xpressText.zipcodeError);o();const c=document.querySelector("#xpress_zipcode_input");c&&(c.value=l,c.classList.add("focused"),t.validateForm())}),(()=>{o(),Alertek.show_alert(xpressText.geolocationError)}))))}))},app_shop.run((()=>{app_shop.fn.xpressCouriersInit()}),"all","#xpress_modal",!0);
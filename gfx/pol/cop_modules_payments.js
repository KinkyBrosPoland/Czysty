class PaymentsCOP extends COPModules{constructor(e={}){super(e),this.icons={simple_transfer:"/gfx/standards/payment_group_simple_transfer.svg",card:"/gfx/standards/payment_group_card.svg",transfer:"/gfx/standards/payment_group_transfer.svg",installment:"/gfx/standards/payment_group_installment.svg",others:"/gfx/standards/payment_group_others.svg",tradeCredit:"/gfx/standards/payment_group_trade_credit.svg",dvp:"/gfx/standards/payment_group_dvp.svg"},this.names={simple_transfer:this.txt["Przelew zwykły"],card:this.txt["Karta płatnicza"],transfer:this.txt["Przelew online"],installment:this.txt["Płatność ratalna"],others:this.txt["Bony, karty podarunkowe"],tradeCredit:this.txt["Faktura na termin"],dvp:this.txt.Pobranie},this.descriptions={simple_transfer:this.txt["Zaksięgowanie do 3 dni roboczych"],card:this.txt["Zaksięgowane w kilka minut"],transfer:this.txt["Zaksięgowane w kilka minut"],installment:"",others:this.txt["Zaksięgowane w kilka minut"],tradeCredit:this.txt["Płatność przelewem po dostawie"],blik:this.txt["Zaksięgowane w kilka minut"],paypal:""},this.paymentSystemIds={29:"idopay"}}disableInputs(){this.paymentsElement.querySelectorAll('input:not([name="selected_group_only"]').forEach((e=>{const t=e.closest(`.${this.prefix}_payments__item`);if(!t.querySelector('input[name="selected_group_only"]').checked){e.disabled=!0,e.checked=!1;const s=t.querySelector(`.${this.prefix}_payments__details.--show-all`);if(!s)return;s.classList.remove("--show-all");const n=s.querySelector(`.${this.prefix}_payments__show_all`);if(!n)return;n.textContent=this.txt["Pokaż wszystkie"]}else e.disabled=!1}))}findAssociatedPaymentSystemName(e){return this.paymentSystemIds[e]}findGroupTerms({groupId:e,paymentNames:t}){return this.vars.paymentsGroupTerms.filter((t=>t.groupId===e)).filter((e=>!t||t===[]||t.includes(e.type)))}createClauseFragment(e){const t=document.createElement("span");return t.innerHTML=e,t}prepareClauses(e){return[...e].filter((e=>e)).map((e=>this.createClauseFragment(e)?.outerHTML)).join("")}getPaymentId(e){return e.methodAsGroup||!e.paymentChannel.id?e.id:(+this.vars.defaultPaymentMethodId===+e.id&&(this.vars.defaultPaymentMethodId=e.paymentChannel.id),e.paymentChannel.id)}getPaymentName(e){if(e.methodAsGroup)return e.name;if(153===e.id)return this.names.tradeCredit;const t=e.paymentChannel.id;return this.names[t]?this.names[t]:e.name}getPaymentIcons(e){if(e.methodAsGroup)return[{src:e.icon_svg||e.icon,alt:e.name}];if(153===e.id)return[{src:this.icons.tradeCredit,alt:this.names.tradeCredit}];const t=e.paymentChannel.id;return this.icons[t]?[{src:this.icons[t],alt:this.names[t]}]:[{src:e.icon_svg||e.icon,alt:e.name}]}getPaymentDescription(e){return 153===e.id?this.descriptions.tradeCredit:e.paymentChannel?.id in this.descriptions&&this.descriptions[e.paymentChannel.id]}getPaymentCost(e){const{costPercent:t}=e.additionalClientCost,{value:s}=e.additionalClientCost.costFixedAmount,{value:n}=e.additionalClientCost.minAmount;return(0!==t||0!==s||0!==n)&&e.id}getPaymentDefaultClause(e){if(!e.terms?.supportsPaymentInitiationService)return[];return this.findGroupTerms({groupId:e.paymentChannel?.id,paymentNames:["pis"]}).map((e=>{const t=e?.clausePrefix,s=e?.clause;let n="";return t&&(n+=`${t}: `),s&&(n+=s),n}))}getPaymentOptions(e){return this.vars.payments.filter((t=>t.paymentChannel.id===e.paymentChannel.id&&!1===t.methodAsGroup))}prepareObjectToDisplay(){this.vars.uniquePayments.forEach((e=>{const t={id:this.getPaymentId(e),group:!e.methodAsGroup,icons:this.getPaymentIcons(e),name:this.getPaymentName(e),description:this.getPaymentDescription(e),cost:this.getPaymentCost(e),clause:this.getPaymentDefaultClause(e),options:this.getPaymentOptions(e)};this.vars.formattedUniquePayments.push(t)}))}createPaymentOption(e,t,s){const n=document.getElementById(`${this.prefix}_payments_option`).content.cloneNode(!0),i=n.querySelector("input"),a=`payment_${e.id}_${s}`;i.id=a,i.value=t.id,i.setAttribute("name","payform_id");n.querySelector("label").setAttribute("for",a);n.querySelector(`.${this.prefix}_payments__option_name`).textContent=t.name;const r=n.querySelector(`.${this.prefix}_payments__option_icon`);return r.alt=`${this.txt["Metoda płatności"]}: ${t.name}`,r.src=t.icon_svg||t.icon,n}createPaymentsOptionList(e){return e.options.map(((t,s)=>this.createPaymentOption(e,t,s)))}addPaymentOptions(e,t){const s=t.querySelector(`.${this.prefix}_payments__details`);if(!s)return;if(!e.options?.length||1===e.options.length||!1===e.group)return void s.parentNode.removeChild(s);const n=document.getElementById(`${this.prefix}_payments_details`)?.content.cloneNode(!0);if(!n)return void s.parentNode.removeChild(s);t.firstChild.classList.add("--options");const i=n.querySelector(`.${this.prefix}_payments__clause`);if(e.clause.length&&i){const t=this.prepareClauses(e.clause);i.innerHTML=t}const a=n.querySelector(`.${this.prefix}_payments__options`),r=this.createPaymentsOptionList(e);r&&r.length>0&&a&&r.forEach((e=>{a.appendChild(e)}));const o=n.querySelector(`.${this.prefix}_payments__show_all`);o&&e.options.length<5&&o.parentNode.removeChild(o),s.appendChild(n)}prepareElementToDisplay(e){const t=document.getElementById(`${this.prefix}_payments_item`)?.content.cloneNode(!0);if(!t)return!1;const s=t.querySelector(`.${this.prefix}_payments__icons`),n=t.querySelector(`.${this.prefix}_payments__icon`);e.icons.forEach((e=>{const t=n.cloneNode();t.alt=`${this.txt["Metoda płatności"]}: ${e.alt}`,t.src=e.src,s.appendChild(t)})),n.parentNode.removeChild(n);t.querySelector(`.${this.prefix}_payments__name`).textContent=e.name;const i=t.querySelector(`.${this.prefix}_payments__description`);e.description?i.textContent=e.description:i.parentNode.removeChild(i);const a=t.querySelector('input[name="first_payment_id"]');e.cost&&e.group?a.value=e.cost:a.parentNode.removeChild(a);const r=t.querySelector('input[name="payform_id"]');e.group?r.parentNode.removeChild(r):r.value=e.id;const o=t.querySelector('input[name="selected_group_only"]');o.id=`payform_${e.id}`,o.value=e.id,o.setAttribute("data-group",e.group),e.checked&&(o.checked=!0),e.checked&&"cash"===e.id&&this.paymentsElement.querySelector(`.${this.prefix}_payments`)?.classList?.add("--dvp");t.querySelector("label").setAttribute("for",`payform_${e.id}`);const l=this.paymentsElement.querySelector(`.${this.prefix}_payments__clause_top`);if(l&&!e.group&&e.clause.length){const t=this.prepareClauses(e.clause);l.innerHTML=t,this.paymentsElement?.classList.add("--clause-top")}return this.addPaymentOptions(e,t),t}checkNumberOfPayments(){if(this.paymentsElement.querySelectorAll(`.${this.prefix}_payments__option_input`).length>1)return void this.paymentsElement.classList.remove("--one");this.paymentsElement.querySelectorAll('input[name="selected_group_only"]').length>1?this.paymentsElement.classList.remove("--one"):this.paymentsElement.classList.add("--one")}checkSelectedPayment(){const e=this.paymentsElement.querySelector(`.${this.prefix}_payments__option_input:checked`);if(e)return void this.onChangeSelectPayment(e,{notScroll:!0});const t=this.paymentsElement.querySelector('input[name="selected_group_only"]:checked');if(t)return void this.onChangeSelectPayment(t,{notScroll:!0});const s=this.paymentsElement.getAttribute("data-id")||this.vars.defaultPaymentMethodId,n=this.paymentsElement.querySelector(`input.${this.prefix}_payments__option_input[value="${s}"]`);if(n){n.checked=!0;const e=n.closest(`.${this.prefix}_payments__item`).querySelector('input[name="selected_group_only"]');return e&&(e.checked=!0),void this.onChangeSelectPayment(n,{notScroll:!0})}const i=this.paymentsElement.querySelector(`input[name="selected_group_only"][value="${s}"]`);if(i)return i.checked=!0,void this.onChangeSelectPayment(i,{notScroll:!0});const a=this.paymentsElement.querySelectorAll(`input.${this.prefix}_payments__option_input`);if(1===a.length){a[0].checked=!0;const e=a[0].closest(`.${this.prefix}_payments__item`).querySelector('input[name="selected_group_only"]');return e&&(e.checked=!0),void this.onChangeSelectPayment(a[0],{notScroll:!0})}const r=this.paymentsElement.querySelectorAll('input[name="selected_group_only"]');if(0!==r.length){if(1!==r.length)return r[0].checked=!0,void this.onChangeSelectPayment(r[0],{notScroll:!0});r[0].checked=!0,this.onChangeSelectPayment(r[0],{notScroll:!0})}}noPaymentMethods(){const e=this.paymentsElement.querySelector(`.${this.prefix}_payments__wrapper`);e&&(e.innerHTML="",e.appendChild(this.createInfo(this.txt["Brak metod płatności"])))}showPayments(){if(!this.vars.formattedUniquePayments.length)return void this.noPaymentMethods();const e=this.paymentsElement.querySelector(`.${this.prefix}_payments__wrapper`);e&&(e.innerHTML="",this.vars.formattedUniquePayments.forEach((t=>{const s=this.prepareElementToDisplay(t);s&&e.appendChild(s)})),this.checkSelectedPayment(),this.checkNumberOfPayments(),this.disableInputs())}addDvpPayment(e,t=!1){const s={id:"cash",group:!0,icons:[{src:this.icons.dvp,alt:this.names.dvp}],name:this.names.dvp,cost:!1,description:!1,checked:e};t&&(this.vars.formattedUniquePayments=[]),this.vars.formattedUniquePayments.push(s),this.showPayments()}updateUniquePayments(){this.vars.payments.forEach((e=>{-1!==this.vars.uniquePayments.findIndex((t=>t.paymentChannel.id===e.paymentChannel.id&&!0!==t.methodAsGroup))&&!0!==e.methodAsGroup||this.vars.uniquePayments.push(e)}))}getUniquePaymentById(e){return this.vars.formattedUniquePayments.find((({id:t})=>t?.toString()===e?.toString()))}getPaymentById(e){return this.vars.payments.find((({id:t})=>t?.toString()===e?.toString()))}checkDvpChanged(e){const t=e.querySelector(`.${this.prefix}_payments__input`)||e.querySelector(`.${this.prefix}_payments__option_input`);if(!t)return;const s="cash"===t.value;s?this.paymentsElement.classList.add("--dvp"):this.paymentsElement.classList.remove("--dvp"),this.callbacks.dvp?.(s?"dvp":"prepaid")}restoreDefaultNameAndImage(e){const t=e.querySelector(`.${this.prefix}_payments__name`),s=e.querySelector(`.${this.prefix}_payments__icon`),n=t.getAttribute("data-default"),i=s.getAttribute("data-default");n&&(t.textContent=n),i&&(s.src=i)}changeNameAndImage(e){const t=e.querySelector(`.${this.prefix}_payments__option_name`),s=e.querySelector(`.${this.prefix}_payments__option_icon`),n=e.closest(`.${this.prefix}_payments__item`),i=n.querySelector(`.${this.prefix}_payments__name`),a=n.querySelector(`.${this.prefix}_payments__icon`);i.setAttribute("data-default",i.textContent),a.setAttribute("data-default",a.src),i.textContent=t.textContent,a.src=s.src}removeWcagAttributes(e){const t=e.querySelector(`.${this.prefix}_payments__select_payment`);e.removeAttribute("aria-hidden"),t?.removeAttribute("tabindex"),t?.removeAttribute("aria-hidden")}setWcagAttributes(e,t){const s=e.querySelector(`.${this.prefix}_payments__select_payment`);e.setAttribute("aria-hidden","true"),s?.setAttribute("tabindex","-1"),t&&s?.setAttribute("aria-hidden","true")}setChangePaymentWcag(e){const t=e.querySelector(`.${this.prefix}_payments__change_payment`);t?.setAttribute("aria-hidden","true"),t?.setAttribute("tabindex","-1")}removeChangePaymentWcag(e){const t=e.querySelector(`.${this.prefix}_payments__change_payment`);t?.removeAttribute("aria-hidden"),t?.removeAttribute("tabindex"),e?.removeAttribute("aria-hidden")}paymentSelected(e,{notScroll:t=!1}={}){this.paymentsElement.classList.add("--selected");this.paymentsElement.querySelectorAll(`.${this.prefix}_payments__item`).forEach((e=>{const s=e.querySelector(`.${this.prefix}_payments__input:checked`)||e.querySelector(`.${this.prefix}_payments__option_input:checked`);if(e.classList.contains("--options")&&e.querySelectorAll(`.${this.prefix}_payments__option`).forEach((e=>{this.setWcagAttributes(e)})),e.querySelector(`.${this.prefix}_payments__show_all`)?.setAttribute("tabindex","-1"),s)return e.classList.add("--checked"),this.setWcagAttributes(e,!0),this.removeChangePaymentWcag(e),void(!t&&e.querySelector(`.${this.prefix}_payments__item .${this.prefix}_payments__change_payment`).focus());this.setWcagAttributes(e),e.classList.remove("--checked")}));const s=e.querySelector(`.${this.prefix}_payments__input`)||e.querySelector(`.${this.prefix}_payments__option_input`);if(!s)return;const n=s.value;this.paymentsElement.setAttribute("data-id",n),this.vars.defaultPaymentMethodId=n,e.classList.contains(`${this.prefix}_payments__option`)&&this.changeNameAndImage(e),this.checkDvpChanged(e),t||this.scrollToElement({element:this.paymentsElement}),this.clause(e),this.callbacks.changePayment?.(s.value)}getPaymentClause(e){const t=e.paymentChannel?.id,s=e.paymentSystem?.id,n=[];let i=[this.findAssociatedPaymentSystemName(s)];e.terms?.supportsPaymentInitiationService&&n.push({clause:e.terms.paymentInitiationServiceTerms.clause}),i=i.filter((e=>e));const a=this.findGroupTerms({groupId:t,paymentNames:i});return n.push(...a),n}clause(e){this.callbacks.clause?.([]);const t=e.querySelector(`.${this.prefix}_payments__input`)||e.querySelector(`.${this.prefix}_payments__option_input`);if(!t)return;const s=t.value,n=this.getPaymentById(s)||this.getUniquePaymentById(s);if(!n)return;const i=this.getPaymentClause(n);this.callbacks.clause?.(i)}removeChecked(e){const t=e.querySelector('input[name="selected_group_only"]');t&&(t.checked=!1);const s=e.querySelector('input[name="payform_id"]:checked');s&&(s.checked=!1),e.classList.remove("--checked");this.paymentsElement.querySelectorAll(`.${this.prefix}_payments__item`).forEach((e=>{e.querySelector(`.${this.prefix}_payments__details`)?.setAttribute("aria-hidden","true"),this.removeWcagAttributes(e),this.setChangePaymentWcag(e)})),this.disableInputs()}onClickChangePayment(){this.paymentsElement.classList.remove("--selected");const e=this.paymentsElement.querySelector(`.${this.prefix}_payments__item.--checked`);e&&(this.paymentsElement.querySelector(`.${this.prefix}_payments__item .${this.prefix}_payments__select_payment`).focus(),this.removeChecked(e),this.restoreDefaultNameAndImage(e))}onClickShowAllOptions(e){const t=e.closest(`.${this.prefix}_payments__details`);if(!t)return;t.classList.toggle("--show-all");const s=e.closest(`.${this.prefix}_payments__item`);if(t.classList.contains("--show-all")){const t=s.querySelectorAll(`.${this.prefix}_payments__option`);return t.forEach(((e,t)=>{this.removeWcagAttributes(e)})),e.textContent=this.txt["Pokaż mniej"],void super.scrollToElement({element:t?.[t.length-1],forceScroll:!0})}super.scrollToElement({element:s}),s.querySelectorAll(`.${this.prefix}_payments__option`).forEach(((e,t)=>{t>4&&this.setWcagAttributes(e)})),e.textContent=this.txt["Pokaż wszystkie"]}onClickSelectPaymentWithOptions(e){const t=e.closest(`.${this.prefix}_payments__item.--options`);if(!t)return;t.querySelector(`.${this.prefix}_payments__input:checked`)&&this.paymentSelected(t)}onChangeSelectPayment(e,t){this.disableInputs();const s="selected_group_only"===e.name?e.closest(`.${this.prefix}_payments__item`):e.closest(`.${this.prefix}_payments__option`);if(s){if(s.classList.contains("--options"))return s.querySelector(`.${this.prefix}_payments__details`)?.removeAttribute("aria-hidden"),s.querySelector(`.${this.prefix}_payments__show_all`)?.removeAttribute("tabindex"),void s.querySelectorAll(`.${this.prefix}_payments__option`).forEach(((e,t)=>{t<this.vars.paymentsMethodsCount&&this.removeWcagAttributes(e)}));if(s.closest(`.${this.prefix}_payments__item.--options`)){const t=s.closest(`.${this.prefix}_payments__item.--options`).querySelector('[name="selected_group_only"]');if(!t)return;t.value=e.value}this.paymentSelected(s,t)}}initVoucherGiftCard(e="voucher"){const t=document.getElementById(`${this.prefix}_${e}_template`)?.content.cloneNode(!0);t&&t.firstChild&&(this[`${e}Element`]=t.firstChild,this[`${e}Validate`]=new FormValidation({form:this[`${e}Element`]}),this[`${e}Validate`].init(),super.addFocus(this[`${e}Element`]),super.addFocusEvents(this[`${e}Element`]),this[`${e}Modal`]=new Modal({element:this[`${e}Element`],classList:`--${e} --extrasmall`,notInit:!0,setFocusOnFirstElement:!0,afterShow:()=>{document.querySelector(`.modal.--${e}`).setAttribute("aria-label",this[`${e}Element`]?.querySelector(`${this.prefix}__title`)?.innerText)}}))}async onClickVoucherCard(e){const t=this[`${e}Element`].querySelector('input[name*="_id"]');if(!t)return;const s=this[`${e}Element`].querySelector('input[name="pin_value"]');if(!await this[`${e}Validate`].validateForm())return;super.status({element:this[`${e}Element`],status:"loading"});if((await super.fetchData({data:this.queries.VOUCHER(`\n        number: "${t.value.replace(/"/g,'\\"')}",\n        ${s?`pin: "${s.value.replace(/"/g,'\\"')}",`:""}\n      `),linkParameter:`?mutation=copModulesVoucher&type=${this.type}`,alert:!1})).errors)return super.status({element:this[`${e}Element`],status:"error"}),void this[`${e}Validate`].setValidityState(s||t,this.txt["Wprowadzono błędne dane"]);super.status({element:this[`${e}Element`],status:"success",afterRemove:()=>{this[`${e}Element`].remove()}}),this[`${e}Modal`].closeModal?.();const n=t.cloneNode(!0);if(n.setAttribute("type","hidden"),document.querySelector("form.cop").appendChild(n),s){const e=s.cloneNode(!0);e.setAttribute("type","hidden"),document.querySelector("form.cop").appendChild(e)}}onKeyupVoucherCard(e){13===(e.which||e.keyCode||0)&&this.onClickVoucherCard()}initEvents(){this.paymentsElement.addEventListener("click",(e=>{const{target:t}=e;if(t.closest(`.${this.prefix}_payments__select_payment`)||t.closest(`.${this.prefix}_payments__change_payment`)){e.preventDefault();const s=t.closest(`.${this.prefix}_payments__select_payment`)||t.closest(`.${this.prefix}_payments__change_payment`),n=s?.parentNode?.querySelector(`.${this.prefix}_payments__input`)||s?.parentNode?.querySelector(`.${this.prefix}_payments__option_input`),i=s?.parentNode?.classList.contains("--checked");return i?void this.onClickChangePayment():n?(n.checked=!0,void this.onChangeSelectPayment(n)):void 0}return t.closest(`.${this.prefix}_payments__change_link`)?(e.preventDefault(),void this.onClickChangePayment()):t.closest(`.${this.prefix}_payments__show_all`)?(e.preventDefault(),void this.onClickShowAllOptions(t)):t.closest(`.${this.prefix}_payments.--selected:not(.--one) .${this.prefix}_payments__item.--checked .${this.prefix}_payments__label`)?(e.preventDefault(),void this.onClickChangePayment(t)):void(t.closest(`.${this.prefix}_payments:not(.--one) .${this.prefix}_payments__item.--options .${this.prefix}_payments__label`)&&this.onClickSelectPaymentWithOptions(t))})),this.voucherElement.addEventListener("click",(e=>{const{target:t}=e;t.closest(`.${this.prefix}_voucher__button`)&&(e.preventDefault(),this.onClickVoucherCard("voucher"))})),this.giftcardElement.addEventListener("click",(e=>{const{target:t}=e;t.closest(`.${this.prefix}_giftcard__button`)&&(e.preventDefault(),this.onClickVoucherCard("giftcard"))}));[...this.giftcardElement.querySelectorAll(`.${this.prefix}_giftcard input.f-control`),...this.voucherElement.querySelectorAll(`.${this.prefix}_voucher input.f-control`)].forEach((e=>{e.addEventListener("keyup",this.onKeyupVoucherCard.bind(this))})),this.paymentsElement.addEventListener("change",(e=>{const{target:t}=e;(t.closest(`.${this.prefix}_payments__input`)||t.closest(`.${this.prefix}_payments__option_input`))&&(e.preventDefault(),this.onChangeSelectPayment(t))}))}getDefaultPaymentMethodId(e){if(this.vars?.defaultPaymentMethodId)return this.vars.defaultPaymentMethodId;const t=super.getFormDataFromSessionStorage(),s=t.payform_id||t.first_payment_id||t.selected_group_only;return s||(e.paymentsMethod?.settings?.defaultPaymentMethodId?e.paymentsMethod?.settings?.defaultPaymentMethodId:0)}generate(){const e=document.getElementById(`${this.prefix}_payments_template`)?.content.cloneNode(!0);if(!e||!e.firstChild)return;const t=this.paymentsElement;this.paymentsElement=e.firstChild,this.updateUniquePayments(),this.prepareObjectToDisplay(),this.showPayments(),this.initVoucherGiftCard("voucher"),this.initVoucherGiftCard("giftcard"),this.initEvents(),"n"===window?.associationClient?.permsPayment&&(this.paymentsElement?.querySelector(`.${this.prefix}_payments__wrapper`)?.classList.add("--hidden"),this.paymentsElement?.querySelector(`.${this.prefix}_payments__change`)?.classList.add("--hidden"),this.paymentsElement?.querySelector(`.${this.prefix}_payments__association`)?.classList.remove("--hidden")),t&&document.body.contains(t)?t.replaceWith(this.paymentsElement):super.move({element:this.paymentsElement,...this.vars.move})}init(e={}){this.type=e.type||app_shop.vars.copModulesType||"order1",this.vars={payments:e.paymentsMethod?.payments||[],paymentsGroup:e.paymentsMethod?.paymentsGroup||[],paymentsGroupTerms:e.paymentsMethod?.paymentsGroupTerms||[],defaultPaymentMethodId:this.getDefaultPaymentMethodId(e),uniquePayments:[],formattedUniquePayments:[],paymentOptions:[],afterReady:e.afterReady||(()=>{}),move:e.move||this.vars?.move||{},paymentsMethodsCount:e?.paymentsMethodsCount||5},this.callbacks={clause:e.clauseCallback||this.callbacks?.clause,updateCost:e.updateCostCallback||this.callbacks?.updateCost,changePayment:e.changePaymentCallback||this.callbacks?.changePayment,dvp:e.dvpCallback||this.callbacks?.dvp},this.generate(),this.vars.afterReady(this.paymentsElement)}}try{app_shop.fn.copModulesPayments=new PaymentsCOP,app_shop.vars.copModulesClasses.push((()=>{app_shop.fn.copModulesPayments=new PaymentsCOP}))}catch(e){window?.errorLog?.(e)}
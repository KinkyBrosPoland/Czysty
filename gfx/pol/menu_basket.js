const TOPBASKET_GQL={BASKET:()=>JSON.stringify({query:"query {\n      basket(BasketCostInput: {}) {\n        summaryBasket {\n          productsCount\n          worth {\n            net {\n              formatted\n              value\n            }\n            gross {\n              formatted\n              value\n            }\n          }\n          shipping {\n            cost {\n              gross {\n                value\n                formatted\n              }\n            }\n          }\n          toShippingFree {\n            value\n            formatted\n          }\n          shippingLimitFree {\n            value\n            formatted\n          }\n        }\n        products {\n          id\n          quantity\n          worth {\n            net {\n              formatted\n            }\n            gross {\n              formatted\n            }\n          }\n          worthPoints {\n            formatted\n          }\n          forPoints\n          data {\n            type\n            name\n            link\n            iconSmall\n            iconSmallSecond\n            unit {\n              singular\n              plural\n              fraction\n            }\n          }\n        }\n      }\n    }"})},TOPBASKET_TXT={gratis:"Gratis","Wartość koszyka":"Wartość koszyka",PKT:"PKT"};class TopBasket{constructor(t={}){this.txt={...TOPBASKET_TXT},this.queries={...TOPBASKET_GQL},this.basketWrapper=t?.basketWrapper||document.getElementById("menu_basket"),this.basketClass=t?.basketClass||".top_basket__details",this.priceType=t?.priceType||app_shop?.vars?.priceType||"gross",this.shippingFree=t?.shippingFree||app_shop.vars.toshippingfree||"",this.callbacksAfterGetData=t?.callbacksAfterGetData||[],this.callbacksAfterSetHtml=t?.callbacksAfterSetHtml||[],this.templates={wrapper:document.getElementById("top_basket_details"),product:document.getElementById("top_basket_product"),summary:document.getElementById("top_basket_summary")}}setClass(t="add",e="--skeleton"){this.basketWrapper?.classList[t](e)}initCallbacks(t){t?.forEach((t=>{"function"==typeof t&&t(this?.basketData,this?.basketWrapper)}))}async fetchData(t={}){const{data:e,link:s,linkParameter:a=""}=t;if(!e)return!1;try{const t=await fetch(`${s||app_shop.urls.graphql||"/graphql/v1"}${a}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:e}),r=await t.json();return r}catch(t){return!1}}getPrices(t,e){const s=t?.worth?.[this.priceType]?.formatted||"",a=t?.quantity||1;let r=a>1?t?.data?.unit?.plural||"":t?.data?.unit?.singular||"";a%1!=0&&t?.data?.unit?.fraction&&(r=t?.data?.unit?.fraction);const i=e?.querySelector(".top_basket__price"),n=e?.querySelector(".top_basket__unit");i?.insertAdjacentHTML("afterbegin",s),n?.insertAdjacentHTML("afterbegin",` / ${a} ${r}`)}getBasketProducts(t){if(!t)return!1;this.basketData?.products?.forEach((e=>{const s=this.templates.product?.content.cloneNode(!0);if(!s)return!1;const{link:a="",name:r="",iconSmall:i="",iconSmallSecond:n=""}=e?.data,o=n||i,p=s?.querySelector(".top_basket__img");p?.setAttribute("title",r||""),p?.setAttribute("href",a||"");const c=s?.querySelector(".top_basket__img img");c?.setAttribute("alt",r||""),c?.setAttribute("src",o);const h=s?.querySelector(".top_basket__img source");h?.setAttribute("srcset",i||"");const u=s?.querySelector(".top_basket__link");u?.setAttribute("title",r||""),u?.setAttribute("href",a||""),u?.insertAdjacentHTML("afterbegin",r||"");const l=s?.querySelector(".top_basket__prices");this.getPrices(e,l),t?.appendChild(s)}))}setWorth(t){const e=document.querySelector(".top_basket__price"),s=document.querySelector(".top_basket .badge");return!(!e||!t)&&(e.innerHTML="",e.insertAdjacentHTML("afterbegin",t),e?.setAttribute?.("aria-label",`${this?.txt?.["Wartość koszyka"]}: ${t}`),!!s&&(s.innerHTML="",void s.insertAdjacentHTML("afterbegin",this?.productsCount)))}getLeftWorthToShippingFreePercent(t){return 100*this.worthValue/t+"%"}setShippingLimit(t){const e=t.querySelector(".top_basket__summary_shipping_free"),s=e?.querySelector(".top_basket__summary_value"),a=e?.querySelector(".progress_bar__value"),r=this.basketData?.summaryBasket?.shippingLimitFree?.value||"",i=this.basketData?.summaryBasket?.toShippingFree?.formatted||"";if(!r||0===this?.shippingCost)return e?.classList?.add("--hide"),!1;const n=this.getLeftWorthToShippingFreePercent(r);if(s?.insertAdjacentHTML("beforeend",i),r>70)return e?.querySelector(".progress_bar")?.classList?.add?.("--hide"),!1;a.style.width=n}getBasketSummary(){const t=this.templates.summary?.content.cloneNode(!0);if(!t)return document.createElement("div");const e=t?.querySelector(".top_basket__summary_item.--worth"),s=e?.querySelector(".top_basket__summary_value");this.worth=this.basketData?.summaryBasket?.worth?.[this.priceType]?.formatted,this.worthValue=this.basketData?.summaryBasket?.worth?.[this.priceType]?.value,this.worth||e?.classList.add("--hide"),s?.insertAdjacentHTML("afterbegin",this.worth||""),this.setWorth(this.worth);const a=t?.querySelector(".top_basket__summary_item.--shipping"),r=a?.querySelector(".top_basket__summary_value");this.shippingCost=this.basketData?.summaryBasket?.shipping?.cost?.gross?.value,this.shippingCostFormatted=this.basketData?.summaryBasket?.shipping?.cost?.gross?.formatted;const i=0===this.shippingCost?`${this?.txt?.gratis}!`:`+ ${this.shippingCostFormatted}`;return r?.insertAdjacentHTML("beforeend",i||""),0===this.shippingCost&&a?.classList.add("--free"),this.setShippingLimit(t),t}getBasketWraoper(){const t=this.templates.wrapper?.content.cloneNode(!0);if(!t)return document.createElement("div");const e=t?.querySelector(".top_basket__count");e&&e.insertAdjacentHTML("afterbegin",this.productsCount);const s=t.querySelector(".top_basket__products");this.getBasketProducts(s);const a=this.getBasketSummary(),r=t.querySelector(".top_basket__summary");return a&&r&&r?.appendChild(a),t}setHtml(){const t=this.getBasketWraoper(),e=this.basketWrapper?.querySelector(this.basketClass);if(!t||!e)return!1;this.basketWrapper.replaceChild(t,e)}setMaxHeight(){const t=this.basketWrapper?.querySelector(`${this.basketClass} > div`),e=document.querySelector("header")?.offsetHeight||50;if(!t)return!1;document.querySelector(".--fixed-header")?t.style.maxHeight=`calc(100vh - ${e}px)`:t.style.maxHeight=""}replaceBasketButtonClass(){const t=this.basketWrapper?.querySelector("[data-ec-class]");return!!t&&("undefined"!=typeof customElements&&void customElements.whenDefined("express-checkout").then((()=>{t.className=t.getAttribute("data-ec-class")})))}moveExpressCheckout(){const t=this.basketWrapper?.querySelector(".top_basket__express_checkout_container express-checkout");if(!t)return!1;this.basketWrapper?.querySelector("#top_basket__express_checkout_placeholder")?.replaceWith(t)}async initwithouLoading(){if(this.setClass("remove","--hide"),this.basketData=await this.fetchData({data:this.queries.BASKET(),linkParameter:"?query=basket"}),this.basketData=this.basketData?.data?.basket,this.productsCount=this.basketData?.summaryBasket?.productsCount||0,!this.basketData||!this.productsCount)return this.setClass("remove"),this.setClass("add","--hide"),!1;this.initCallbacks(this.callbacksAfterGetData),this.setHtml(),this.replaceBasketButtonClass(),this.moveExpressCheckout(),this.initCallbacks(this.callbacksAfterSetHtml)}async init(){this.setClass("add"),await this.initwithouLoading(),this.setClass("remove")}}app_shop.fn.topBasket=new TopBasket,app_shop.fn.menu_basket_cache=()=>app_shop.fn.topBasket.init();const menu_basket_cache=()=>app_shop.fn.topBasket.init();app_shop.run((()=>{app_shop.fn.topBasket=new TopBasket,app_shop?.vars?.cache_html?app_shop.fn.topBasket.init():document.querySelector("#menu_basket:not(.--hide)")?.addEventListener("mouseover",(()=>{app_shop.fn.topBasket.initwithouLoading()}),{once:!0}),document.querySelector("#menu_basket:not(.--hide)")?.addEventListener("mouseover",(()=>{app_shop.fn.topBasket.setMaxHeight()}))}),"all","#menu_basket",!0);
class SummaryClientNew extends COPModules{constructor(e={}){super(e)}addLoading(){document.querySelector(`.${this.prefix}__content`)?.classList.add("--loading")}removeLoading(){document.querySelector(`.${this.prefix}__content`)?.classList.remove("--loading")}addHighlightError(){document.querySelectorAll(".f-feedback.--error .f-control").forEach((e=>{e.classList.add("--highlight"),setTimeout((()=>{e.classList.remove("--highlight")}),2e3)}))}vatTerms(e=!1){const t=this.summaryElement.querySelector(`.${this.prefix}_terms__item.--vat`);if(!t)return;const i=t.querySelector('input[type="checkbox"]');i&&(t.classList.toggle("--hidden",e),i.disabled=e)}useVat(){const e=document.querySelector(`.${this.prefix}`)||this.summaryElement.closest("form");if(!e)return;const t=new FormData(e);if("firm"!==t.get("client_type"))return void this.vatTerms(!0);const i=t.get("delivery_region")||t.get("client_region"),r=e.querySelector(`[value="${i}"]`);if(!r)return;const{vatCompany:a}=r.dataset;this.vatTerms("y"===a)}afterChangeRegion(){this.useVat()}afterChangeClientType(){this.useVat()}formValidationFailed(){const e=document.querySelector(".f-feedback.--error .f-control.--validate:not(:disabled)")||document.querySelector(".f-group.--error .f-control.--validate:not(:disabled)");super.scrollToElement({element:e.closest(".--error"),callback:this.addHighlightError.bind(this)}),e?.focus()}async validateAllData(){this.addLoading();return!!await this.validate.validateForm()||(this.removeLoading(),this.formValidationFailed(),!1)}joinStreetNumber(){document.querySelectorAll('[name="client_street"], [name="delivery_street"], [name="invoice_street"]').forEach((e=>{if(e.disabled)return;const{concatFrom:t}=e.dataset;if(!t)return;const i=document.querySelector(t);i?.value&&(e.value=`${e.value.trim()} ${i.value.trim()}`)}))}joinInputs(e=[],t=!1){e.forEach((e=>{if(e.disabled)return;const{concatFrom:i}=e.dataset;if(!i)return;const r=document.querySelector(i);r?.value&&(e.value=t?`${r.value.trim()} ${e.value.trim()}`:`${e.value.trim()} ${r.value.trim()}`)}))}checkDeliveryAddressId(){const e=document.querySelector(`.${this.prefix}`)||this.summaryElement.closest("form");if(!e)return;const t=new FormData(e);if(!t.has("deliver_to_billingaddr"))return;const i=document.querySelector(`.${this.prefix}_address_data .${this.prefix}_addresses__item[data-firstname="${t.get("delivery_firstname")}"][data-lastname="${t.get("delivery_lastname")}"][data-additional="${t.get("delivery_additional")}"][data-street="${t.get("delivery_street")}"][data-city="${t.get("delivery_city")}"][data-zipcode="${t.get("delivery_zipcode")}"][data-region_id="${t.get("delivery_region")}"][data-phone="${t.get("delivery_phone")}"]`);if(i){if("true"===e.querySelector("#deliver_to_another_address").getAttribute("data-edit")){const t=document.createElement("input");t.type="hidden",t.name="delivery_id",t.value=i.dataset.id,e.appendChild(t)}}else document.querySelector('input[name="delivery_id"]')?.remove()}checkInvoiceAddressId(){const e=document.querySelector(`.${this.prefix}`)||this.summaryElement.closest("form");if(!e)return;const t=new FormData(e);if(!t.has("invoice_to_billingaddr"))return;const i=document.querySelector(`.${this.prefix}_invoice_data .${this.prefix}_addresses__item[data-firstname="${t.get("invoice_firstname")}"][data-lastname="${t.get("invoice_lastname")}"][data-additional="${t.get("invoice_firm")}"][data-street="${t.get("invoice_street")}"][data-city="${t.get("invoice_city")}"][data-zipcode="${t.get("invoice_zipcode")}"][data-region_id="${t.get("invoice_region")}"][data-nip="${t.get("invoice_nip")}"]`);if(i){if("true"===e.querySelector("#deliver_to_another_address").getAttribute("data-edit")){const t=document.createElement("input");t.type="hidden",t.name="invoice_id",t.value=i.dataset.id,e.appendChild(t)}}else document.querySelector('input[name="invoice_id"]')?.remove()}submitForm(){const e=document.querySelector(`.${this.prefix}`)||this.summaryElement.closest("form");e&&e.submit()}async onClickSubmitButton(){await this.validateAllData()&&(this.joinInputs(document.querySelectorAll('[name="client_street"], [name="delivery_street"], [name="invoice_street"]')),this.joinInputs(document.querySelectorAll('[name="client_phone"], [name="delivery_phone"]'),!0),this.checkDeliveryAddressId(),this.checkInvoiceAddressId(),"true"===document.querySelector("form.cop.--client-new").getAttribute("data-userOnceData")&&sessionStorage.setItem("userOnceData","true"),this.submitForm())}initEvents(){this.summaryElement.addEventListener("click",(e=>{const{target:t}=e;t.closest(`.${this.prefix}_buttons__button.--submit`)&&(e.preventDefault(),this.onClickSubmitButton())}))}generate(){const e=document.getElementById(`${this.prefix}_summary_client_template`)?.content.cloneNode(!0);if(!e||!e.firstChild)return;const t=this.summaryElement;if(this.summaryElement=e.firstChild,this.useVat(),this.initEvents(),t&&document.body.contains(t))return t.replaceWith(this.summaryElement),void this.validate.reInit();super.move({element:this.summaryElement,...this.vars.move}),this.validate.reInit()}init(e={}){this.type=e.type||app_shop.vars.copModulesType||"order1",this.vars={afterReady:e.afterReady||(()=>{}),move:e.move||this.vars?.move||{}},this.generate(),this.vars.afterReady(this.summaryElement)}}app_shop.fn.copModulesSummaryClient=new SummaryClientNew;
class SubscrInfo extends Subscr{constructor(e={}){super(e)}getLastOrderIsShippedInfo(){const[e]=this.vars.orders;if(super.checkLastOrderIsShipped(e)||this.vars.view.status!==this.statuses.active)return!1;const t=document.getElementById(`${this.prefix}_info_item_template`)?.content.cloneNode(!0);if(!t||!t.firstChild)return!1;const{link:s}=e||{},{upcomingDeliveryDate:i,nextDeliveryDate:n}=this.vars.view;t.firstChild.classList.add("menu_messages_message");const r=super.getFormattedDate(i,{onlyDate:!0}),a=super.getFormattedDate(n,{onlyDate:!0});return t.firstChild.innerHTML=`<p>${this.txt["Najbliższe zamówienie, które otrzymasz %s zostało już utworzone i nie może być edytowane"].format(r)}. <a class="subscr_info__message_link" href="${s}" target="_blank">${this.txt["Sprawdź status zamówienia"]}</a>. ${this.txt["Zmiany, które wprowadzisz będą obowiązywały od kolejnej dostawy zaplanowanej na %s"].format(a)}.</p>`,t.firstChild}getAcceptInfo(){const{subscriptionAcceptData:{acceptanceIsRequired:e,acceptationDeadline:t}={}}=this.vars.view;if(!e||this.vars.view.status===this.statuses.finished)return!1;const s=document.getElementById(`${this.prefix}_info_item_template`)?.content.cloneNode(!0);if(!s||!s.firstChild)return!1;const{upcomingDeliveryDate:i}=this.vars.view,n=super.getFormattedDate(i,{onlyDate:!0});return s.firstChild.classList.add("menu_messages_warning"),s.firstChild.innerHTML=`<p>${this.txt["Cena twojej subskrypcji uległa zmianie. Aby otrzymać dostawę zaplanowaną na %s, %s"].format(n,`<a class="subscr_info__warning_link" href="#scrollToAcceptInfo">${this.txt["zaakceptuj nową cenę subskrypcji"]}</a>`)}${t?` ${this.txt["do %s. Po upływie tego terminu subskrypcja zostanie wstrzymana"].format(t)}`:""}.</p>`,s.firstChild}initMessages(){const e=this.getAcceptInfo();if(e)return this.infoElement.append(e),!0;const t=this.getLastOrderIsShippedInfo();return!!t&&(this.infoElement.append(t),!0)}onClickScrollToSummary(){super.scrollToElement({element:document.querySelector(`.${this.prefix}_products__summary`)}),document.querySelector(`.${this.prefix}_accept__button`)?.classList.add("--highlight"),setTimeout((()=>{document.querySelector(`.${this.prefix}_accept__button`)?.classList.remove("--highlight")}),2e3)}initEvents(){this.infoElement.addEventListener("click",(e=>{const{target:t}=e;t.closest(`.${this.prefix}_info__warning_link`)&&(e.preventDefault(),this.onClickScrollToSummary())}))}async generate(){const e=document.getElementById(`${this.prefix}_info_template`)?.content.cloneNode(!0);if(!e||!e.firstChild)return;const t=this.infoElement;this.infoElement=e.firstChild;if(!this.initMessages())return t?.remove(),void document.querySelector(this.vars.move.moveSelector)?.remove();this.initEvents(),t&&document.body.contains(t)?t.replaceWith(this.infoElement):super.move({element:this.infoElement,...this.vars.move})}async init(e={}){this.vars={afterReady:e.afterReady||(()=>{}),move:e.move||this.vars?.move||{},view:e.view||this.vars?.view||{},orders:e.orders||this.vars?.orders||[]},await this.generate(),this.vars.afterReady(this.infoElement)}}app_shop.fn.subscrInfo=new SubscrInfo;
const EXPRESS_RETRY_GQL={PAYMENTS:e=>JSON.stringify({query:"query {\n      paymentsMethod {\n        payments {\n          id\n          name\n          icon\n          methodAsGroup\n          paymentChannel {\n            id\n            name\n            icon\n          }\n          paymentSystem {\n            id\n            name\n          }\n          additionalClientCost {\n            costPercent\n            costFixedAmount {\n              value\n            }\n            minAmount {\n              value\n            }\n          }\n          terms {\n            supportsPaymentInitiationService\n            paymentInitiationServiceTerms {\n              id\n              type\n              clause\n            }\n          }\n        }\n        paymentsGroup {\n          id\n          name\n          icon\n        }\n        paymentsGroupTerms {\n          groupId\n          type\n          clausePrefix\n          clause\n        }\n        settings {\n          defaultPaymentMethodId\n        }\n      }\n    }"}),COLLECTIVE_PAYMENTS:e=>JSON.stringify({query:`query {\n      collectivePayments(ordersNumbers: [${e}]) {\n        payments {\n          id\n          name\n          icon\n          methodAsGroup\n          paymentChannel {\n            id\n            name\n            icon\n          }\n          paymentSystem {\n            id\n            name\n          }\n          additionalClientCost {\n            costPercent\n            costFixedAmount {\n              value\n            }\n            minAmount {\n              value\n            }\n          }\n          terms {\n            supportsPaymentInitiationService\n            paymentInitiationServiceTerms {\n              id\n              type\n              clause\n            }\n          }\n        }\n        paymentsGroup {\n          id\n          name\n          icon\n        }\n        paymentsGroupTerms {\n          groupId\n          type\n          clausePrefix\n          clause\n        }\n        settings {\n          defaultPaymentMethodId\n        }\n      }\n    }`}),SETTINGS:()=>JSON.stringify({query:"query {\n      shop {\n        settings {\n          order {\n            personalDataProcessing {\n              dataProcessingText\n            }\n          }\n        }\n      }\n    }"}),PREPARE_COLLECTIVE_PAYMENT:(e,t)=>JSON.stringify({query:`query {\n      preparePayment(PreparePaymentInput: {\n        orderNumbers: ${e},\n        paymentFormId: ${t}\n      }) {\n        paymentId\n        description\n        type\n        javascript\n        fromData {\n          action\n          method\n          target\n          acceptCharset\n          inputs {\n            name\n            type\n            value\n            className\n            url\n          }\n        }\n        paymentXML\n      }\n    }`}),PREPARE_PAYMENT:(e,t)=>JSON.stringify({query:`query {\n      preparePayment(PreparePaymentInput: {\n        orderNumber: ${e},\n        paymentId: ${t}\n      }) {\n        paymentId\n        description\n        type\n        javascript\n        fromData {\n          action\n          method\n          target\n          acceptCharset\n          inputs {\n            name\n            type\n            value\n            className\n            url\n          }\n        }\n        paymentXML\n      }\n    }`})},EXPRESS_RETRY_TXT={"Podany login lub hasło nie jest poprawne":"Podany login lub hasło nie jest poprawne","Wystąpił błąd połączenia. Sprawdź łącze internetowe lub spróbuj ponownie później":"Wystąpił błąd połączenia. Sprawdź łącze internetowe lub spróbuj ponownie później","Przelew zwykły":"Przelew zwykły","Przelew online":"Przelew online","Karta płatnicza":"Karta płatnicza","Płatność ratalna":"Płatność ratalna","Bony, karty podarunkowe":"Bony, karty podarunkowe","Faktura na termin":"Faktura na termin",Pobranie:"Pobranie","Płatność przelewem po dostawie":"Płatność przelewem po dostawie","Brak metod płatności":"Brak metod płatności","Pokaż wszystkie":"Pokaż wszystkie","Pokaż mniej":"Pokaż mniej","Zaksięgowane w kilka minut":"Zaksięgowane w kilka minut","Zaksięgowanie do 3 dni roboczych":"Zaksięgowanie do 3 dni roboczych","Zapłać":"Zapłać",lub:"lub","Wybierz inną formę płatności":"Wybierz inną formę płatności","Przejdź do szczegółów złożonego zamówienia":"Przejdź do szczegółów złożonego zamówienia","Powrót do zamówienia":"Powrót do zamówienia","Pokaż wszystkie":"Pokaż wszystkie","Pokaż mniej":"Pokaż mniej","Najczęściej wybierane:":"Najczęściej wybierane","Wybierz formę płatności":"Wybierz formę płatności","Do zapłaty":"Do zapłaty"};var paymentForceTxt1="Przekierowanie do płatności",paymentForceTxt2="Jeśli przekierowanie nie nastąpiło automatycznie, kliknij:";const AnimateRetryElement=({element:e,afterFinish:t,options:n={duration:350,iterations:1,easing:"ease-in-out"}})=>{if(void 0===e)return;let a=null;return r=>{null!==a&&(a?.cancel?.(),a=null),a=e?.animate(r,n);const s=new Promise((e=>{a?.addEventListener("finish",(()=>{t?.(),e()}),{once:!0})}));return a.play(),{animationFinishPromise:s}}};class AnimateMobileRetryModal{constructor(){this.animationInstance=null,this.modal=null,this.modalElement=null,this.modalWrapper=null,this.modalHandler=null,this.offset=0,this.handlerTop=null,this.handlerHeight=null,this.isHandlerInitialized=!1,this.useAnimationAPI=!1,this.steps=null,this.animationClassList="--animate-modal-return"}setModalPosition(e){this.modalWrapper.setAttribute("style",`--top-distance: ${e}px;`)}resetPos(){this.modalWrapper.removeAttribute("style"),!this.useAnimationAPI&&this.animationClassList&&this.modalWrapper.classList.remove(this.animationClassList)}initHandlerProps(){const e=this.modalHandler?.getBoundingClientRect();this.handlerTop=e?.top,this.handlerHeight=e?.height}setHandlerInitialize(e){this.isHandlerInitialized=!!e}onTouchMove=e=>{if(!e?.targetTouches?.[0])return;if(app_shop.vars.view>2)return;this.isHandlerInitialized||(this.initHandlerProps(),this.setHandlerInitialize(!0)),e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault();const{clientY:t}=e.targetTouches[0];if(0!=t&&!t)return;const n=t-this.handlerTop-this.handlerHeight;if(t+this.handlerHeight<=0)return;t<window.innerHeight-this.handlerHeight-this.offset&&n>=0&&this.setModalPosition(n)};onTouchEnd=e=>{if(!(app_shop.vars.view>2))if(this.setHandlerInitialize(!1),this.useAnimationAPI){const t=e?.targetTouches?.[0]?.clientY,n=[{transform:`translate(0, ${t}px)`},{transform:"translate(0, 0)"}],{animationFinishPromise:a}=this.animationInstance(this.steps||n);a.then((()=>{this.resetPos()}))}else this.modalWrapper.classList.add(this.animationClassList)};initCssAnimationEvents(){this.modalWrapper?.addEventListener("animationend",(()=>{this.resetPos()}))}init(e={}){const{modal:t,wrapper:n,handler:a,steps:r,modalInstance:s,useAnimationAPI:i,animationClassList:o}=e;this.steps=r||this.steps,this.useAnimationAPI=i||this.useAnimationAPI,this.animationClassList=o||this.animationClassList,this.modal=s||this.modal,this.modalElement=t||document.querySelector("#modal.--expchck_retry")||this.modalElement,this.modalWrapper=n||this.modalElement?.querySelector(".modal__wrapper")||this.modalWrapper,this.modalHandler=a||this.modalWrapper?.querySelector(".modal__handler")||this.modalHandler,this.initHandlerProps(),this.useAnimationAPI?this.animationInstance=AnimateRetryElement({element:this.modalWrapper}):this.initCssAnimationEvents(),this.modalHandler?.addEventListener("touchmove",this.onTouchMove),this.modalHandler?.addEventListener("touchend",this.onTouchEnd)}destroy(){this.modalHandler?.removeEventListener("touchmove",this.onTouchMove),this.modalHandler?.removeEventListener("touchend",this.onTouchEnd)}}class ExpressCheckoutPrepaid{constructor({prefix:e="expchck",logged:t=app_shop.vars.logged||!1}={}){this.prefix=e,this.logged=t,this.minDelayTime=400,this.modal=new Modal({notInit:!0}),this.txt={...EXPRESS_RETRY_TXT},this.queries={...EXPRESS_RETRY_GQL}}debounce(e,t=500){let n;return(...a)=>{clearTimeout(n),n=setTimeout((()=>e(...a)),t)}}getDelayTime(e){const t=Date.now()-e;let n=0;return t<this.minDelayTime&&(n=this.minDelayTime-t),n}delay(e){return new Promise((t=>setTimeout(t,this.getDelayTime(e))))}findGroupTerms({groupId:e,paymentNames:t,paymentsGroupTerms:n}){return n.filter((t=>t.groupId===e)).filter((e=>!t||t===[]||t.includes(e.type)))}addLoading(){const e=document.querySelector(".modal");e?.classList.add("--loading")}removeLoading(){const e=document.querySelector(".modal");e?.classList.remove("--loading")}createInfo(e){const t=document.createElement("div");t.classList.add("menu_messages_message");const n=document.createElement("p");return n.textContent=e,t.appendChild(n),t}renameKeysObject(e,t){const n=Object.keys(e).map((n=>{const a=t[n]||n;return{[a]:e[n]}}));return Object.assign({},...n)}getValue(e,t,n=""){return e.querySelector(t)?.value||n}elementInViewport(e){if(!e)return!1;const t=e.getBoundingClientRect(),{top:n,left:a,right:r,bottom:s}=t,{innerWidth:i,innerHeight:o}=window,{clientWidth:l,clientHeight:c}=document.documentElement;return n>=0&&a>=0&&r<=(i||l)&&s<=(o||c)}async fetchData(e={}){const{data:t,link:n,linkParameter:a="",alert:r=!0,cacheName:s=!1}=e;if(s&&sessionStorage.getItem(s))return JSON.parse(sessionStorage.getItem(s));if(!t)return!1;try{const e=await fetch(`${n||app_shop.urls.graphql||"/graphql/v1"}${a}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:t}),i=await e.json();if((i?.errors||i?.error)&&r){const e=i?.errors?.[0]?.message||this.txt["Wystąpił błąd połączenia. Sprawdź łącze internetowe lub spróbuj ponownie później"];app_shop.fn?.expressCheckoutModalInstance?.closeModal?.(),Alertek.Error(e)}return s&&sessionStorage.setItem(s,JSON.stringify(i)),i}catch(e){return r&&Alertek.Error(this.txt["Wystąpił błąd połączenia. Sprawdź łącze internetowe lub spróbuj ponownie później"]),!1}}getHeaderElement(e="",t=null){const n=document.getElementById(`${this.prefix}_header`)?.content.cloneNode(!0);if(!n)return document.createElement("div");const a=n.querySelector(`.${this.prefix}_header__previous`),r=n.querySelector(`.${this.prefix}_header__name`);return a&&r?(t||a.parentNode.removeChild(a),t&&a.setAttribute("data-prev",t),r.textContent=e,n):document.createElement("div")}initModalEvents(){document.documentElement.hasAttribute("data-expchck-modal-events")||(document.documentElement.addEventListener("click",(e=>{const{target:t}=e;return!t.closest(`.${this.prefix}_header__previous`)||(e.preventDefault(),this.goPrevious(t),!1)})),this.modalEventsInited=!0,document.documentElement.setAttribute("data-expchck-modal-events","inited"))}goPrevious(e){const t=e.getAttribute("data-prev");this.goStep(t)}goStep(e,t){document.querySelector(".modal")?.classList.add("--loading"),app_shop.fn.expChckViews[e]?.init(t),this.initModalEvents()}setData(e,t){sessionStorage.setItem(e,JSON.stringify(t))}async getData(e,t){if("payments"===e){const e=t.map((e=>e.id));return(await this.fetchData({data:this.queries.COLLECTIVE_PAYMENTS(`${e.join(",")}`),linkParameter:"?query=payments"})).data}return!1}}class ExpressCheckoutRetryModal extends ExpressCheckoutPrepaid{constructor(e={}){super(e),this.icons={simple_transfer:"/gfx/standards/payment_group_simple_transfer.svg",card:"/gfx/standards/payment_group_card.svg",transfer:"/gfx/standards/payment_group_transfer.svg",installment:"/gfx/standards/payment_group_installment.svg",others:"/gfx/standards/payment_group_others.svg",tradeCredit:"/gfx/standards/payment_group_trade_credit.svg",dvp:"/gfx/standards/payment_group_dvp.svg"},this.names={simple_transfer:this.txt["Przelew zwykły"],card:this.txt["Karta płatnicza"],transfer:this.txt["Przelew online"],installment:this.txt["Płatność ratalna"],others:this.txt["Bony, karty podarunkowe"],tradeCredit:this.txt["Faktura na termin"],dvp:this.txt.Pobranie},this.descriptions={simple_transfer:this.txt["Zaksięgowanie do 3 dni roboczych"],card:this.txt["Zaksięgowane w kilka minut"],transfer:this.txt["Zaksięgowane w kilka minut"],installment:"",others:this.txt["Zaksięgowane w kilka minut"],tradeCredit:this.txt["Płatność przelewem po dostawie"],blik:this.txt["Zaksięgowane w kilka minut"],paypal:""},this.paymentSystemIds={29:"idopay"},this.paymentMappers={177:"blik",blik:"177"},this.manualPayments=["110","153","simple_transfer"],this.modalSelector="#modal.--expchck_retry",this.ModalAnimationClass=null,this.paymentStepsMapper=["card","others","installment","transfer"];const{ModalAnimationClass:t,LoaderCallback:n}=e;this.ModalAnimationClass=t||this.ModalAnimationClass,this.LoaderCallback=n||this.LoaderCallback,"function"==typeof this.ModalAnimationClass&&(this.ModalAnimationClass=new this.ModalAnimationClass),this.prepareAppShopVars()}findAssociatedPaymentSystemName(e){const t=e?.toString();return this.paymentSystemIds?.[t]}getPaymentById(e){return this.vars.payments.find((({id:t})=>t?.toString()===e?.toString()))}getIdoPayLogo(e){const t=e?.toString(),n=this.paymentMappers?.[t];return this.vars.prepaidPaymentGroupsConfigs?.find((({id:e})=>e?.toString()===n||e?.toString()===t))}stepIncludes(e){return this.paymentStepsMapper.filter((t=>t==e)).length>0}createClauseFragment(e,t){const n=document.querySelector("#prepaid_clause_item_template")?.content.cloneNode(!0);return n?(n.firstChild.setAttribute("class",`${this.prefix}_clauses__item`),n.firstChild.innerHTML=e,t&&n.firstChild.setAttribute("data-type",t),n.querySelectorAll("a").forEach((e=>e?.setAttribute?.("target","_blank"))),n.firstChild):null}parseClause(e){let t="";const n=e?.clause_prefix,a=e?.clause;return n&&""!=n&&(t+=`${n}: `),a&&(""!=a?t+=a:""==a&&(t="")),t}getDefaultClause(e){return this.findGroupTerms({groupID:e,paymentNames:["pis"],paymentsGroupTerms:this.vars.paymentsGroupTerms}).map((e=>this.parseClause(e))).join("")}getPaymentClause(e){const t=e.paymentChannel?.id,n=e.paymentSystem?.id,a=[];let r=[this.findAssociatedPaymentSystemName(n)];e.terms?.supportsPaymentInitiationService&&a.push({clause:e.terms.paymentInitiationServiceTerms.clause}),r=r.filter((e=>e));const s=this.findGroupTerms({groupId:t,paymentNames:r,paymentsGroupTerms:this.vars.paymentsGroupTerms});return a.push(...s),a}clause(){if(this.updateClause([]),"payment"!==this.vars.selectedPaymentType)return;const e=this.getPaymentById(this.vars.selectedPayment);if(!e)return;const t=this.getPaymentClause(e);this.updateClause(t)}updateClause(e){const t=document.querySelector(`.${this.prefix}_clauses`);if(t.innerHTML="",t.classList.remove("--active"),!e?.length)return;e.forEach((e=>{const{clause:n,type:a}=e;if(!n)return;const r=this.createClauseFragment(n,a);t.appendChild(r)}));t.querySelector(`.${this.prefix}_clauses__item`)&&t.classList.add("--active")}prepareAppShopVars(){app_shop.vars.express_retry_app={}}updateAppShopVars(e){app_shop.vars.express_retry_app={...app_shop.vars.express_retry_app,...e}}addPaymentOptions(e,t){const n=t.querySelector(`.${this.prefix}_payments__details`);if(!n)return;if(!e.group||!this.paymentStepsMapper.includes(e.id)||!e.options.length)return void n.parentNode.removeChild(n);const a=document.getElementById(`${this.prefix}_payments_details`)?.content.cloneNode(!0);if(!a)return void n.parentNode.removeChild(n);t.firstChild.classList.add("--options");const r=a.querySelector(`.${this.prefix}_payments__clause`);if(e.clause.length&&r){const t=this.prepareClauses(e.clause);r.innerHTML=t}const s=a.querySelector(`.${this.prefix}_payments__options`),i=this.createPaymentsOptionList(e);i&&i.length>0&&s&&i.forEach((e=>{s.appendChild(e)})),n.appendChild(a),this.toggleShowAll(n,i.length>6)}createPaymentsOptionList(e){return e.options.map(((t,n)=>this.createPaymentOption(e,t,n)))}displaySummary(e){const t=e||this.vars.selectedPayment;this.manualPayments.includes(t?.toString())&&this.closeModal(),document.querySelector("#container").classList.remove("payment_tunnel"),document.querySelector("html").classList.remove("order_process")}toggleShowAll(e,t){const n=e.querySelector(`.${this.prefix}_payments__show_all`);n&&(t?n.classList.remove("--hidden"):n.classList.add("--hidden"))}updatePaymentMethodData(){const e=this.getPaymentById(this.vars.selectedPayment);if(!e)return!1;const t=this.getIdoPayLogo(e.id?.toString()),n={id:e.id,icon:e.icon,payment_system_logo:t?.payment_system_logo};return this.updateAppShopVars({paymentMethodData:n}),!0}updateTotalToPayValue(){const e=document.querySelector(`${this.modalSelector} .${this.prefix}_total__value`)?.textContent;e&&(this.vars.totalToPayValue=e)}getTotalToPayValue(){return this.vars.totalToPayValue}getTotalToPayElement(){const e=this.getTotalToPayValue();return e?`<div class="expchck_total__to_pay">${this.txt["Do zapłaty"]} ${e}</div>`:null}validateSelectedPayment(e){return!(this.paymentStepsMapper.find((t=>t==e))||!e)||(Alertek.Info(this.txt["Wybierz formę płatności"]),!1)}async paymentAction(){const e=this.vars?.selectedPayment?.toString();if(!this.validateSelectedPayment(e))return;this.updatePaymentMethodData();if(this.isGiftPaymentMethod(e))return void this.showGiftForm(e);this.showGiftForm(!1),document.querySelector("#container").classList.add("payment_tunnel"),document.querySelector("html").classList.add("order_process");
//!!! app_shop.vars.prepaid_app.clearWarning();
const t=document.querySelector(`.${this.prefix}__wrapper`),n={id:e,leftToPay:this.vars.leftToPay},a=this.vars.orders.map((e=>e.id));this.toggleLoader(!0);const r=new Payment({orderIds:a,paymentMethodData:n,txt:PAYMENT_TXT,form:t});await r.init(),this.toggleLoader(!1),this.displaySummary(e)}onClickToggleTab(e){const t=e.closest(`.${this.prefix}_payments__item`);if(!t)return;const n=t.classList.contains("--collapse"),a=t.parentElement?.querySelectorAll(`.${this.prefix}_payments__item.--options`);a.forEach((e=>e.classList.remove("--collapse"))),t.classList.contains("--options")&&t.classList.contains("--checked")&&(n?t.classList.remove("--collapse"):t.classList.add("--collapse"))}clearGoPaymentElement(){const e=document.querySelector(`${this.modalSelector} .${this.prefix}__wrapper #go_payment`);e&&(e.innerHTML="")}createGoPaymentElement(){const e=document.querySelector(`${this.modalSelector} .${this.prefix}__wrapper`);if(!e)return;const t=`<div id="go_payment" class="go_payment_container"></div>\n    <div class="return_button">\n      <span class="return_button_sep">${this.txt.lub}</span>\n      <a class="expchck_reset_to_group" href="#go_back">${this.txt["Wybierz inną formę płatności"]}</a>\n    </div>`;e.insertAdjacentHTML("afterBegin",t),e?.querySelector(".expchck_reset_to_group")?.addEventListener("click",(e=>{e.preventDefault(),this.clearGoPaymentElement()}))}updateGoPayment(e=null){const t=document.querySelector(`${this.modalSelector} #go_payment`);t&&(t.innerHTML=e||"")}isGiftPaymentMethod(e){const t=e?.toString();return"2"===t||"190"===t}hasGiftPaymentMethods(e){return e?.some((e=>this.isGiftPaymentMethod(e.id?.toString())))}showGiftForm(e){const t=e?.toString();if(this.isGiftPaymentMethod(t)){const e="2"===t?$("#voucher_data").html():$("#giftcard_data").html();this.updateGoPayment(e)}else this.updateGoPayment(null)}prepareRetryFormToDisplay(){const e=this.vars.formattedPayments,t=this.getRetryModalElement(),n=t?.querySelector(`.${this.prefix}_payments__wrapper`);if(!t)return;return this.preparePaymentListToDisplay(e,t).forEach((e=>{n?.appendChild(e)})),t}disableInputs(){const e=document.querySelector(`.${this.prefix}_payments`),t=e?.querySelectorAll('input:not([name="selected_group_only"]');t?.forEach((e=>{const t=e.closest(`.${this.prefix}_payments__item`);if(!t.querySelector('input[name="selected_group_only"]').checked){e.disabled=!0,e.checked=!1;const n=t.querySelector(`.${this.prefix}_payments__details.--show-all`);if(!n)return;n.classList.remove("--show-all");const a=n.querySelector(`.${this.prefix}_payments__show_all`);if(!a)return;a.textContent=this.txt["Pokaż wszystkie"]}else e.disabled=!1}))}prepareClauses(e){return[...e].filter((e=>e)).map((e=>this.createClauseFragment(e)?.outerHTML)).join("")}getPaymentId(e){return e.methodAsGroup||!e.paymentChannel.id||177===e.id?e.id:e.paymentChannel.id}getPaymentName(e){if(e.methodAsGroup)return e.name;if(153===e.id)return this.names.tradeCredit;const t=e.paymentChannel.id;return this.names[t]?this.names[t]:e.name}getPaymentIcons(e){if(e.methodAsGroup)return[{src:e.icon,alt:e.name}];if(153===e.id)return[{src:this.icons.tradeCredit,alt:this.names.tradeCredit}];const t=e.paymentChannel.id;return this.icons[t]?[{src:this.icons[t],alt:this.names[t]}]:[{src:e.icon,alt:e.name}]}getPaymentDescription(e){return 153===e.id?this.descriptions.tradeCredit:e.paymentChannel?.id in this.descriptions&&this.descriptions[e.paymentChannel.id]}getPaymentCost(e){const{costPercent:t}=e.additionalClientCost,{value:n}=e.additionalClientCost.costFixedAmount,{value:a}=e.additionalClientCost.minAmount;return(0!==t||0!==n||0!==a)&&e.id}getPaymentDefaultClause(e){if(!e.terms?.supportsPaymentInitiationService)return[];return super.findGroupTerms({groupId:e.paymentChannel?.id,paymentNames:["pis"],paymentsGroupTerms:this.vars.paymentsGroupTerms}).map((e=>{const t=e?.clausePrefix,n=e?.clause;let a="";return t&&(a+=`${t}: `),n&&(a+=n),a}))}getPaymentOptions(e){return this.vars.payments.filter((t=>t.paymentChannel.id===e.paymentChannel.id&&!1===t.methodAsGroup))}prepareObjectToDisplay(){this.vars.uniquePayments.forEach((e=>{const t=this.getPaymentId(e),n=this.getPaymentOptions(e);if(this.isGiftPaymentMethod(t?.toString())||this.hasGiftPaymentMethods(n))return;const a={id:t,group:!e.methodAsGroup&&n.length>1,icons:this.getPaymentIcons(e),name:this.getPaymentName(e),description:this.getPaymentDescription(e),cost:this.getPaymentCost(e),clause:this.getPaymentDefaultClause(e),options:n};this.vars.formattedUniquePayments.push(a)}))}updateUniquePayments(){this.vars.payments.forEach((e=>{-1!==this.vars.uniquePayments.findIndex((t=>t.paymentChannel.id===e.paymentChannel.id&&!0!==t.methodAsGroup))&&!0!==e.methodAsGroup||this.vars.uniquePayments.push(e)}))}createPaymentOption(e,t,n){const a=document.getElementById(`${this.prefix}_payments_option`).content.cloneNode(!0),r=a.querySelector("input"),s=`payment_${e.id}_${n}`,i="payform_id";r.id=s,r.value=t.id,r.setAttribute("name",i),r.setAttribute("data-group-id",e.id),r.setAttribute("name",i);a.querySelector("label").setAttribute("for",s);a.querySelector(`.${this.prefix}_payments__option_name`).textContent=t.name;const o=a.querySelector(`.${this.prefix}_payments__option_icon`);return o.alt=t.name,o.src=t.icon,a}prepareElementToDisplay(e,t){const n=document.getElementById(`${this.prefix}_payments_item`)?.content.cloneNode(!0);if(!n)return!1;const a=n.querySelector(`.${this.prefix}_payments__icons`),r=n.querySelector(`.${this.prefix}_payments__icon`);e.icons.forEach((e=>{const t=r.cloneNode();t.alt=e.alt,t.src=e.src,a.appendChild(t)})),r.parentNode.removeChild(r);n.querySelector(`.${this.prefix}_payments__name`).textContent=e.name;const s=n.querySelector(`.${this.prefix}_payments__description`);e.description?s.textContent=e.description:s.parentNode.removeChild(s);const i=n.querySelector('input[name="first_payment_id"]');e.cost&&e.group?i.value=e.cost:i.parentNode.removeChild(i);const o=e.options?.[0]?.id,l=n.querySelector('input[name="payform_id"]');e.group&&177!==e.id?l.parentNode.removeChild(l):(l.value=e.id,1===e.options.length&&o&&(l.value=o));const c=n.querySelector('input[name="selected_group_only"]');c.id=`payform_${e.id}`,c.value=e.id,1===e.options.length&&o&&(c.value=o),c.setAttribute("data-group",e.group),"transfer"===e.id&&this.vars.transferChecked&&(c.checked=!0),e.checked&&"cash"===e.id&&document.querySelector(`.${this.prefix}_payments`)?.classList?.add("--dvp");n.querySelector("label").setAttribute("for",`payform_${e.id}`);const d=t.querySelector(`.${this.prefix}_payments__clause_top`);if(d&&!e.group&&e.clause.length){const n=this.prepareClauses(e.clause);d.innerHTML=n,t.classList.add("--clause-top")}return this.addPaymentOptions(e,n),n}isExpressVisible(){return!!document.querySelector(`${this.modalSelector}`)}closeModal(){this.modal&&document.querySelector(this.modalSelector)&&this.modal?.closeModal?.()}toggleLoader(e=!0){e?this.addLoading():this.removeLoading(),"function"==typeof this.LoaderCallback&&this.LoaderCallback(!!e)}onClickShowAllOptions(e){const t=e.closest(`.${this.prefix}_payments__details`);t&&(t.classList.toggle("--show-all"),t.classList.contains("--show-all")?e.textContent=this.txt["Pokaż mniej"]:e.textContent=this.txt["Pokaż wszystkie"])}onChangeSelectPayment(e){this.disableInputs();const t="selected_group_only"===e.name?e.closest(`.${this.prefix}_payments__item`):e.closest(`.${this.prefix}_payments__option`);if(!t)return;if(t.classList.contains("--options")){const n=e?.getAttribute("data-group-id");return e.value=n||"transfer",void this.paymentSelected({paymentElement:t})}const n=e.value,a=t.querySelector('input[name="payform_id"]'),r=t.querySelector('input[name="first_payment_id"]');let s=!1;a?s=a.value:r&&(s=r.value);const i=a?"payment":"group";this.paymentSelected({paymentElement:t,selectedPayment:n,selectedPaymentForCost:s,selectedPaymentType:i})}paymentSelected({paymentElement:e=null,selectedPayment:t=null,selectedPaymentForCost:n=null,selectedPaymentType:a=null}={}){const r=document.querySelector(`.${this.prefix}_payments`);if(!r)return;r.classList.add("--selected");r.querySelectorAll(`.${this.prefix}_payments__item`).forEach((e=>{e.querySelector(`.${this.prefix}_payments__input:checked`)||e.querySelector(`.${this.prefix}_payments__option_input:checked`)?e.classList.add("--checked"):e.classList.remove("--checked")}));const s=e.querySelector(`.${this.prefix}_payments__input`)||e.querySelector(`.${this.prefix}_payments__option_input`);if(!s)return;const i=s.value,o=s.getAttribute("data-group-id");r.setAttribute("data-id",i),r.setAttribute("data-group-id",o),this.vars.selectedPayment=t,this.vars.selectedPaymentForCost=n,this.vars.selectedPaymentType=a,this.clause()}async showPayments(){const e=document.getElementById(`${this.prefix}_retry_modal`)?.content.cloneNode(!0);if(!e)return;const t=e?.querySelector(`.${this.prefix}_payments__wrapper`);if(!t)return;const n=e.querySelector(`.${this.prefix}_payments`);if(!n)return;const a=n.querySelector(`.${this.prefix}_payments__wrapper`);if(!a)return;this.vars.formattedUniquePayments.forEach((e=>{const t=this.prepareElementToDisplay(e,n);t&&a.appendChild(t)}));const r=e=>{const t=(()=>{const e=document.createElement("div");return e.classList.add("modal__handler"),e})();t&&e.insertAdjacentElement("afterBegin",t)},s=e=>{if(this.ModalAnimationClass){const t=e.querySelector(".modal__wrapper");if(!t)return;r(t),(e=>{e.classList.add("--mobile-animation")})(e),this.ModalAnimationClass.init?.({modal:e})}},i=()=>{this.ModalAnimationClass&&this.ModalAnimationClass?.destroy?.()},o=e=>{e?document.querySelector("body").classList.add("--modal-overflow"):document.querySelector("body").classList.remove("--modal-overflow")};this.modal.params={element:e,classList:"--expchck_retry --medium --orders",afterShow:(e,t)=>{this.createGoPaymentElement(),this.updateTotalToPayValue(),s(e),o(!0)},afterClose:()=>{i(),o(!1)}},this.modal.init()}initEvents(){const e=document.querySelector(`.${this.prefix}_payments`),t=document.querySelector(`.${this.prefix}_summary`);if(!e||!t)return;t.addEventListener("click",(e=>{const{target:t}=e;if(t.closest(`.${this.prefix}_summary__more_orders`)){e.preventDefault();const n=document.querySelector(`.${this.prefix}_summary__orders__details`),a=n.classList.contains("--show")?"remove":"add";n.classList[a]("--show");const r=t.getAttribute("data-alt_text");return t.setAttribute("data-alt_text",t.innerText),t.innerText=r,!1}return!0})),e.addEventListener("click",(e=>{const{target:t}=e;return t.closest(`.${this.prefix}_payments__show_all`)?(e.preventDefault(),this.onClickShowAllOptions(t),!1):(t.closest(`.${this.prefix}_payments__label`)&&this.onClickToggleTab(t),!0)})),e.addEventListener("change",(e=>{const{target:t}=e;return!t.closest(`.${this.prefix}_payments__input`)&&!t.closest(`.${this.prefix}_payments__option_input`)||(e.preventDefault(),this.onChangeSelectPayment(t),!1)}));const n=document.querySelector(`.${this.prefix}_summary`);if(!n)return;const a=n?.querySelector(".expchck_submit__button");a?.addEventListener("click",(()=>{this.paymentAction()}))}addOrdersDetailsElement(){const e=document.querySelector(`#${this.prefix}_summary_orders_details`)?.content.cloneNode(!0);if(!e)return!1;const t=e.querySelector(`.${this.prefix}_summary__orders__details`);this.vars.orders.forEach((e=>{const n=document.querySelector(`#${this.prefix}_summary_order_details`)?.content.cloneNode(!0);if(!n)return!1;n.querySelector(".order_id").innerText=e?.id,n.querySelector(".order_date").innerText=e?.date,n.querySelector(".order_invoice").innerText=e?.invoice,n.querySelector(".order_worth").innerText=e?.worth,!e?.invoice&&n.querySelector(".order_invoice_wrapper").classList.add("d-none"),t.prepend(n)})),this.vars.orders.length<3&&e.querySelector(`.${this.prefix}_summary__more_orders`)?.classList.add("d-none"),document.querySelector(`.${this.prefix}_summary__wrapper`).prepend(e)}async init(e={}){this.toggleLoader(!0),this.paymentsData=await super.getData("payments",e.orders)||{},this.vars={previousStep:e.previousStep||this.vars?.previousStep,payments:this.paymentsData?.collectivePayments?.payments||this.paymentsData?.paymentsMethod?.payments||[],paymentsGroup:this.paymentsData?.collectivePayments?.paymentsGroup||this.paymentsData?.paymentsMethod?.paymentsGroup||[],paymentsGroupTerms:this.paymentsData?.collectivePayments?.paymentsGroupTerms||this.paymentsData?.paymentsMethod?.paymentsGroupTerms||[],defaultPaymentMethodId:this.paymentsData?.collectivePayments?.settings?.defaultPaymentMethodId||this.paymentsData?.paymentsMethod?.settings?.defaultPaymentMethodId||0,uniquePayments:[],formattedUniquePayments:[],paymentOptions:[],transferChecked:e.transferChecked||!1,paymentMethodData:null,totalToPayValue:null,leftToPay:e?.leftToPay||0,prepaidPaymentGroupsConfigs:[],orders:e?.orders||[]},this.updateUniquePayments(),this.prepareObjectToDisplay(),await this.showPayments(),await this.initEvents(),this.toggleLoader(!1),this.addOrdersDetailsElement(),document.querySelector(`${this.modalSelector} .${this.prefix}_total__value`).innerText=this.vars.leftToPay}}function isExpressCheckoutOrder(){return!!document.querySelector('[data-is-express-checkout="true"]')}function isOscopOrder(){return"true"===sessionStorage.getItem("oscop-current-order")}function clearOscopOrderSession(){sessionStorage.removeItem("oscop-current-order")}function isPayLaterOptionSelected(){const e=document.querySelector("[data-pay-later-id]"),t=document.querySelector("[data-pay-later-order-number]");return e&&t}const PAYMENT_GQL={CHANGE_ORDER_PAYMENT:(e,t)=>JSON.stringify({query:`mutation {\n        changeOrderPayment(\n          ChangeOrderPaymentInput: { orderNumber: ${e}, paymentMethodId: ${t} }\n        ) {\n          response {\n            status\n          }\n          paymentId\n          error {\n            code\n            message\n          }\n        }\n      }`}),PREPARE_PAYMENT:(e,t)=>JSON.stringify({query:`query {\n      preparePayment(PreparePaymentInput: {\n        orderNumber: ${e},\n        paymentId: ${t}\n      }) {\n        paymentId\n        description\n        type\n        javascript\n        fromData {\n          action\n          method\n          target\n          acceptCharset\n          inputs {\n            name\n            type\n            value\n            className\n            url\n          }\n        }\n        paymentXML\n      }\n    }`}),PREPARE_COLLECTIVE_PAYMENT:(e,t)=>JSON.stringify({query:`query {\n        prepareCollectivePayment(PrepareCollectivePaymentInput: {\n        ordersNumbers: ${e},\n        paymentFormId: ${t}\n      }) {\n        paymentId\n        description\n        type\n        javascript\n        fromData {\n          action\n          method\n          target\n          acceptCharset\n          inputs {\n            name\n            type\n            value\n            className\n            url\n          }\n        }\n        paymentXML\n      }\n    }`})},PAYMENT_TXT={"Wystąpił błąd połączenia. Sprawdź łącze internetowe lub spróbuj ponownie później":"Wystąpił błąd połączenia. Sprawdź łącze internetowe lub spróbuj ponownie później","Oświadczam, że zapoznałam / zapoznałem się i w pełni akceptuję Regulamin.":"Oświadczam, że zapoznałam / zapoznałem się i w pełni akceptuję Regulamin.","Zapoznałem się i akceptuję":"Zapoznałem się i akceptuję ",", przez którą będzie realizowana płatność.":", przez którą będzie realizowana płatność.","regulamin płatności jednorazowej IdoPay":"regulamin płatności jednorazowej IdoPay","Przejdź do płatności odroczonej":" Przejdź do płatności odroczonej","Zapłać":"Zapłać ","Wypełnij wniosek":"Wypełnij wniosek"};class Payment{constructor(e={}){const{orderIds:t,paymentMethodData:n,txt:a,form:r}=e;if(this.paymentForOnceOrder=e?.paymentForOnceOrder||!1,this.txt=a||{},this.orderIds=t||[1],this.paymentMethodData=n||{id:0,name:"",img:""},this.form=r,!(t&&n&&a&&r))throw new Error("payment data is not defined!")}async fetchData(e={}){const{data:t,link:n,linkParameter:a="",alert:r=!0}=e;if(!t)return!1;try{const e=await fetch(`${n||app_shop.urls.graphql||"/graphql/v1"}${a}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:t}),s=await e.json();if((s?.errors||s?.error)&&r){const e=s?.errors?.[0]?.message||this.txt["Wystąpił błąd połączenia. Sprawdź łącze internetowe lub spróbuj ponownie później"];Alertek.Error(e)}return s}catch(e){return r&&Alertek.Error(this.txt["Wystąpił błąd połączenia. Sprawdź łącze internetowe lub spróbuj ponownie później"]),!1}}setLoader(e="add",t="--loader"){this.form?.classList?.[e](t)}async setNewPayment(){const e=await this.fetchData({data:PAYMENT_GQL.CHANGE_ORDER_PAYMENT(this.orderIds[0],this.paymentMethodData?.id),linkParameter:"?changeOrderPayment",alert:!1});if(this.newPaymentData=e.data.changeOrderPayment,"success"!==this.newPaymentData.response?.status||!this.newPaymentData?.paymentId){const e=this.newPaymentData.error?.message||this.txt["Wystąpił błąd połączenia. Sprawdź łącze internetowe lub spróbuj ponownie później"];return Alertek.Error(e),!1}return await this.getPaymentData(this.newPaymentData?.paymentId)}async getPaymentData(e){const t={data:e?PAYMENT_GQL.PREPARE_PAYMENT(this.orderIds[0],e):PAYMENT_GQL.PREPARE_COLLECTIVE_PAYMENT(`[${this.orderIds.join(",")}]`,this.paymentMethodData?.id),linkParameter:e?"?preparePayment":"?prepareCollectivePayment",alert:!0},n=await this.fetchData(t);return n?.data?.preparePayment||n?.data?.prepareCollectivePayment}setPaymentForm(){if(!this.paymentData?.type)return app_shop.fn?.expressCheckoutModalInstance?.closeModal?.(),!1;"form"===this.paymentData?.type&&(this.getPaymentHtml=new PaymentType_form({paymentData:this.paymentData,paymentId:this.paymentId,leftToPay:this.paymentMethodData?.leftToPay||0,txt:this.txt,orderIds:this.orderIds}),this.getPaymentHtml.init()),"installment_plan"===this.paymentData?.type&&(this.getPaymentHtml=new PaymentType_installment_plan({paymentData:this.paymentData,paymentId:this.paymentId,leftToPay:this.paymentMethodData?.leftToPay||0,txt:this.txt,orderIds:this.orderIds}),this.getPaymentHtml.init()),"credit_card"===this.paymentData?.type&&(this.getPaymentHtml=new PaymentType_credit_card({paymentData:this.paymentData,paymentId:this.paymentId,leftToPay:this.paymentMethodData?.leftToPay||0,txt:this.txt,orderIds:this.orderIds}),this.getPaymentHtml.init())}async init(){this.paymentData=this.paymentForOnceOrder?await this.setNewPayment():await this.getPaymentData(),this.setPaymentForm()}}app_shop.fn.validateTerms=()=>{const e=document.querySelectorAll(".summary__term");let t=!0;return e.forEach((e=>{e.querySelector("input").checked?e.classList.remove("--required"):(e.classList.add("--required"),t=!1)})),t},app_shop.fn.isPayLaterSelected=e=>"210"===e,app_shop.fn.getScriptsFromHtml=e=>{const t=document.createElement("div");t.innerHTML=e;const n=[...t.getElementsByTagName("script")];if(!n.length)return[];const a=[];return n.forEach((e=>{const t=document.createElement("script");t.text=e.innerHTML,a.push(t)})),a},app_shop.fn.getElementsFromHtml=e=>{const t=document.createElement("div");t.innerHTML=e;return[...[...t.childNodes].filter((e=>"SCRIPT"!==e.tagName)),...app_shop.fn.getScriptsFromHtml(e)]},app_shop.fn.evalAllJSFromHtml=function(e){const t=app_shop.fn.getScriptsFromHtml(e);document.body.append(...t)},app_shop.fn.replaceHtml=(e,t)=>{if(!t)return;t.innerHTML="";const n=app_shop.fn.getElementsFromHtml(e);t.append(...n)};const CountDownTimer=function(e={}){this.data=e;const{element:t=null,counterName:n="base",callback:a=()=>{},fyllDashArray:r=283,timeLimit:s=4}=e;let{timePassed:i=0,timeLeft:o=s,timerInterval:l=null}=e;const c=e=>e%60+"s",d=()=>{clearInterval(l),i=0,o=s,l=null,a&&a()},p=()=>{const e=`${((()=>{const e=o/s;return e-1/s*(1-e)})()*r).toFixed(0,1)} 283`;document.getElementById(`${n}-timer-path-remaining`).setAttribute("stroke-dasharray",e)};this.html=`\n  <div id="${n}-timer" class="timer">\n    <svg class="timer__svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">\n      <g class="timer__circle">\n        <circle class="timer__path-elapsed" cx="50" cy="50" r="45"></circle>\n        <path\n          id="${n}-timer-path-remaining"\n          stroke-dasharray="283"\n          class="timer__path-remaining"\n          d="\n            M 50, 50\n            m -45, 0\n            a 45,45 0 1,0 90,0\n            a 45,45 0 1,0 -90,0\n          "\n        ></path>\n      </g>\n    </svg>\n    <span id="${n}-timer-label" class="timer__label">${c(o)}</span>\n  </div>\n  `,this.init=()=>!!t&&(t.innerHTML=this.html,l=setInterval((()=>{i+=1,o=s-i,document.getElementById(`${n}-timer-label`).innerHTML=c(o),p(),0===o&&d()}),1e3),!0)},PaymentForce=function(e={},t={}){this.data=e,this.txt=t;const{element:n="",name:a="",shopLogo:r="",paymentLogo:s="",systemLogo:i="",form:o="",beforeSendCall:l=null,afterSendCall:c=null}=e,{przekierowanieDoPlatnosci:d=window?.paymentForceTxt1||"Przekierowanie do płatności",jesliPrzekierowanieNieNastapi:p=window?.paymentForceTxt2||"Jeśli przekierowanie nie nastąpiło automatycznie, kliknij:"}=t;this.endTimer=()=>{l&&l(),document.querySelector("#paymentForce form")?.submit(),c&&c()},this.html=`<div class="paymentForce__wrapper">\n    <div id="paymentForce" class="paymentForce">\n    <span class="paymentForce__shop_logo ${r?"":"d-none"}">\n        <img src="${r}" alt="logo"/>\n      </span>\n      <span class="paymentForce__header">\n        <span>${d}</span>\n        <img class="systemLogo ${i?"":"d-none"}" src="${i}" alt="${a}"/>\n        <img class="paymentLogo" src="${s}" alt="${a}"/>\n      </span>\n      <span class="paymentForce__timer"></span>\n      <span class="paymentForce__txt">${p}</span>\n      ${o}\n    </div>\n  </div>`,this.start=()=>{n.insertAdjacentHTML("afterbegin",this.html),this.timer=new CountDownTimer({name:"paymentForce",element:document.querySelector(".paymentForce__timer"),callback:window?.offRedirect||this.endTimer}),this.timer.init()}};class PaymentType_form{constructor(e){const{paymentData:t,paymentId:n,txt:a,leftToPay:r}=e;this.paymentData=t||{},this.paymentId=n||0,this.leftToPay=r||0,this.txt=a||{}}radio(e){return`<div class="orderpaymentradio">\n      <label>\n        <input type="${e.type}" value="${e.value}" name="${e.name}" ${e.checked?"checked":""}/>\n      </label>\n    </div>`}checkbox(e){return app_shop.fn.isPayLaterSelected(this.paymentId)?`<div class="summary__term">\n      <label class="summary__term_label">\n        <span>\n          <input type="checkbox" name="${e.name}" value="yes" class="css-checkbox ${e?.className||""}" onchange="app_shop.fn.validateTerms()"/>\n          <i class="css-label --small"/>\n        </span>\n        <span class="summary__term__value">${e.value}</span>\n      </label>\n    </div>`:""}hidden(e){return`<input type="${e.type}" value="${e.value}" name="${e.name}"/>`}terms(e){return`<div class="terms_description cm">\n      <div class="terms_checkbox">\n        <label><input type="checkbox" class="css-checkbox" required id="terms_iai_pay_checkbox" value="${e.value}" name="${e.name}" onchange="this.checked=true" checked/>\n          <span style="text-align: center;">${e.url?`${this.txt["Zapoznałem się i akceptuję"]}<a target="_blank" href="${e.url}" class="show_terms_btn">${this.txt["regulamin płatności jednorazowej IdoPay"]}</a>${this.txt[", przez którą będzie realizowana płatność."]}`:this.txt["Oświadczam, że zapoznałam / zapoznałem się i w pełni akceptuję Regulamin."]}</span>\n        </label>\n      </div>\n    </div>`}button(e){const t=`${e.className||"orderdetails_paygate_finalize"} btn --large --solid`,n=203===this.paymentId?`${this.txt["Przejdź do płatności odroczonej"]} (${this.leftToPay})`:`${this.txt["Zapłać"]} ${this.leftToPay}`;return`\n    <button type="submit" value="${e.value}" class="${t}" ${e.id?` id="${e.id}"`:""}>\n      ${e.img?`<img src="${e.img}"/>`:""}\n      ${n}\n    </button>\n    `}getDescription(){const e=`<div id="paymentdescription">${this.paymentData?.description||""}</div>`;return this.paymentData?.description?e:""}getTotalToPayElement(){if(app_shop.fn?.expressCheckoutModalInstance?.isExpressVisible?.()){const e=app_shop.fn?.expressCheckoutModalInstance?.getTotalToPayElement?.();return e||""}return""}getForm(){const{inputs:e=[]}=this.paymentData?.fromData||{};return`\n    <form class="payment_popup_submit_form" method="${this.paymentData?.fromData?.method}" action="${this.paymentData?.fromData?.action}">\n      ${e.reduce(((e,t)=>e+=this[t?.type]?this[t?.type](t||{}):""),"")}\n    </form>\n    `}checkPaymentForce(){return!!("object"==typeof this.paymentData?.formData?.inputs&&Object.values(this.paymentData?.formData?.inputs).length&&Object.values(this.paymentData?.formData?.inputs)?.reduce(((e,t)=>"checkbox"===t?.type))||this.paymentData?.description&&(-1!==this.paymentData?.description?.indexOf("<iframe")||-1!==this.paymentData?.description?.indexOf("paypal_button_container")||-1!==this.paymentData?.description?.indexOf("apple-pay-button")))}init(){const e=`\n      ${this.getDescription()}\n      ${this.getTotalToPayElement()}\n      ${this.paymentData?.fromData?this.getForm():""}\n    `;if(this.checkPaymentForce()){const t=document.getElementById("go_payment");return t&&app_shop.fn.replaceHtml(e,t),!0}return app_shop.fn?.expressCheckoutModalInstance?.closeModal?.(),app_shop.vars.paymentForce=new PaymentForce({element:document.querySelector("#container"),name:app_shop.vars?.express_retry_app?.paymentMethodData?.name,shopLogo:window?.prepaid_data?.shopLogoSettings?.url||app_shop.vars.logoUrl||"/data/gfx/mask/pol/logo_1_big.jpg",paymentLogo:app_shop.vars?.express_retry_app?.paymentMethodData?.icon,systemLogo:app_shop.vars?.express_retry_app?.paymentMethodData?.payment_system_logo,form:e}),document.querySelector(".orderpay__button ")?.classList.remove("--fixed"),app_shop.vars.paymentForce.start(),!0}}class PaymentType_installment_plan{constructor(e){const{paymentData:t,paymentId:n,txt:a,leftToPay:r}=e;this.paymentData=t||{},this.paymentId=n||0,this.leftToPay=r||0,this.txt=a||{}}radio(e){return`<div class="orderpaymentradio">\n      <label>\n        <input type="${e.type}" value="${e.value}" name="${e.name}" ${e.checked?"checked":""}/>\n      </label>\n    </div>`}html(e){return e.value}hidden(e){return`<input type="${e.type}" value="${e.value}" name="${e.name}"/>`}button(e){const t=`${e.className||"orderdetails_paygate_finalize"} btn --large --solid`;return`\n    ${21===this.paymentData?.payment_id?this.getDescription():""}\n    <div class="paymentbutton-wrapper" style="text-align:center;">\n      <button type="submit" value="${e.value}" class="${t}" ${e.id?` id="${e.id}"`:""}>${e.img?`<img src="${e.img}"/>`:""}${this.txt["Wypełnij wniosek"]}</button>\n    </div>`}getDescription(){const e=`<div id="paymentdescription">${this.paymentData?.description||""}</div>`;return this.paymentData?.description?e:""}getForm(){const{inputs:e=[]}=this.paymentData?.fromData||{};return`\n    <form class="payment_popup_submit_installment_plan cm" method="${this.paymentData?.fromData?.method}" action="${this.paymentData?.fromData?.action}">\n      ${e.reduce(((e,t)=>e+=this[t?.type]?this[t?.type](t||{}):""),"")}\n    </form>\n    `}init(){const e=`\n      ${this.paymentData?.fromData?this.getForm():""}\n      ${21!==this.paymentData?.payment_id?this.getDescription():""}\n    `,t=document.getElementById("go_payment");return t&&app_shop.fn.replaceHtml(e,t),!1}}class PaymentType_credit_card{constructor(e){const{paymentData:t,paymentId:n,txt:a,leftToPay:r,orderIds:s}=e;this.paymentData=t||{},this.paymentId=n||0,this.leftToPay=r||0,this.txt=a||{},this.orderIds=s||[0]}async getCardForm(){if(document.querySelector("#orderdetails_payments_static"))return!1;const e=await fetch(`/orderdetails.php?order_number=${this.orderIds[0]}&shop_xml=1&get_ajax_items=orderdetails_payments_static${window?.orderKey?"&key="+window?.orderKey:""}`),t=await e.json();if(!t?.orderdetails_payments_static)return!1;document.querySelector("body").insertAdjacentHTML("beforeend",t?.orderdetails_payments_static)}async init(){await this.getCardForm();const e=this.paymentData,{payment_id:t}=e||{};if(!t)return;const n=`.embeded_card_form_${t}`,a=document.querySelector(n);if(!a)return;const r=a.cloneNode(!0);r.querySelectorAll(".clear_data").forEach((e=>e.innerHTML=""));r.querySelectorAll("[data-altid]").forEach((e=>e.setAttribute("id",e.getAttribute("data-altid"))));const{payment_xml:s}=e||{};if(!s)return;app_shop.fn.evalAllJSFromHtml(s);const i=(new DOMParser).parseFromString(s,"text/xml"),{payment_description:o}=e||{},l=r.querySelector("div.payment_head_info");if(o){const e=document.createElement("div");e.id="paymentdescription",o.innerHTML=o,"25"==t?r.append(e):l&&(e.removeAttribute("id"),e.classList.add("payment_description"),l.append(e))}const c=i.querySelector("headermessage");if(c&&c.innerHTML){const e=r.querySelector(".payment_headermessage");e&&(e.innerHTML=c.innerHTML),l&&l.removeAttribute("style")}const d=i.querySelector("headerlogo");if(d&&d.innerHTML){const e=r.querySelector(".payment_headerlogo img");e&&e.setAttribute("src",d.innerHTML),l&&l.removeAttribute("style")}r.querySelectorAll("input").forEach((e=>{e.setAttribute("disabled","disabled");const t=e.closest("div.form-group");t&&(t.style.display="none")}));const p=[];i.querySelectorAll("item").forEach((e=>{const t=e.getAttribute("class")||"",n=e.getAttribute("name"),a=e.getAttribute("value"),s=e.getAttribute("type");if("creditCard[system]"===n){const t=r.querySelector("#credit_card_system");e.querySelectorAll("option").forEach((e=>{const n=e.getAttribute("value"),a=e.getAttribute("label"),r=e.getAttribute("data-img"),s=a.toLowerCase().replace(/\s/g,"").replace(/[^a-zA-Z ]/g,""),i=document.createElement("label");i.classList.add("card-icon"),i.id=`card_icon_${s}`;const o=document.createElement("input");o.className="validate required",o.type="radio",o.name="creditCard[system]",o.value=n,o.setAttribute("data-serialize","#credit_card_system input"),i.append(o);const l=document.createElement("div"),c=document.createElement("img");c.src=r,c.alt=a,l.append(c),i.append(l),t&&t.append(i),p.push(s)}))}else if("checkbox"===s){const i=e.querySelector("description"),o=document.createElement("label"),l=document.createElement("input");t&&l.classList.add(t),l.type=s,l.name=n,l.value=a;const c=document.createElement("span");c.innerHTML=i.innerHTML,o.append(l),o.append(c);const d=r.querySelector("#credit_card_agree");d&&d.append(o)}else if("link"===s){const t=e.getAttribute("link"),n=e.getAttribute("id"),a=e.querySelector("description"),r=document.createElement("a");r.href=t,r.id=n,r.innerHTML=a.innerHTML}if("useStore"===n){const e=document.createElement("input");e.type="hidden",e.name=n,e.value=a,t&&e.classList.add(t);const s=r.querySelector("#credit_card_buttons");s&&s.append(e)}else{const s=r.querySelector(`input[name="${n}"]`);if(s){a&&(s.value=a),s.removeAttribute("disabled"),t&&s.classList.add(t);const n=s.closest("div.form-group");n&&(n.style.display=""),e.hasAttribute("readonly")?(s.classList.add("readonly","correct"),s.setAttribute("readonly","readonly"),s.setAttribute("disabled","disabled")):(s.classList.remove("readonly"),s.removeAttribute("readonly"))}}}));r.querySelectorAll("[data-altname]").forEach((e=>e.setAttribute("name",e.getAttribute("data-altname"))));const m=document.getElementById("go_payment");return m&&app_shop.fn.replaceHtml(r.innerHTML,m),cardHandler.init(document.getElementById("go_payment"),p),!1}}var orderdetails_payments={paymentID:-1,payment_target:"",test:!1,timeoutAjax:2e4,other_payments:"",retry_payment:"",fn_submit_credit_card:function(){return!0},fn_submit_form:function(){return!0},fn_submit_installment_plan:function(){return!0},dialog:function(){return!0},ajaxLoadSite:function(e,t=!1){const n=t?"--loading-page-overlay":"--loading-page";if(e)document.querySelector("html").classList.add(n);else{document.querySelector("html").classList.remove("--loading-page"),document.querySelector("html").classList.remove("--loading-page-overlay");const e=document.querySelector(".orderdetails_summary");e&&e.classList.remove("--pay_overlay")}}};function setGiftcardError(e){if(!e)return;const t=e.closest(".f-feedback");t&&(t.classList.remove("--success"),t.classList.add("--error"))}function setGiftcardSuccess(e){if(!e)return;const t=e.closest(".f-feedback");t&&(t.classList.remove("--error"),t.classList.add("--success"))}class OrdersPaymentGet{constructor(){this.orders=[],this.sign="",this.paymentsSum=0,this.paymentsInstance=new ExpressCheckoutRetryModal({ModalAnimationClass:AnimateMobileRetryModal,LoaderCallback:orderdetails_payments.ajaxLoadSite}),app_shop.fn.expressCheckoutModalInstance=this.paymentsInstance}validateSign(e){const t=document.querySelectorAll(".orderpay__select input");return 0===e.length?(this.sign="",!1):!(e.length>=1)&&(this.sign=e[1].getAttribute("data-sign"),t.forEach((e=>{e.disabled=!1,e.getAttribute("data-sign")!==this.sign&&(e.checked=!1,e.disabled=!0)})),!0)}getOrdersToPay(){const e=document.querySelectorAll(".orderpay__select input:checked");0===e.length&&(this.sign=""),1===e.length&&(this.sign="")}togglePaymentsButton(){const e=document.querySelector(".orderpay__button"),t=document.querySelectorAll(".orderpay__select input:checked").length?"remove":"add";e.classList[t]("--hide"),e.querySelector(".orderpay__worth").innerText=this.paymentsSum}async openPaymentsModal(){await(this.paymentsInstance?.init?.())}getPriceSum(){const e=document.querySelector(".orderpay__worth");if(!e||!this.orders.length)return!1;const t=this.orders.reduce(((e,t)=>e+parseFloat(t.worth.replace(",",".").replace(" ",""))),0);this.paymentsSum=window?.format_price(t,{mask:app_shop.vars.currency_format,currency:this.orders[0].sign,currency_space:app_shop.vars.currency_space,currency_before_price:app_shop.vars.currency_before_value}),e.innerText=this.paymentsSum}checkAllOrders(e){const t=document.querySelectorAll(".orderpay__select input"),n=!!e.checked;this.sign=t[0].getAttribute("data-sign"),t.forEach(((e,t)=>{if(!n&&e.getAttribute("data-sign")!==this.sign)return!1;e.disabled=!1,e.checked=n})),this.checkOrder()}checkOrder(){const e=document.querySelectorAll(".orderpay__select input:checked");this.validateSign(e),this.orders=[...e].map((e=>({id:e.getAttribute("data-id"),date:e.getAttribute("data-date"),invoice:e.getAttribute("data-invoice"),worth:e.getAttribute("data-worth"),sign:e.getAttribute("data-sign")})))||[],this.togglePaymentsButton(),this.getPriceSum()}goToPay(){this.paymentsInstance.init({orders:this.orders,leftToPay:this.paymentsSum})}checkFixedBuyButton(){const e=document.querySelector(".orderpay__button_wrapper"),t=document.querySelector(".orderpay__button").offsetHeight,n=window.innerHeight;return!(e.getBoundingClientRect().top-n+t<=0)}fixedBuyButton(){const e=document.querySelector(".orderpay__button");this.checkFixedBuyButton()?e.classList.add("--fixed"):e.classList.remove("--fixed")}setEvents(){document.addEventListener("change",(e=>e.target.closest('input[name="orderpay__checkbox"]')?(e.preventDefault(),this.checkOrder(),!1):e.target.closest('input[name="orderpay__select_all"]')?(e.preventDefault(),this.checkAllOrders(e.target),!1):void 0)),document.addEventListener("click",(e=>{if(e.target.closest(".orderpay__button a"))return e.preventDefault(),this.goToPay(),!1})),document.addEventListener("scroll",(()=>{this.fixedBuyButton()}),!0)}init(){document.querySelectorAll(".orderpay__select input").forEach(((e,t)=>{e.checked=!1})),this.setEvents(),this.togglePaymentsButton();const e=document.querySelector(".orderpay__button");this.checkFixedBuyButton()&&e.classList.add("--fixed")}}app_shop.run((function(){app_shop.fn.paymentsOrders=new OrdersPaymentGet,app_shop.fn.paymentsOrders.init(),app_shop.vars.logoUrl=document.querySelector("#logo img")?.currentSrc||"/data/gfx/mask/pol/logo_1_big.jpg"}),"all",".orderpay__button",!0);var cardHandler={error:!1,cvvInfoOpenInProgress:!1,submitBtnNoStore:null,submitBtnStore:null,inputs:[],cardNumInput:null,cardCvvInput:null,cardHolderInput:null,cardExpiryMonthInput:null,cardExpiryYear:null,cardSystemArray:[],cardCvvLabel:null,init:function(e,t){e&&(this.form=e.querySelector("form"),this.submitBtnNoStore=e.querySelector(".credit_card_submit_no_store"),this.submitBtnStore=e.querySelector(".credit_card_submit_store"),this.cardNumInput=e.querySelector("#credit_card_number"),this.cardHolderInput=e.querySelector("#credit_card_name"),this.cardCvvInput=e.querySelector("#credit_card_code"),this.cardSystemArray=t,this.cardCvvLabel=e.querySelector('label[for="credit_card_code"]'),this.cardCvvLabelText=this.cardCvvLabel?.textContent,this.replaceDateInputs(e),this.initEvents(),this.blockSubmit())},replaceDateInputs:function(e){const t=e.querySelector("#credit_card_month");if(t){const n=`<select name="${t.name}" id="${t.id}" class="form-control payu-card-expm">\n        ${[...Array(12).keys()].map((e=>e+1)).map((e=>`<option value="${e<10?"0"+e:e}">${e<10?"0"+e:e}</option>`)).join("")}\n      </select>`;t.outerHTML=n,this.cardExpiryMonthInput=e.querySelector("#credit_card_month")}const n=e.querySelector("#credit_card_year");if(n){const t=(new Date).getFullYear(),a=`<select name="${n.name}" id="${n.id}" class="form-control payu-card-expy">\n        ${[...Array(20).keys()].map((e=>e+t)).map(((e,t)=>`<option value="${e.toString().slice(-2)}">${e}</option>`)).join("")}\n      </select>`;n.outerHTML=a,this.cardExpiryYear=e.querySelector("#credit_card_year"),this.cardExpiryYear.selectedIndex=0}},isCardNumberCorrect:function(e){const t=this.getCardType(),n=this.cardSystemArray.includes(t);return n&&e?payform.validateCardNumber(e):n?payform.validateCardNumber(this.cardNumInput?.value):(null!==t&&Alertek.show_alert(txt_62619_card_not_supported),!1)},isCvvCorrect:function(e){return e?payform.validateCardCVC(e,this.getCardType()):payform.validateCardCVC(this.cardCvvInput?.value,this.getCardType())},setError:function(e){e?.parentNode?.classList.remove("has-success","has-required"),e?.parentNode?.classList.add("has-error"),cardHandler.error=!0,cardHandler.submitBtnNoStore.disabled=!0,cardHandler.submitBtnStore.disabled=!0,cardHandler.submitBtnNoStore.classList.add("disabled"),cardHandler.submitBtnStore.classList.add("disabled")},setCorrect:function(e){e&&(e.parentNode.classList.remove("has-error","has-required"),e.parentNode.classList.add("has-success"));document.querySelectorAll("#go_payment .has-error").length||(this.error=!1),this.blockSubmit()},blockSubmit:function(){if(this.allDataEntered()&&!this.error)return this.submitBtnNoStore.disabled=!1,this.submitBtnStore.disabled=!1,this.submitBtnNoStore.classList.remove("disabled"),void this.submitBtnStore.classList.remove("disabled");this.submitBtnNoStore.disabled=!0,this.submitBtnStore.disabled=!0,this.submitBtnNoStore.classList.add("disabled"),this.submitBtnStore.classList.add("disabled")},allDataEntered:function(){const e=""!==this.cardCvvInput.value.trim(),t=""!==this.cardNumInput.value.trim(),n=""!==this.cardHolderInput.value.trim();return e&&t&&n},initEvents:function(){function e(e){const{target:t}=e;cardHandler.markCardIcon(),cardHandler.validateCvv(),cardHandler.isCardNumberCorrect(t.value)?cardHandler.setCorrect(t):cardHandler.setError(t)}function t(){payform.fitYearSelect(cardHandler.cardExpiryYear,cardHandler.cardExpiryMonthInput.value)}function n(e){const{target:t}=e;t.value.trim()?cardHandler.setCorrect(t):cardHandler.setError(t)}this.cardNumInput.addEventListener("input",e),this.cardNumInput.addEventListener("change",e),this.cardNumInput.addEventListener("blur",e),payform.cardNumberInput(this.cardNumInput),this.cardCvvInput.addEventListener("input",cardHandler.validateCvv),this.cardCvvInput.addEventListener("change",cardHandler.validateCvv),this.cardCvvInput.addEventListener("blur",cardHandler.validateCvv),payform.cvcInput(this.cardCvvInput),this.cardExpiryMonthInput.addEventListener("change",t),this.cardExpiryMonthInput.addEventListener("blur",t),t(),this.cardHolderInput.addEventListener("input",n),this.cardHolderInput.addEventListener("change",n),this.cardHolderInput.addEventListener("blur",n)},validateCvv:function(){const e=""!==cardHandler.cardCvvInput.value.trim(),t=""!==cardHandler.cardNumInput.value.trim(),n=document.activeElement===cardHandler.cardNumInput;(t&&!n||e)&&(cardHandler.isCvvCorrect()&&e?cardHandler.setCorrect(cardHandler.cardCvvInput):cardHandler.setError(cardHandler.cardCvvInput))},unmarkCardIcon:function(){document.querySelectorAll(".card-icon input").forEach((e=>{e.checked=!1}))},markCardIcon:function(){this.unmarkCardIcon();const e=this.getCardType();switch(e){case"mastercard":this.cardCvvLabel.textContent="CVC2";break;case"visa":this.cardCvvLabel.textContent="CVV2";break;default:this.cardCvvLabel.textContent=this.cardCvvLabelText}if(!this.cardSystemArray.includes(e))return;const t=document.querySelector(`#card_icon_${e} input`);t&&(t.checked=!0)},getCardType:function(){return payform.parseCardType(cardHandler.cardNumInput?.value)}};(function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};!function(e,t){"undefined"!=typeof module&&null!==module?module.exports=t():"function"==typeof define&&"object"==typeof define.amd?define(e,t):this[e]=t()}("payform",(function(){var t,n,a,r,s,i,o,l,c,d,p,m,u,h,y,g,f,v,_,b,S,x,P,C,I,E,L,w;return n=function(e){var t,n,a;return null!=e.selectionStart?e.selectionStart:null!=document.selection?(e.focus(),t=document.selection.createRange(),n=(a=e.createTextRange()).duplicate(),a.moveToBookmark(t.getBookmark()),n.setEndPoint("EndToStart",a),n.text.length):void 0},t=function(e){return function(t){var n;if(null==t&&(t=window.event),"insertCompositionText"!==t.inputType||t.isComposing)return n={target:t.target||t.srcElement,which:t.which||t.keyCode,type:t.type,metaKey:t.metaKey,ctrlKey:t.ctrlKey,preventDefault:function(){t.preventDefault?t.preventDefault():t.returnValue=!1}},e(n)}},r=function(e,t,n){return null!=e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},a=function(e,t,n){return null!=e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n)},v={UNKNOWN:0,BACKSPACE:8,PAGE_UP:33,ARROW_LEFT:37,ARROW_RIGHT:39},(b={}).cards=[{type:"elo",pattern:/^(4011(78|79)|43(1274|8935)|45(1416|7393|763(1|2))|50(4175|6699|67[0-7][0-9]|9000)|627780|63(6297|6368)|650(03([^4])|04([0-9])|05(0|1)|4(0[5-9]|3[0-9]|8[5-9]|9[0-9])|5([0-2][0-9]|3[0-8])|9([2-6][0-9]|7[0-8])|541|700|720|901)|651652|655000|655021)/,format:l=/(\d{1,4})/g,length:[16],cvcLength:[3],luhn:!0},{type:"visaelectron",pattern:/^4(026|17500|405|508|844|91[37])/,format:l,length:[16],cvcLength:[3],luhn:!0},{type:"maestro",pattern:/^(5018|5020|5038|6304|6390[0-9]{2}|67[0-9]{4})/,format:l,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"forbrugsforeningen",pattern:/^600/,format:l,length:[16],cvcLength:[3],luhn:!0},{type:"dankort",pattern:/^5019/,format:l,length:[16],cvcLength:[3],luhn:!0},{type:"visa",pattern:/^4/,format:l,length:[13,16,19],cvcLength:[3],luhn:!0},{type:"mastercard",pattern:/^(5[1-5][0-9]{4}|677189)|^(222[1-9]|2[3-6]\d{2}|27[0-1]\d|2720)([0-9]{2})/,format:l,length:[16],cvcLength:[3],luhn:!0},{type:"amex",pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[4],luhn:!0},{type:"hipercard",pattern:/^(384100|384140|384160|606282|637095|637568|60(?!11))/,format:l,length:[14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"dinersclub",pattern:/^(36|38|30[0-5])/,format:/(\d{1,4})(\d{1,6})?(\d{1,4})?/,length:[14],cvcLength:[3],luhn:!0},{type:"discover",pattern:/^(6011|65|64[4-9]|622)/,format:l,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",pattern:/^62/,format:l,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"jcb",pattern:/^35/,format:l,length:[16,17,18,19],cvcLength:[3],luhn:!0},{type:"laser",pattern:/^(6706|6771|6709)/,format:l,length:[16,17,18,19],cvcLength:[3],luhn:!0}],i=function(e){var t,n,a,r;for(e=(e+"").replace(/\D/g,""),n=0,a=(r=b.cards).length;n<a;n++)if((t=r[n]).pattern.test(e))return t},o=function(e){var t,n,a,r;for(n=0,a=(r=b.cards).length;n<a;n++)if((t=r[n]).type===e)return t},g=function(e){var t;return(t=getComputedStyle(e))&&t.direction||document.dir},_=function(e){var t,n,a,r,s,i;for(s=!0,i=0,a=0,r=(n=(e+"").split("").reverse()).length;a<r;a++)t=n[a],t=parseInt(t,10),(s=!s)&&(t*=2),t>9&&(t-=9),i+=t;return i%10==0},f=function(e){var t;return!(null==("undefined"!=typeof document&&null!==document&&null!=(t=document.selection)?t.createRange:void 0)||!document.selection.createRange().text)||null!=e.selectionStart&&e.selectionStart!==e.selectionEnd},C=function(e){var t,n,a,r,s,i;for(null==e&&(e=""),i="",a=0,s=(n=e.split("")).length;a<s;a++)t=n[a],(r="０１２３４５６７８９".indexOf(t))>-1&&(t="0123456789"[r]),i+=t;return i},x=function(e){var t;if(t=n(e.target),""!==e.target.value)return"ltr"===g(e.target)&&(t=n(e.target)),e.target.value=b.formatCardNumber(e.target.value),"ltr"===g(e.target)&&t!==e.target.selectionStart&&(t=n(e.target)),"rtl"===g(e.target)&&-1===e.target.value.indexOf("‎‎")&&(e.target.value="‎‎".concat(e.target.value)),null!=(t=n(e.target))&&0!==t&&"change"!==e.type?e.target.setSelectionRange(t,t):void 0},u=function(e){var t,a,r,s,o,l,c;if(r=String.fromCharCode(e.which),/^\d+$/.test(r)&&(c=e.target.value,t=i(c+r),s=(c.replace(/\D/g,"")+r).length,l=16,t&&(l=t.length[t.length.length-1]),!(s>=l||(a=n(e.target))&&a!==c.length)))return(o=t&&"amex"===t.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/).test(c)?(e.preventDefault(),setTimeout((function(){return e.target.value=c+" "+r}))):o.test(c+r)?(e.preventDefault(),setTimeout((function(){return e.target.value=c+r+" "}))):void 0},d=function(e){var t,a;if(a=e.target.value,e.which===v.BACKSPACE&&!((t=n(e.target))&&t!==a.length||e.target.selectionEnd-e.target.selectionStart>1))return/\d\s$/.test(a)?(e.preventDefault(),setTimeout((function(){return e.target.value=a.replace(/\d\s$/,"")}))):/\s\d?$/.test(a)?(e.preventDefault(),setTimeout((function(){return e.target.value=a.replace(/\d$/,"")}))):void 0},P=function(e){var t;if(""!==e.target.value)return e.target.value=b.formatCardExpiry(e.target.value),"rtl"===g(e.target)&&-1===e.target.value.indexOf("‎‎")&&(e.target.value="‎‎".concat(e.target.value)),null!=(t=n(e.target))&&"change"!==e.type?e.target.setSelectionRange(t,t):void 0},m=function(e){var t,n;if(t=String.fromCharCode(e.which),/^\d+$/.test(t))return n=e.target.value+t,/^\d$/.test(n)&&"0"!==n&&"1"!==n?(e.preventDefault(),setTimeout((function(){return e.target.value="0"+n+" / "}))):/^\d\d$/.test(n)?(e.preventDefault(),setTimeout((function(){return e.target.value=n+" / "}))):void 0},h=function(e){var t,n;if(t=String.fromCharCode(e.which),/^\d+$/.test(t))return n=e.target.value,/^\d\d$/.test(n)?e.target.value=n+" / ":void 0},y=function(e){var t,n;if("/"===(n=String.fromCharCode(e.which))||" "===n)return t=e.target.value,/^\d$/.test(t)&&"0"!==t?e.target.value="0"+t+" / ":void 0},p=function(e){var t,a;if(a=e.target.value,e.which===v.BACKSPACE&&(!(t=n(e.target))||t===a.length))return/\d\s\/\s$/.test(a)?(e.preventDefault(),setTimeout((function(){return e.target.value=a.replace(/\d\s\/\s$/,"")}))):void 0},S=function(e){var t;if(""!==e.target.value)return t=n(e.target),e.target.value=C(e.target.value).replace(/\D/g,"").slice(0,4),null!=t&&"change"!==e.type?e.target.setSelectionRange(t,t):void 0},E=function(e){var t,n,a,r;if(n=String.fromCharCode(e.which),/^\d+$/.test(n)&&!f(e.target))return r=(e.target.value+n).replace(/\D/g,""),a=(t=i(r))?t.length[t.length.length-1]:16,r.length>a?e.preventDefault():void 0},L=function(e){var t;if(t=String.fromCharCode(e.which),/^\d+$/.test(t)&&!f(e.target))return(e.target.value+t).replace(/\D/g,"").length>6?e.preventDefault():void 0},I=function(e){var t;if(t=String.fromCharCode(e.which),/^\d+$/.test(t)&&!f(e.target))return(e.target.value+t).length>4?e.preventDefault():void 0},c={cvcInput:[{eventName:"keypress",eventHandler:t(w=function(e){var t;if(!e.metaKey&&!e.ctrlKey&&!([v.UNKNOWN,v.ARROW_LEFT,v.ARROW_RIGHT].indexOf(e.which)>-1||e.which<v.PAGE_UP))return t=String.fromCharCode(e.which),/^\d+$/.test(t)?void 0:e.preventDefault()})},{eventName:"keypress",eventHandler:t(I)},{eventName:"paste",eventHandler:t(S)},{eventName:"change",eventHandler:t(S)},{eventName:"input",eventHandler:t(S)}],expiryInput:[{eventName:"keypress",eventHandler:t(w)},{eventName:"keypress",eventHandler:t(L)},{eventName:"keypress",eventHandler:t(m)},{eventName:"keypress",eventHandler:t(y)},{eventName:"keypress",eventHandler:t(h)},{eventName:"keydown",eventHandler:t(p)},{eventName:"change",eventHandler:t(P)},{eventName:"input",eventHandler:t(P)}],cardNumberInput:[{eventName:"keypress",eventHandler:t(w)},{eventName:"keypress",eventHandler:t(E)},{eventName:"keypress",eventHandler:t(u)},{eventName:"keydown",eventHandler:t(d)},{eventName:"paste",eventHandler:t(x)},{eventName:"change",eventHandler:t(x)},{eventName:"input",eventHandler:t(x)}],numericInput:[{eventName:"keypress",eventHandler:t(w)},{eventName:"paste",eventHandler:t(w)},{eventName:"change",eventHandler:t(w)},{eventName:"input",eventHandler:t(w)}]},s=function(e,t,n){var s,i,o;for(i=0,o=t.length;i<o;i++)s=t[i],n?a(e,s.eventName,s.eventHandler):r(e,s.eventName,s.eventHandler)},b.cvcInput=function(e){return s(e,c.cvcInput)},b.expiryInput=function(e){return s(e,c.expiryInput)},b.cardNumberInput=function(e){return s(e,c.cardNumberInput)},b.numericInput=function(e){return s(e,c.numericInput)},b.detachCvcInput=function(e){return s(e,c.cvcInput,!0)},b.detachExpiryInput=function(e){return s(e,c.expiryInput,!0)},b.detachCardNumberInput=function(e){return s(e,c.cardNumberInput,!0)},b.detachNumericInput=function(e){return s(e,c.numericInput,!0)},b.parseCardExpiry=function(e){var t,n,a;return t=(n=(e=e.replace(/\s/g,"")).split("/",2))[0],2===(null!=(a=n[1])?a.length:void 0)&&/^\d+$/.test(a)&&(a=(new Date).getFullYear().toString().slice(0,2)+a),{month:t=parseInt(t.replace(/[\u200e]/g,""),10),year:a=parseInt(a,10)}},b.validateCardNumber=function(t){var n,a;return t=(t+"").replace(/\s+|-/g,""),!!/^\d+$/.test(t)&&(!!(n=i(t))&&(a=t.length,e.call(n.length,a)>=0&&(!1===n.luhn||_(t))))},b.validateCardExpiry=function(e,t){var n,a,r;return"object"==typeof e&&"month"in e&&(e=(r=e).month,t=r.year),!(!e||!t)&&(e=String(e).trim(),t=String(t).trim(),!!/^\d+$/.test(e)&&(!!/^\d+$/.test(t)&&(1<=e&&e<=12&&(2===t.length&&(t=t<70?"20"+t:"19"+t),4===t.length&&(a=new Date(t,e),n=new Date,a.setMonth(a.getMonth()-1),a.setMonth(a.getMonth()+1,1),a>n)))))},b.validateCardCVC=function(t,n){var a,r;return t=String(t).trim(),!!/^\d+$/.test(t)&&(null!=(a=o(n))?(r=t.length,e.call(a.cvcLength,r)>=0):t.length>=3&&t.length<=4)},b.parseCardType=function(e){var t;return e&&(null!=(t=i(e))?t.type:void 0)||null},b.formatCardNumber=function(e){var t,n,a,r;return e=(e=C(e)).replace(/\D/g,""),(t=i(e))?(r=t.length[t.length.length-1],e=e.slice(0,r),t.format.global?null!=(a=e.match(t.format))?a.join(" "):void 0:null!=(n=t.format.exec(e))?(n.shift(),(n=n.filter(Boolean)).join(" ")):void 0):e},b.fitYearSelect=function(e,t){if((t=parseInt(t)-1)<0)return;if(t<(new Date).getMonth()){const t=e.querySelectorAll("option"),n=(new Date).getFullYear().toString().slice(-2),a=[...t].find((e=>e.value===n));if(!a)return;return a.classList.add("hidden"),void(0===e.selectedIndex&&(e.selectedIndex=1))}const n=e.querySelector("option.hidden");n&&n.classList.remove("hidden")},b.formatCardExpiry=function(e){var t,n,a,r;return(n=(e=C(e)).match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/))?(t=n[1]||"",a=n[2]||"",(r=n[3]||"").length>0?a=" / ":" /"===a?(t=t.substring(0,1),a=""):2===t.length||a.length>0?a=" / ":1===t.length&&"0"!==t&&"1"!==t&&(t="0"+t,a=" / "),t+a+r):""},b}))}).call(this);